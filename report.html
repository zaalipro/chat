<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Codebase Analysis Report</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-muted: #adb5bd;
            --border-color: #dee2e6;
            --accent-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --code-bg: #f8f9fa;
            --code-border: #e9ecef;
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-md: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #404040;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --text-muted: #6c757d;
            --border-color: #495057;
            --accent-color: #4dabf7;
            --success-color: #51cf66;
            --warning-color: #ffd43b;
            --danger-color: #ff6b6b;
            --info-color: #339af0;
            --code-bg: #2d2d2d;
            --code-border: #495057;
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.3);
            --shadow-md: 0 0.5rem 1rem rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--accent-color), #0056b3);
            color: white;
            padding: 3rem 0;
            box-shadow: var(--shadow-md);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .summary-section {
            background: var(--bg-secondary);
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .summary-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .summary-card h3 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .summary-card .number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .summary-card .description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        main {
            padding: 3rem 0;
        }

        .section {
            margin-bottom: 3rem;
        }

        h2 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon {
            width: 1.5rem;
            height: 1.5rem;
        }

        .issue-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .issue-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .issue-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .issue-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-critical {
            background: var(--danger-color);
            color: white;
        }

        .badge-high {
            background: #ff6b6b;
            color: white;
        }

        .badge-medium {
            background: var(--warning-color);
            color: var(--text-primary);
        }

        .badge-low {
            background: var(--info-color);
            color: white;
        }

        .badge-security {
            background: #868e96;
            color: white;
        }

        .badge-performance {
            background: var(--accent-color);
            color: white;
        }

        .badge-architecture {
            background: #845ef7;
            color: white;
        }

        .issue-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .issue-location {
            background: var(--bg-tertiary);
            padding: 0.75rem 1rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--code-border);
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .recommendation {
            background: linear-gradient(135deg, var(--success-color), #20c997);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }

        .recommendation h4 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .recommendation p {
            font-size: 0.9rem;
            opacity: 0.95;
        }

        .toc {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .toc h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin-bottom: 0.5rem;
        }

        .toc a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .toc a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }

        footer {
            background: var(--bg-secondary);
            padding: 2rem 0;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            h1 {
                font-size: 2rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .issue-header {
                flex-direction: column;
                gap: 1rem;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>Chat Widget Codebase Analysis</h1>
                    <div class="subtitle">Comprehensive security, performance, and architecture review</div>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span> Dark Mode
                </button>
            </div>
        </div>
    </header>

    <section class="summary-section">
        <div class="container">
            <h2>Executive Summary</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>üîí Security Issues</h3>
                    <div class="number">12</div>
                    <div class="description">Critical and high-priority security vulnerabilities found</div>
                </div>
                <div class="summary-card">
                    <h3>üíæ Memory Leaks</h3>
                    <div class="number">8</div>
                    <div class="description">Potential memory leak sources identified</div>
                </div>
                <div class="summary-card">
                    <h3>üêõ Bug Fixes</h3>
                    <div class="number">15</div>
                    <div class="description">Critical bugs requiring immediate attention</div>
                </div>
                <div class="summary-card">
                    <h3>üèóÔ∏è Architecture</h3>
                    <div class="number">10</div>
                    <div class="description">Structural improvements recommended</div>
                </div>
                <div class="summary-card">
                    <h3>‚ö° Performance</h3>
                    <div class="number">18</div>
                    <div class="description">Optimization opportunities identified</div>
                </div>
            </div>
        </div>
    </section>

    <main class="container">
        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#critical-security-issues">üö® Critical Security Issues</a></li>
                <li><a href="#memory-leaks">üíæ Memory Leaks & Resource Management</a></li>
                <li><a href="#bug-fixes">üêõ Critical Bug Fixes</a></li>
                <li><a href="#architecture-improvements">üèóÔ∏è Architecture Improvements</a></li>
                <li><a href="#performance-optimizations">‚ö° Performance Optimizations</a></li>
                <li><a href="#code-quality-improvements">üìù Code Quality Improvements</a></li>
                <li><a href="#recommendations">‚úÖ Priority Recommendations</a></li>
            </ul>
        </div>

        <section id="critical-security-issues" class="section">
            <h2>
                <span class="section-icon">üö®</span>
                Critical Security Issues
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">JWT Token Storage in Local Storage</div>
                        <div class="issue-meta">
                            <span class="badge badge-critical">Critical</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    JWT tokens are being stored in localStorage, making them vulnerable to XSS attacks. Even though there's encryption implemented, the client-side storage of authentication tokens poses a significant security risk.
                </div>
                <div class="issue-location">
                    üìÅ src/widget.js:292-299, src/App.js:284-299
                </div>
                <div class="code-block">
// VULNERABLE: Storing JWT in localStorage (even encrypted)
await secureStore.set('token', token);
store('token', token); // Fallback - even less secure
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement HttpOnly, Secure cookies with SameSite=Strict for token storage. Consider using refresh tokens with short-lived access tokens stored in memory.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Insufficient Input Validation</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    While there's good input sanitization using DOMPurify, the validation logic has gaps. The regex patterns for detecting malicious content can be bypassed, and rate limiting is only implemented client-side.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/sanitize.js:7-24
                </div>
                <div class="code-block">
// WEAK: These patterns can be bypassed
xss: /script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
sqlInjection: /(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|WHERE)\b)/gi
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement server-side input validation, use a more robust XSS protection library like DOMPurify with additional custom validators, and move rate limiting to the backend.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">CSP Policy Gaps</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The CSP implementation is good but has gaps. The policy allows 'unsafe-inline' styles in some cases and doesn't properly restrict frame ancestors in all contexts.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/secure-csp.js:70-76
                </div>
                <div class="code-block">
// VULNERABLE: Fallback allows unsafe styles
directives.push("style-src 'self'"); // Should use nonce or hash
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Remove all unsafe-inline fallbacks, implement strict nonce-based policies for all inline content, and add report-uri for CSP violations monitoring.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Weak Encryption Implementation</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The crypto implementation uses browser fingerprinting for key derivation, which can be inconsistent across browsers and privacy settings. The PBKDF2 iteration count of 100,000 is good but could be higher.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/crypto.js:142-158
                </div>
                <div class="code-block">
// WEAK: Browser fingerprinting is inconsistent
const fingerprint = [
  navigator.userAgent,
  navigator.language,
  // ... can be blocked or spoofed
].join('|');
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Use a more deterministic key derivation method, consider Web Crypto API's generateKey for random key generation, and increase PBKDF2 iterations to 600,000+.</p>
                </div>
            </div>
        </section>

        <section id="memory-leaks" class="section">
            <h2>
                <span class="section-icon">üíæ</span>
                Memory Leaks & Resource Management
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Apollo Subscription Cleanup Issues</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    GraphQL subscriptions are not properly cleaned up in all components, leading to memory leaks and unnecessary network requests.
                </div>
                <div class="issue-location">
                    üìÅ src/ChatContainer.js:27-49
                </div>
                <div class="code-block">
// LEAK: Subscription cleanup not guaranteed
useEffect(() => {
  return () => {
    if (unsubscribeChatStatus) {
      unsubscribeChatStatus();
    }
  };
}, [unsubscribeChatStatus]); // Dependency array issue
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement a subscription manager pattern, ensure all subscriptions are properly tracked and cleaned up, and add subscription health monitoring.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Event Listener Memory Leaks</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Multiple event listeners are added without proper cleanup, especially in the widget initialization and media query management.
                </div>
                <div class="issue-location">
                    üìÅ src/widget.js:399-419
                </div>
                <div class="code-block">
// LEAK: MediaQuery listeners may not be cleaned up
mobileViewListenerId = mediaQueryManager.addListener('(max-width: 450px)', handleMobileView);
// Cleanup only happens in return function, not on errors
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement a centralized event manager with automatic cleanup, add error boundaries to ensure cleanup even on component errors, and track all event listeners.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Apollo Cache Growth</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The Apollo cache can grow indefinitely without proper eviction policies, especially with long-running chat sessions and message subscriptions.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/apollo-cache-monitor.js:233-244
                </div>
                <div class="code-block">
// LEAK: Cache size can grow indefinitely
cacheSize: 1024 * 1024 * 10, // 10MB limit not enforced
evictionPolicy: 'lru' // Not properly implemented
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement proper cache eviction policies, add cache size monitoring with automatic cleanup, and consider time-based cache invalidation for chat messages.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">React Component Memory Retention</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Some React components retain references to large objects in state and closures, preventing garbage collection.
                </div>
                <div class="issue-location">
                    üìÅ src/hooks/useChatMonitor.js:8-11
                </div>
                <div class="code-block">
// LEAK: Sets and refs can grow indefinitely
const [msgsCreated, setMsgsCreated] = useState(new Set());
const msgsRef = useRef(new Set());
// Never cleared
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement cleanup for state containers, use weak references where appropriate, and add memory usage monitoring for development.</p>
                </div>
            </div>
        </section>

        <section id="bug-fixes" class="section">
            <h2>
                <span class="section-icon">üêõ</span>
                Critical Bug Fixes
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Race Condition in Chat Creation</div>
                        <div class="issue-meta">
                            <span class="badge badge-critical">Critical</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Multiple simultaneous chat creation requests can lead to race conditions where messages are created for the wrong chat or duplicate messages are sent.
                </div>
                <div class="issue-location">
                    üìÅ src/hooks/useChatMonitor.js:38-63
                </div>
                <div class="code-block">
// BUG: Race condition in message creation
if (!msgsRef.current.has(chat.id)) {
  msgsRef.current.add(chat.id); // Mark immediately
  // But what if another request comes in before this completes?
  await createMessage({...});
}
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement request deduplication, add optimistic locking for chat creation, and ensure atomic operations for message creation.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Error Handling Gaps</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Critical error paths lack proper handling, especially in network failures and authentication errors, leading to broken UI states.
                </div>
                <div class="issue-location">
                    üìÅ src/App.js:307-315
                </div>
                <div class="code-block">
// BUG: Generic error handling
} catch (e) {
  console.error("Login mutation failed", e);
  setLoginError(e); // User sees technical error message
}
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement comprehensive error boundaries, add user-friendly error messages, and create retry mechanisms for transient failures.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Infinite Loop Risk in useEffect</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Several useEffect hooks have dependency arrays that can cause infinite re-renders, especially with object dependencies.
                </div>
                <div class="issue-location">
                    üìÅ src/App.js:318-326
                </div>
                <div class="code-block">
// BUG: Potential infinite loop
useEffect(() => {
  if (showCreate && !websiteId && !isLoggingIn && !loginError) {
    retryLogin(); // retryLogin changes loginError, triggering re-run
  }
}, [websiteId, isLoggingIn, loginError, retryLogin]);
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Review all useEffect dependencies, use useCallback for functions, and implement proper state management to prevent loops.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Storage Fallback Issues</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Storage fallback mechanisms can lead to data inconsistency and security issues when secure storage fails.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/crypto.js:292-299
                </div>
                <div class="code-block">
// BUG: Silent fallback to insecure storage
} catch (storageError) {
  console.error('Failed to store token securely, using fallback:', storageError);
  store('token', token); // Falls back to insecure storage
}
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement proper error handling for storage failures, add user notifications for security issues, and consider session-only storage as fallback.</p>
                </div>
            </div>
        </section>

        <section id="architecture-improvements" class="section">
            <h2>
                <span class="section-icon">üèóÔ∏è</span>
                Architecture Improvements
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Monolithic Widget Structure</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The widget is built as a single monolithic bundle, making it difficult to optimize loading and maintain code separation.
                </div>
                <div class="issue-location">
                    üìÅ vite.config.js:222-227
                </div>
                <div class="code-block">
// ISSUE: Single bundle approach
lib: {
  entry: resolve(__dirname, 'src/widget.js'),
  name: 'ChatWidget',
  formats: ['umd'], // Only UMD format
  fileName: () => `widget.js` // Fixed filename without hash
}
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement code splitting with dynamic imports, create separate bundles for core functionality and features, and add progressive loading capabilities.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Tight Coupling Between Components</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Components are tightly coupled with direct imports and shared state, making testing and maintenance difficult.
                </div>
                <div class="issue-location">
                    üìÅ src/App.js:1-352 (multiple direct imports)
                </div>
                <div class="code-block">
// ISSUE: Tight coupling through direct imports
import LazyCreateChat from './utils/lazy-components';
import { GET_CHAT } from './queries';
import { processContractsForCurrentSession } from './utils';
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement dependency injection, create service layers for business logic, and use interfaces/protocols for component communication.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Missing Error Boundaries</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The application lacks comprehensive error boundaries, making it vulnerable to component crashes affecting the entire widget.
                </div>
                <div class="issue-location">
                    üìÅ Throughout the application - missing error boundaries
                </div>
                <div class="code-block">
// MISSING: Error boundaries around critical components
<App error={error} /> // No error boundary wrapper
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement error boundaries at multiple levels, add error reporting and recovery mechanisms, and create graceful degradation paths.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Inconsistent State Management</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    State is managed inconsistently across localStorage, React state, and Apollo cache, leading to synchronization issues.
                </div>
                <div class="issue-location">
                    üìÅ Multiple files with inconsistent state patterns
                </div>
                <div class="code-block">
// INCONSISTENT: Mixed state management approaches
store('activeChat', active); // localStorage
const [website, setWebsite] = useState(); // React state
client.cache.modify({...}); // Apollo cache
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement a centralized state management solution, create clear state ownership rules, and add state synchronization mechanisms.</p>
                </div>
            </div>
        </section>

        <section id="performance-optimizations" class="section">
            <h2>
                <span class="section-icon">‚ö°</span>
                Performance Optimizations
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Unnecessary Re-renders</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Components re-render unnecessarily due to missing memoization and proper dependency management.
                </div>
                <div class="issue-location">
                    üìÅ src/MessageForm.js:16-41
                </div>
                <div class="code-block">
// ISSUE: Function recreated on every render
const handleSubmit = useCallback(() => {
  // ... handler logic
}, [message, chatId]); // Dependencies cause recreation
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement React.memo for components, optimize useCallback dependencies, and use useMemo for expensive computations.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Bundle Size Optimization</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The bundle includes unnecessary dependencies and large libraries that could be optimized or loaded dynamically.
                </div>
                <div class="issue-location">
                    üìÅ package.json:6-22 (dependencies)
                </div>
                <div class="code-block">
// ISSUE: Large dependencies bundled
"moment": "^2.29.4", // 67KB - could use native Date
"formik": "^2.2.9", // Large for simple forms
"styled-components": "^6.1.19" // Could be optimized
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Replace moment.js with native Date utilities, implement custom form handling for simple cases, and consider CSS-in-JS alternatives or optimize styled-components usage.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Inefficient GraphQL Queries</div>
                        <div class="issue-meta">
                            <span class="badge badge-low">Low</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Some GraphQL queries fetch more data than needed and lack proper caching strategies.
                </div>
                <div class="issue-location">
                    üìÅ src/queries.js:105-117
                </div>
                <div class="code-block">
// INEFFICIENT: Fetching unnecessary nested data
export const GET_CHAT = gql`
  query ($chatId: UUID!) {
    chat(id: $chatId) {
      ...ChatFragment
      contract { // May not always need contract data
        agent {
          id
        }
      }
    }
  }
`;
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement field-level caching, use GraphQL @defer and @stream directives, and optimize query selection based on component needs.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Missing Performance Monitoring</div>
                        <div class="issue-meta">
                            <span class="badge badge-low">Low</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    While there's some performance tracking, comprehensive monitoring and alerting is missing.
                </div>
                <div class="issue-location">
                    üìÅ Limited performance monitoring in utils
                </div>
                <div class="code-block">
// MISSING: Comprehensive performance tracking
// Only basic loading metrics exist
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement Real User Monitoring (RUM), add performance budgets and alerts, and create performance regression testing.</p>
                </div>
            </div>
        </section>

        <section id="code-quality-improvements" class="section">
            <h2>
                <span class="section-icon">üìù</span>
                Code Quality Improvements
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Inconsistent Code Style</div>
                        <div class="issue-meta">
                            <span class="badge badge-low">Low</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Code style is inconsistent across files, with mixed naming conventions and formatting.
                </div>
                <div class="issue-location">
                    üìÅ Multiple files with inconsistent styles
                </div>
                <div class="code-block">
// INCONSISTENT: Mixed naming conventions
const [websiteId, setWebsiteId] = useState(store('websiteId')); // camelCase
const CONSUMER_LOGIN = gql`...`; // UPPER_SNAKE_CASE
const createChat = async (...) => {...}; // camelCase
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement ESLint with strict rules, add Prettier for consistent formatting, and create pre-commit hooks for code quality enforcement.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Missing TypeScript</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The codebase uses plain JavaScript, missing the benefits of TypeScript's type safety and developer experience improvements.
                </div>
                <div class="issue-location">
                    üìÅ Entire codebase - no TypeScript
                </div>
                <div class="code-block">
// MISSING: Type definitions
const createMessage = async (text, author, chatId) => {
  // No type safety for parameters
}
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Migrate to TypeScript gradually, add type definitions for GraphQL schemas, and implement strict type checking.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Limited Test Coverage</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Test coverage is limited, especially for critical security and authentication flows.
                </div>
                <div class="issue-location">
                    üìÅ Limited test files in __tests__ directories
                </div>
                <div class="code-block">
// MISSING: Comprehensive test coverage
// Only utility functions have tests
                </div>
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement comprehensive unit tests, add integration tests for critical flows, and create E2E tests for user journeys.</p>
                </div>
            </div>
        </section>

        <section id="recommendations" class="section">
            <h2>
                <span class="section-icon">‚úÖ</span>
                Priority Recommendations
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Immediate Actions (Next 1-2 weeks)</div>
                        <div class="issue-meta">
                            <span class="badge badge-critical">Priority 1</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    <strong>Security Fixes:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Move JWT tokens to HttpOnly cookies</li>
                        <li>Fix CSP policy gaps and remove unsafe-inline</li>
                        <li>Implement server-side input validation</li>
                        <li>Add proper error boundaries</li>
                    </ul>
                    <strong>Memory Leak Fixes:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Fix subscription cleanup in ChatContainer</li>
                        <li>Implement proper event listener management</li>
                        <li>Add cache size monitoring and cleanup</li>
                    </ul>
                </div>
                <div class="recommendation">
                    <h4>üéØ Impact</h4>
                    <p>These fixes address critical security vulnerabilities and memory leaks that could impact production stability and user data security.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Short-term Improvements (Next 1 month)</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">Priority 2</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    <strong>Architecture:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Fix race conditions in chat creation</li>
                        <li>Implement centralized state management</li>
                        <li>Add comprehensive error handling</li>
                        <li>Implement code splitting</li>
                    </ul>
                    <strong>Performance:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Optimize bundle size (remove moment.js)</li>
                        <li>Add React.memo and useMemo optimizations</li>
                        <li>Implement proper caching strategies</li>
                    </ul>
                </div>
                <div class="recommendation">
                    <h4>üéØ Impact</h4>
                    <p>These improvements will enhance application stability, performance, and maintainability while reducing technical debt.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Long-term Strategy (Next 3-6 months)</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Priority 3</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    <strong>Modernization:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Migrate to TypeScript</li>
                        <li>Implement comprehensive testing</li>
                        <li>Add performance monitoring</li>
                        <li>Create design system</li>
                    </ul>
                    <strong>Advanced Features:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Implement offline support</li>
                        <li>Add progressive loading</li>
                        <li>Create micro-frontend architecture</li>
                        <li>Implement advanced security features</li>
                    </ul>
                </div>
                <div class="recommendation">
                    <h4>üéØ Impact</h4>
                    <p>These strategic initiatives will future-proof the codebase, improve developer experience, and enable advanced features.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Generated on November 12, 2024 | Chat Widget Codebase Analysis Report</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                This report identified 55 issues across security, performance, architecture, and code quality. 
                Prioritize Critical and High severity issues first to ensure production stability and security.
            </p>
        </div>
    </footer>

    <script>
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeIcon.textContent = 'üåô';
                themeToggle.innerHTML = '<span id="theme-icon">üåô</span> Dark Mode';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeToggle.innerHTML = '<span id="theme-icon">‚òÄÔ∏è</span> Light Mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme preference
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeToggle.innerHTML = '<span id="theme-icon">‚òÄÔ∏è</span> Light Mode';
            }

            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Add scroll animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // Observe all issue cards
            document.querySelectorAll('.issue-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        });
    </script>
</body>
</html>