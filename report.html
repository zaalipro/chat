
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Codebase Analysis Report</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-muted: #adb5bd;
            --border-color: #dee2e6;
            --accent-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --code-bg: #f8f9fa;
            --code-border: #e9ecef;
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-md: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #404040;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --text-muted: #6c757d;
            --border-color: #495057;
            --accent-color: #4dabf7;
            --success-color: #51cf66;
            --warning-color: #ffd43b;
            --danger-color: #ff6b6b;
            --info-color: #339af0;
            --code-bg: #2d2d2d;
            --code-border: #495057;
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.3);
            --shadow-md: 0 0.5rem 1rem rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--accent-color), #0056b3);
            color: white;
            padding: 3rem 0;
            box-shadow: var(--shadow-md);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .summary-section {
            background: var(--bg-secondary);
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .summary-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .summary-card h3 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .summary-card .number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .summary-card .description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        main {
            padding: 3rem 0;
        }

        .section {
            margin-bottom: 3rem;
        }

        h2 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon {
            width: 1.5rem;
            height: 1.5rem;
        }

        .issue-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .issue-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .issue-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .issue-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-critical {
            background: var(--danger-color);
            color: white;
        }

        .badge-high {
            background: #ff6b6b;
            color: white;
        }

        .badge-medium {
            background: var(--warning-color);
            color: var(--text-primary);
        }

        .badge-low {
            background: var(--info-color);
            color: white;
        }

        .badge-security {
            background: #868e96;
            color: white;
        }

        .badge-performance {
            background: var(--accent-color);
            color: white;
        }

        .badge-architecture {
            background: #845ef7;
            color: white;
        }

        .issue-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .issue-location {
            background: var(--bg-tertiary);
            padding: 0.75rem 1rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--code-border);
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-block pre {
            margin: 0;
            padding: 0;
            background: transparent;
            border: none;
        }

        .recommendation {
            background: linear-gradient(135deg, var(--success-color), #20c997);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }

        .recommendation h4 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .recommendation p {
            font-size: 0.9rem;
            opacity: 0.95;
        }

        .fix-details {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .fix-section {
            margin-bottom: 1.5rem;
        }

        .fix-section h4 {
            color: var(--accent-color);
            margin-bottom: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .fix-section p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .benefits-list {
            list-style: none;
            padding: 0;
        }

        .benefits-list li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .benefits-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .code-before, .code-after {
            position: relative;
        }

        .code-label {
            position: absolute;
            top: -0.5rem;
            left: 0.5rem;
            background: var(--accent-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            z-index: 1;
        }

        .code-after .code-label {
            background: var(--success-color);
        }

        .toc {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .toc h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin-bottom: 0.5rem;
        }

        .toc a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .toc a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }

        footer {
            background: var(--bg-secondary);
            padding: 2rem 0;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            h1 {
                font-size: 2rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .issue-header {
                flex-direction: column;
                gap: 1rem;
            }

            .code-comparison {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Syntax highlighting styles */
        .code-block .keyword { color: #0066cc; font-weight: bold; }
        .code-block .string { color: #009900; }
        .code-block .comment { color: #999999; font-style: italic; }
        .code-block .function { color: #cc6600; }
        .code-block .variable { color: #666666; }
        .code-block .number { color: #cc0000; }
        
        [data-theme="dark"] .code-block .keyword { color: #66b3ff; }
        [data-theme="dark"] .code-block .string { color: #66ff66; }
        [data-theme="dark"] .code-block .comment { color: #999999; }
        [data-theme="dark"] .code-block .function { color: #ffcc66; }
        [data-theme="dark"] .code-block .variable { color: #cccccc; }
        [data-theme="dark"] .code-block .number { color: #ff6666; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>Chat Widget Codebase Analysis</h1>
                    <div class="subtitle">Comprehensive security, performance, and architecture review</div>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span> Dark Mode
                </button>
            </div>
        </div>
    </header>

    <section class="summary-section">
        <div class="container">
            <h2>Executive Summary</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>üîí Security Issues</h3>
                    <div class="number">12</div>
                    <div class="description">Critical and high-priority security vulnerabilities found</div>
                </div>
                <div class="summary-card">
                    <h3>üíæ Memory Leaks</h3>
                    <div class="number">8</div>
                    <div class="description">Potential memory leak sources identified</div>
                </div>
                <div class="summary-card">
                    <h3>üêõ Bug Fixes</h3>
                    <div class="number">15</div>
                    <div class="description">Critical bugs requiring immediate attention</div>
                </div>
                <div class="summary-card">
                    <h3>üèóÔ∏è Architecture</h3>
                    <div class="number">10</div>
                    <div class="description">Structural improvements recommended</div>
                </div>
                <div class="summary-card">
                    <h3>‚ö° Performance</h3>
                    <div class="number">18</div>
                    <div class="description">Optimization opportunities identified</div>
                </div>
            </div>
        </div>
    </section>

    <main class="container">
        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#critical-security-issues">üö® Critical Security Issues</a></li>
                <li><a href="#memory-leaks">üíæ Memory Leaks & Resource Management</a></li>
                <li><a href="#bug-fixes">üêõ Critical Bug Fixes</a></li>
                <li><a href="#architecture-improvements">üèóÔ∏è Architecture Improvements</a></li>
                <li><a href="#performance-optimizations">‚ö° Performance Optimizations</a></li>
                <li><a href="#code-quality-improvements">üìù Code Quality Improvements</a></li>
                <li><a href="#recommendations">‚úÖ Priority Recommendations</a></li>
            </ul>
        </div>

        <section id="critical-security-issues" class="section">
            <h2>
                <span class="section-icon">üö®</span>
                Critical Security Issues
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">JWT Token Storage in Local Storage</div>
                        <div class="issue-meta">
                            <span class="badge badge-critical">Critical</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    JWT tokens are being stored in localStorage, making them vulnerable to XSS attacks. Even though there's encryption implemented, the client-side storage of authentication tokens poses a significant security risk.
                </div>
                <div class="issue-location">
                    üìÅ src/widget.js:292-299, src/App.js:284-299
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement HttpOnly, Secure cookies with SameSite=Strict for token storage. This prevents JavaScript access to tokens and protects against XSS attacks.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Vulnerable)</div>
                                <div class="code-block">
<pre><span class="comment">// VULNERABLE: Storing JWT in localStorage</span>
<span class="keyword">const</span> <span class="function">storeToken</span> = <span class="keyword">async</span> (token) => {
  <span class="keyword">try</span> {
    <span class="comment">// Even encrypted, still accessible via JavaScript</span>
    <span class="keyword">await</span> secureStore.<span class="function">set</span>(<span class="string">'token'</span>, token);
    store(<span class="string">'token'</span>, token); <span class="comment">// Fallback - even less secure</span>
  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">'Failed to store token'</span>, error);
  }
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Secure)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Using HttpOnly cookies via server</span>
<span class="keyword">const</span> <span class="function">storeToken</span> = <span class="keyword">async</span> (token) => {
  <span class="keyword">try</span> {
    <span class="comment">// Token stored in HttpOnly, Secure cookie by server</span>
    <span class="comment">// Set-Cookie: token=...; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=3600</span>
    <span class="keyword">await</span> api.<span class="function">setAuthCookie</span>(token);
    
    <span class="comment">// Store only session metadata in memory</span>
    sessionStore.<span class="function">set</span>(<span class="string">'isAuthenticated'</span>, <span class="keyword">true</span>);
    sessionStore.<span class="function">set</span>(<span class="string">'tokenExpiry'</span>, Date.<span class="function">now</span>() + <span class="number">3600000</span>);
  } <span class="keyword">catch</span> (error) {
    <span class="function">handleAuthError</span>(error);
  }
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Eliminates XSS token theft vulnerability</li>
                            <li>Prevents client-side script access to authentication tokens</li>
                            <li>Reduces attack surface for session hijacking</li>
                            <li>Improves compliance with security best practices</li>
                            <li>Protects against CSRF attacks with SameSite=Strict</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement HttpOnly, Secure cookies with SameSite=Strict for token storage. Consider using refresh tokens with short-lived access tokens stored in memory.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Insufficient Input Validation</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    While there's good input sanitization using DOMPurify, the validation logic has gaps. The regex patterns for detecting malicious content can be bypassed, and rate limiting is only implemented client-side.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/sanitize.js:7-24
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement server-side input validation with comprehensive security checks and move rate limiting to the backend.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Weak Validation)</div>
                                <div class="code-block">
<pre><span class="comment">// WEAK: These patterns can be bypassed</span>
<span class="keyword">const</span> <span class="variable">securityPatterns</span> = {
  <span class="variable">xss</span>: <span class="keyword">/</span><span class="string">script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script></span><span class="keyword">/gi</span>,
  <span class="variable">sqlInjection</span>: <span class="keyword">/</span><span class="string">(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|WHERE)\b)</span><span class="keyword">/gi</span>
};

<span class="keyword">const</span> <span class="function">validateInput</span> = (input) => {
  <span class="keyword">for</span> (<span class="keyword">const</span> [type, pattern] <span class="keyword">of</span> Object.<span class="function">entries</span>(securityPatterns)) {
    <span class="keyword">if</span> (pattern.<span class="function">test</span>(input)) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`Potential ${type} attack detected`</span>);
    }
  }
  <span class="keyword">return</span> DOMPurify.<span class="function">sanitize</span>(input);
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Robust Validation)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Comprehensive server-side validation</span>
<span class="keyword">const</span> <span class="function">validateInputSecure</span> = <span class="keyword">async</span> (input, context) => {
  <span class="comment">// 1. Client-side basic validation (first line of defense)</span>
  <span class="keyword">const</span> <span class="variable">clientValidation</span> = <span class="keyword">await</span> <span class="function">validateClientSide</span>(input);
  
  <span class="comment">// 2. Server-side validation with enhanced patterns</span>
  <span class="keyword">const</span> <span class="variable">serverResponse</span> = <span class="keyword">await</span> api.<span class="function">validateInput</span>({
    input,
    context,
    clientFingerprint: <span class="function">getFingerprint</span>(),
    timestamp: Date.<span class="function">now</span>()
  });
  
  <span class="comment">// 3. Multiple validation layers</span>
  <span class="keyword">if</span> (!serverResponse.<span class="variable">isValid</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">ValidationError</span>(serverResponse.<span class="variable">reason</span>);
  }
  
  <span class="comment">// 4. Enhanced DOMPurify with custom config</span>
  <span class="keyword">return</span> DOMPurify.<span class="function">sanitize</span>(serverResponse.<span class="variable">sanitizedInput</span>, {
    ALLOWED_TAGS: [<span class="string">'p'</span>, <span class="string">'br'</span>, <span class="string">'strong'</span>, <span class="string">'em'</span>],
    ALLOWED_ATTR: [],
    KEEP_CONTENT: <span class="keyword">false</span>
  });
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents XSS and injection attacks at multiple layers</li>
                            <li>Server-side validation cannot be bypassed by client manipulation</li>
                            <li>Rate limiting on backend prevents automated attacks</li>
                            <li>Enhanced DOMPurify configuration provides tighter content control</li>
                            <li>Comprehensive audit trail for security monitoring</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement server-side input validation, use a more robust XSS protection library like DOMPurify with additional custom validators, and move rate limiting to the backend.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">CSP Policy Gaps</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The CSP implementation is good but has gaps. The policy allows 'unsafe-inline' styles in some cases and doesn't properly restrict frame ancestors in all contexts.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/secure-csp.js:70-76
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Remove all unsafe-inline fallbacks, implement strict nonce-based policies, and add comprehensive CSP monitoring.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Vulnerable CSP)</div>
                                <div class="code-block">
<pre><span class="comment">// VULNERABLE: Fallback allows unsafe styles</span>
<span class="keyword">const</span> <span class="function">generateCSP</span> = () => {
  <span class="keyword">const</span> <span class="variable">directives</span> = [];
  
  <span class="comment">// Dangerous fallback that allows unsafe-inline</span>
  <span class="keyword">if</span> (!nonce) {
    directives.<span class="function">push</span>(<span class="string">"style-src 'self'"</span>); <span class="comment">// Should use nonce or hash</span>
  }
  
  <span class="keyword">return</span> directives.<span class="function">join</span>(<span class="string">'; '</span>);
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Strict CSP)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Strict nonce-based CSP with monitoring</span>
<span class="keyword">const</span> <span class="function">generateSecureCSP</span> = <span class="keyword">async</span> () => {
  <span class="keyword">const</span> <span class="variable">nonce</span> = <span class="function">generateNonce</span>();
  <span class="keyword">const</span> <span class="variable">directives</span> = [
    <span class="string">`default-src 'self'`</span>,
    <span class="string">`script-src 'self' 'nonce-${nonce}'`</span>,
    <span class="string">`style-src 'self' 'nonce-${nonce}'`</span>,
    <span class="string">`img-src 'self' data: https:`</span>,
    <span class="string">`connect-src 'self' ${API_ENDPOINT}`</span>,
    <span class="string">`frame-ancestors 'none'`</span>,
    <span class="string">`base-uri 'self'`</span>,
    <span class="string">`form-action 'self'`</span>,
    <span class="string">`upgrade-insecure-requests`</span>,
    <span class="string">`report-uri ${CSP_REPORT_ENDPOINT}`</span>,
    <span class="string">`report-to csp-endpoint`</span>
  ];
  
  <span class="comment">// No unsafe-inline fallbacks - strict enforcement</span>
  <span class="keyword">if</span> (!nonce) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'CSP nonce generation failed - blocking execution'</span>);
  }
  
  <span class="keyword">return</span> {
    <span class="variable">policy</span>: directives.<span class="function">join</span>(<span class="string">'; '</span>),
    <span class="variable">nonce</span>
  };
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Eliminates XSS attack vectors through strict CSP enforcement</li>
                            <li>Prevents clickjacking attacks with frame-ancestors restriction</li>
                            <li>Real-time CSP violation monitoring for threat detection</li>
                            <li>Automatic blocking of malicious content injection attempts</li>
                            <li>Compliance with modern security standards</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Remove all unsafe-inline fallbacks, implement strict nonce-based policies for all inline content, and add report-uri for CSP violations monitoring.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Weak Encryption Implementation</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-security">Security</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The crypto implementation uses browser fingerprinting for key derivation, which can be inconsistent across browsers and privacy settings. The PBKDF2 iteration count of 100,000 is good but could be higher.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/crypto.js:142-158
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Use Web Crypto API's generateKey for random key generation and increase PBKDF2 iterations to 600,000+.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Weak Encryption)</div>
                                <div class="code-block">
<pre><span class="comment">// WEAK: Browser fingerprinting is inconsistent</span>
<span class="keyword">const</span> <span class="function">generateKey</span> = <span class="keyword">async</span> () => {
  <span class="keyword">const</span> <span class="variable">fingerprint</span> = [
    navigator.<span class="variable">userAgent</span>,
    navigator.<span class="variable">language</span>,
    screen.<span class="variable">width</span> + <span class="string">'x'</span> + screen.<span class="variable">height</span>
  ].<span class="function">join</span>(<span class="string">'|'</span>);
  
  <span class="comment">// Can be blocked or spoofed by privacy settings</span>
  <span class="keyword">const</span> <span class="variable">encoder</span> = <span class="keyword">new</span> <span class="function">TextEncoder</span>();
  <span class="keyword">const</span> <span class="variable">keyMaterial</span> = <span class="keyword">await</span> crypto.<span class="function">subtle</span>.<span class="function">importKey</span>(
    <span class="string">'raw'</span>,
    encoder.<span class="function">encode</span>(fingerprint),
    { <span class="variable">name</span>: <span class="string">'PBKDF2'</span> },
    <span class="keyword">false</span>,
    [<span class="string">'deriveBits'</span>, <span class="string">'deriveKey'</span>]
  );
  
  <span class="comment">// 100,000 iterations - decent but could be higher</span>
  <span class="keyword">return</span> <span class="keyword">await</span> crypto.<span class="function">subtle</span>.<span class="function">deriveKey</span>(
    {
      <span class="variable">name</span>: <span class="string">'PBKDF2'</span>,
      <span class="variable">salt</span>: encoder.<span class="function">encode</span>(<span class="string">'fixed-salt'</span>),
      <span class="variable">iterations</span>: <span class="number">100000</span>,
      <span class="variable">hash</span>: <span class="string">'SHA-256'</span>
    },
    keyMaterial,
    { <span class="variable">name</span>: <span class="string">'AES-GCM'</span>, <span class="variable">length</span>: <span class="number">256</span> },
    <span class="keyword">true</span>,
    [<span class="string">'encrypt'</span>, <span class="string">'decrypt'</span>]
  );
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Strong Encryption)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Using Web Crypto API with proper key generation</span>
<span class="keyword">const</span> <span class="function">generateSecureKey</span> = <span class="keyword">async</span> () => {
  <span class="comment">// 1. Generate cryptographically secure random key</span>
  <span class="keyword">const</span> <span class="variable">key</span> = <span class="keyword">await</span> crypto.<span class="function">subtle</span>.<span class="function">generateKey</span>(
    {
      <span class="variable">name</span>: <span class="string">'AES-GCM'</span>,
      <span class="variable">length</span>: <span class="number">256</span>
    },
    <span class="keyword">true</span>,
    [<span class="string">'encrypt'</span>, <span class="string">'decrypt'</span>]
  );
  
  <span class="comment">// 2. Generate random salt for PBKDF2</span>
  <span class="keyword">const</span> <span class="variable">salt</span> = crypto.<span class="function">getRandomValues</span>(<span class="keyword">new</span> <span class="function">Uint8Array</span>(<span class="number">32</span>));
  
  <span class="comment">// 3. Use user-provided passphrase with high iteration count</span>
  <span class="keyword">const</span> <span class="variable">passphraseKey</span> = <span class="keyword">await</span> crypto.<span class="function">subtle</span>.<span class="function">importKey</span>(
    <span class="string">'raw'</span>,
    <span class="keyword">new</span> <span class="function">TextEncoder</span>().<span class="function">encode</span>(userPassphrase),
    { <span class="variable">name</span>: <span class="string">'PBKDF2'</span> },
    <span class="keyword">false</span>,
    [<span class="string">'deriveBits'</span>, <span class="string">'deriveKey'</span>]
  );
  
  <span class="comment">// 4. 600,000+ iterations for stronger security</span>
  <span class="keyword">const</span> <span class="variable">derivedKey</span> = <span class="keyword">await</span> crypto.<span class="function">subtle</span>.<span class="function">deriveKey</span>(
    {
      <span class="variable">name</span>: <span class="string">'PBKDF2'</span>,
      <span class="variable">salt</span>: salt,
      <span class="variable">iterations</span>: <span class="number">600000</span>,
      <span class="variable">hash</span>: <span class="string">'SHA-512'</span>
    },
    passphraseKey,
    { <span class="variable">name</span>: <span class="string">'AES-GCM'</span>, <span class="variable">length</span>: <span class="number">256</span> },
    <span class="keyword">true</span>,
    [<span class="string">'encrypt'</span>, <span class="string">'decrypt'</span>]
  );
  
  <span class="keyword">return</span> { <span class="variable">key</span>: derivedKey, <span class="variable">salt</span> };
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Cryptographically secure key generation eliminates fingerprinting vulnerabilities</li>
                            <li>Higher PBKDF2 iteration count provides stronger protection against brute force attacks</li>
                            <li>Random salt generation prevents rainbow table attacks</li>
                            <li>SHA-512 hashing provides better collision resistance</li>
                            <li>Consistent security across all browsers and privacy settings</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Use a more deterministic key derivation method, consider Web Crypto API's generateKey for random key generation, and increase PBKDF2 iterations to 600,000+.</p>
                </div>
            </div>
        </section>

        <section id="memory-leaks" class="section">
            <h2>
                <span class="section-icon">üíæ</span>
                Memory Leaks & Resource Management
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Apollo Subscription Cleanup Issues</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    GraphQL subscriptions are not properly cleaned up in all components, leading to memory leaks and unnecessary network requests.
                </div>
                <div class="issue-location">
                    üìÅ src/ChatContainer.js:27-49
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement a subscription manager pattern with automatic cleanup and health monitoring.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Memory Leak)</div>
                                <div class="code-block">
<pre><span class="comment">// LEAK: Subscription cleanup not guaranteed</span>
<span class="keyword">const</span> <span class="function">ChatContainer</span> = () => {
  <span class="keyword">const</span> [<span class="variable">unsubscribeChatStatus</span>, setUnsubscribeChatStatus] = <span class="function">useState</span>(<span class="keyword">null</span>);
  
  <span class="function">useEffect</span>(() => {
    <span class="keyword">const</span> <span class="variable">subscription</span> = client.<span class="function">subscribe</span>({
      <span class="variable">query</span>: CHAT_STATUS_SUBSCRIPTION,
      <span class="variable">variables</span>: { <span class="variable">chatId</span> }
    }).<span class="function">subscribe</span>({
      <span class="function">next</span>: (data) => <span class="function">handleChatStatus</span>(data),
      <span class="function">error</span>: (error) => <span class="function">handleError</span>(error)
    });
    
    <span class="function">setUnsubscribeChatStatus</span>(() => subscription.<span class="function">unsubscribe</span>);
    
    <span class="comment">// Cleanup only happens if unsubscribeChatStatus exists</span>
    <span class="keyword">return</span> () => {
      <span class="keyword">if</span> (unsubscribeChatStatus) {
        <span class="function">unsubscribeChatStatus</span>();
      }
    };
  }, [unsubscribeChatStatus]); <span class="comment">// Dependency array issue</span>
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Proper Cleanup)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Subscription manager with guaranteed cleanup</span>
<span class="keyword">class</span> <span class="function">SubscriptionManager</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">subscriptions</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">healthCheckInterval</span> = <span class="keyword">null</span>;
  }
  
  <span class="function">subscribe</span>(id, query, variables, handlers) {
    <span class="comment">// Clean up existing subscription if any</span>
    <span class="keyword">this</span>.<span class="function">unsubscribe</span>(id);
    
    <span class="keyword">const</span> <span class="variable">subscription</span> = client.<span class="function">subscribe</span>({ query, variables })
      .<span class="function">subscribe</span>({
        <span class="function">next</span>: handlers.<span class="function">next</span>,
        <span class="function">error</span>: (error) => {
          <span class="function">handleError</span>(error);
          <span class="keyword">this</span>.<span class="function">unsubscribe</span>(id); <span class="comment">// Auto-cleanup on error</span>
        },
        <span class="function">complete</span>: () => <span class="keyword">this</span>.<span class="function">unsubscribe</span>(id)
      });
    
    <span class="keyword">this</span>.<span class="variable">subscriptions</span>.<span class="function">set</span>(id, {
      <span class="variable">subscription</span>,
      <span class="variable">createdAt</span>: Date.<span class="function">now</span>(),
      <span class="variable">lastActivity</span>: Date.<span class="function">now</span>()
    });
    
    <span class="keyword">return</span> subscription;
  }
  
  <span class="function">unsubscribe</span>(id) {
    <span class="keyword">const</span> <span class="variable">sub</span> = <span class="keyword">this</span>.<span class="variable">subscriptions</span>.<span class="function">get</span>(id);
    <span class="keyword">if</span> (sub) {
      <span class="keyword">try</span> {
        sub.<span class="variable">subscription</span>.<span class="function">unsubscribe</span>();
      } <span class="keyword">catch</span> (error) {
        console.<span class="function">warn</span>(<span class="string">'Failed to unsubscribe:'</span>, error);
      } <span class="keyword">finally</span> {
        <span class="keyword">this</span>.<span class="variable">subscriptions</span>.<span class="function">delete</span>(id);
      }
    }
  }
  
  <span class="function">cleanupAll</span>() {
    <span class="keyword">for</span> (<span class="keyword">const</span> [id] <span class="keyword">of</span> <span class="keyword">this</span>.<span class="variable">subscriptions</span>) {
      <span class="keyword">this</span>.<span class="function">unsubscribe</span>(id);
    }
  }
}

<span class="keyword">const</span> <span class="function">ChatContainer</span> = () => {
  <span class="keyword">const</span> <span class="variable">subscriptionManager</span> = <span class="function">useRef</span>(<span class="keyword">new</span> <span class="function">SubscriptionManager</span>());
  
  <span class="function">useEffect</span>(() => {
    <span class="keyword">const</span> <span class="variable">subscriptionId</span> = <span class="string">`chat-${chatId}`</span>;
    
    <span class="keyword">const</span> <span class="variable">subscription</span> = subscriptionManager.current.<span class="function">subscribe</span>(
      subscriptionId,
      CHAT_STATUS_SUBSCRIPTION,
      { <span class="variable">chatId</span> },
      {
        <span class="function">next</span>: <span class="function">handleChatStatus</span>,
        <span class="function">error</span>: <span class="function">handleError</span>
      }
    );
    
    <span class="comment">// Guaranteed cleanup</span>
    <span class="keyword">return</span> () => {
      subscriptionManager.current.<span class="function">unsubscribe</span>(subscriptionId);
    };
  }, [chatId]); <span class="comment">// Stable dependency array</span>
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents memory leaks from orphaned subscriptions</li>
                            <li>Eliminates unnecessary network requests and server load</li>
                            <li>Automatic cleanup on component unmount and errors</li>
                            <li>Health monitoring for subscription lifecycle management</li>
                            <li>Centralized subscription management for better debugging</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement a subscription manager pattern, ensure all subscriptions are properly tracked and cleaned up, and add subscription health monitoring.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Event Listener Memory Leaks</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Multiple event listeners are added without proper cleanup, especially in the widget initialization and media query management.
                </div>
                <div class="issue-location">
                    üìÅ src/widget.js:399-419
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement a centralized event manager with automatic cleanup and error boundaries.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Event Leaks)</div>
                                <div class="code-block">
<pre><span class="comment">// LEAK: MediaQuery listeners may not be cleaned up</span>
<span class="keyword">const</span> <span class="function">initializeWidget</span> = <span class="keyword">async</span> () => {
  <span class="comment">// Adding listeners without tracking cleanup</span>
  <span class="keyword">let</span> <span class="variable">mobileViewListenerId</span>;
  
  <span class="keyword">const</span> <span class="function">handleMobileView</span> = (matches) => {
    <span class="keyword">if</span> (matches) {
      <span class="function">enableMobileMode</span>();
    } <span class="keyword">else</span> {
      <span class="function">disableMobileMode</span>();
    }
  };
  
  <span class="comment">// Listener added but cleanup not guaranteed</span>
  mobileViewListenerId = mediaQueryManager.<span class="function">addListener</span>(
    <span class="string">'(max-width: 450px)'</span>, 
    handleMobileView
  );
  
  <span class="comment">// Other event listeners...</span>
  window.<span class="function">addEventListener</span>(<span class="string">'resize'</span>, <span class="function">handleResize</span>);
  document.<span class="function">addEventListener</span>(<span class="string">'visibilitychange'</span>, <span class="function">handleVisibilityChange</span>);
  
  <span class="comment">// Cleanup only happens in return function, not on errors</span>
  <span class="keyword">return</span> () => {
    <span class="keyword">if</span> (mobileViewListenerId) {
      mediaQueryManager.<span class="function">removeListener</span>(mobileViewListenerId);
    }
  };
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Proper Event Management)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Centralized event manager with guaranteed cleanup</span>
<span class="keyword">class</span> <span class="function">EventManager</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">listeners</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">mediaQueries</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">isDestroyed</span> = <span class="keyword">false</span>;
  }
  
  <span class="function">addEventListener</span>(target, event, handler, options = {}) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="variable">isDestroyed</span>) <span class="keyword">return</span> <span class="keyword">null</span>;
    
    <span class="keyword">const</span> <span class="variable">id</span> = <span class="function">generateId</span>();
    <span class="keyword">const</span> <span class="variable">wrappedHandler</span> = <span class="keyword">async</span> (...args) => {
      <span class="keyword">try</span> {
        <span class="keyword">await</span> <span class="function">handler</span>(...args);
      } <span class="keyword">catch</span> (error) {
        console.<span class="function">error</span>(<span class="string">'Event handler error:'</span>, error);
        <span class="comment">// Continue cleanup even if handler fails</span>
      }
    };
    
    target.<span class="function">addEventListener</span>(event, wrappedHandler, options);
    
    <span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">set</span>(id, {
      <span class="variable">target</span>,
      <span class="variable">event</span>,
      <span class="variable">handler</span>: wrappedHandler,
      <span class="variable">options</span>
    });
    
    <span class="keyword">return</span> id;
  }
  
  <span class="function">addMediaQuery</span>(query, handler) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="variable">isDestroyed</span>) <span class="keyword">return</span> <span class="keyword">null</span>;
    
    <span class="keyword">const</span> <span class="variable">id</span> = <span class="function">generateId</span>();
    <span class="keyword">const</span> <span class="variable">mql</span> = <span class="function">matchMedia</span>(query);
    
    <span class="keyword">const</span> <span class="variable">wrappedHandler</span> = (e) => {
      <span class="keyword">try</span> {
        <span class="function">handler</span>(e.<span class="variable">matches</span>);
      } <span class="keyword">catch</span> (error) {
        console.<span class="function">error</span>(<span class="string">'Media query handler error:'</span>, error);
      }
    };
    
    mql.<span class="function">addEventListener</span>(<span class="string">'change'</span>, wrappedHandler);
    
    <span class="keyword">this</span>.<span class="variable">mediaQueries</span>.<span class="function">set</span>(id, {
      <span class="variable">mql</span>,
      <span class="variable">handler</span>: wrappedHandler
    });
    
    <span class="comment">// Initial call</span>
    <span class="function">handler</span>(mql.<span class="variable">matches</span>);
    
    <span class="keyword">return</span> id;
  }
  
  <span class="function">removeListener</span>(id) {
    <span class="keyword">const</span> <span class="variable">listener</span> = <span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">get</span>(id);
    <span class="keyword">if</span> (listener) {
      listener.<span class="variable">target</span>.<span class="function">removeEventListener</span>(
        listener.<span class="variable">event</span>, 
        listener.<span class="variable">handler</span>, 
        listener.<span class="variable">options</span>
      );
      <span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">delete</span>(id);
    }
  }
  
  <span class="function">removeMediaQuery</span>(id) {
    <span class="keyword">const</span> <span class="variable">mq</span> = <span class="keyword">this</span>.<span class="variable">mediaQueries</span>.<span class="function">get</span>(id);
    <span class="keyword">if</span> (mq) {
      mq.<span class="variable">mql</span>.<span class="function">removeEventListener</span>(<span class="string">'change'</span>, mq.<span class="variable">handler</span>);
      <span class="keyword">this</span>.<span class="variable">mediaQueries</span>.<span class="function">delete</span>(id);
    }
  }
  
  <span class="function">destroy</span>() {
    <span class="comment">// Clean up all listeners</span>
    <span class="keyword">for</span> (<span class="keyword">const</span> [id] <span class="keyword">of</span> <span class="keyword">this</span>.<span class="variable">listeners</span>) {
      <span class="keyword">this</span>.<span class="function">removeListener</span>(id);
    }
    <span class="keyword">for</span> (<span class="keyword">const</span> [id] <span class="keyword">of</span> <span class="keyword">this</span>.<span class="variable">mediaQueries</span>) {
      <span class="keyword">this</span>.<span class="function">removeMediaQuery</span>(id);
    }
    
    <span class="keyword">this</span>.<span class="variable">isDestroyed</span> = <span class="keyword">true</span>;
  }
}

<span class="keyword">const</span> <span class="function">initializeWidget</span> = <span class="keyword">async</span> () => {
  <span class="keyword">const</span> <span class="variable">eventManager</span> = <span class="keyword">new</span> <span class="function">EventManager</span>();
  
  <span class="comment">// All listeners tracked and managed centrally</span>
  <span class="keyword">const</span> <span class="variable">mobileListenerId</span> = eventManager.<span class="function">addMediaQuery</span>(
    <span class="string">'(max-width: 450px)'</span>,
    <span class="function">handleMobileView</span>
  );
  
  <span class="keyword">const</span> <span class="variable">resizeListenerId</span> = eventManager.<span class="function">addEventListener</span>(
    window,
    <span class="string">'resize'</span>,
    <span class="function">handleResize</span>
  );
  
  <span class="keyword">const</span> <span class="variable">visibilityListenerId</span> = eventManager.<span class="function">addEventListener</span>(
    document,
    <span class="string">'visibilitychange'</span>,
    <span class="function">handleVisibilityChange</span>
  );
  
  <span class="comment">// Guaranteed cleanup even on errors</span>
  <span class="keyword">return</span> () => {
    eventManager.<span class="function">destroy</span>();
  };
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents memory leaks from orphaned event listeners</li>
                            <li>Automatic cleanup on component unmount and errors</li>
                            <li>Centralized event management for better debugging and monitoring</li>
                            <li>Error boundaries prevent handler failures from affecting cleanup</li>
                            <li>Comprehensive tracking of all event listeners in the application</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement a centralized event manager with automatic cleanup, add error boundaries to ensure cleanup even on component errors, and track all event listeners.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Apollo Cache Growth</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The Apollo cache can grow indefinitely without proper eviction policies, especially with long-running chat sessions and message subscriptions.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/apollo-cache-monitor.js:233-244
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement proper cache eviction policies with size monitoring and automatic cleanup.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Unbounded Cache)</div>
                                <div class="code-block">
<pre><span class="comment">// LEAK: Cache size can grow indefinitely</span>
<span class="keyword">const</span> <span class="variable">cacheConfig</span> = {
  <span class="variable">typePolicies</span>: {
    <span class="variable">Query</span>: {
      <span class="variable">fields</span>: {
        <span class="variable">chats</span>: {
          <span class="function">merge</span>: (existing, incoming) => incoming
        }
      }
    }
  },
  <span class="comment">// 10MB limit not enforced</span>
  <span class="variable">cacheSize</span>: <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">10</span>,
  <span class="comment">// Not properly implemented</span>
  <span class="variable">evictionPolicy</span>: <span class="string">'lru'</span>
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Managed Cache)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Comprehensive cache management with eviction</span>
<span class="keyword">class</span> <span class="function">CacheManager</span> {
  <span class="keyword">constructor</span>(maxSize = <span class="number">50</span> * <span class="number">1024</span> * <span class="number">1024</span>) { <span class="comment">// 50MB default</span>
    <span class="keyword">this</span>.<span class="variable">maxSize</span> = maxSize;
    <span class="keyword">this</span>.<span class="variable">accessTimes</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">sizeCheckInterval</span> = <span class="keyword">null</span>;
  }
  
  <span class="function">createCache</span>() {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="function">InMemoryCache</span>({
      <span class="variable">typePolicies</span>: {
        <span class="variable">Query</span>: {
          <span class="variable">fields</span>: {
            <span class="variable">chats</span>: {
              <span class="function">merge</span>: <span class="keyword">this</span>.<span class="function">createMergeWithEviction</span>(<span class="string">'chats'</span>)
            },
            <span class="variable">messages</span>: {
              <span class="function">merge</span>: <span class="keyword">this</span>.<span class="function">createMergeWithEviction</span>(<span class="string">'messages'</span>)
            }
          },
          <span class="variable">Chat</span>: {
            <span class="variable">fields</span>: {
              <span class="variable">messages</span>: {
                <span class="function">merge</span>: <span class="keyword">this</span>.<span class="function">createMessageMergeWithEviction</span>()
              }
            }
          }
        }
      },
      <span class="variable">possibleTypes</span>: possibleTypes,
      <span class="function">addTypename</span>: <span class="keyword">true</span>
    });
  }
  
  <span class="function">createMergeWithEviction</span>(field) {
    <span class="keyword">return</span> (existing, incoming, { cache, readField }) => {
      <span class="comment">// Update access times</span>
      <span class="keyword">if</span> (incoming) {
        incoming.<span class="function">forEach</span>(item => {
          <span class="keyword">this</span>.<span class="variable">accessTimes</span>.<span class="function">set</span>(
            <span class="string">`${field}-${readField('id', item)}`</span>,
            Date.<span class="function">now</span>()
          );
        });
      }
      
      <span class="comment">// Check cache size and evict if necessary</span>
      <span class="keyword">this</span>.<span class="function">checkAndEvict</span>(cache, field);
      
      <span class="keyword">return</span> incoming;
    };
  }
  
  <span class="function">createMessageMergeWithEviction</span>() {
    <span class="keyword">return</span> (existing, incoming, { cache, readField }) => {
      <span class="keyword">if</span> (!incoming) <span class="keyword">return</span> existing;
      
      <span class="keyword">const</span> <span class="variable">chatId</span> = readField(<span class="string">'id'</span>);
      <span class="keyword">const</span> <span class="variable">merged</span> = existing ? [...existing] : [];
      
      <span class="comment">// Add new messages</span>
      incoming.<span class="function">forEach</span>(message => {
        <span class="keyword">const</span> <span class="variable">messageId</span> = readField(<span class="string">'id'</span>, message);
        <span class="keyword">const</span> <span class="variable">existingIndex</span> = merged.<span class="function">findIndex</span>(
          m => readField(<span class="string">'id'</span>, m) === messageId
        );
        
        <span class="keyword">if</span> (existingIndex >= <span class="number">0</span>) {
          merged[existingIndex] = message;
        } <span class="keyword">else</span> {
          merged.<span class="function">push</span>(message);
        }
        
        <span class="comment">// Track access time</span>
        <span class="keyword">this</span>.<span class="variable">accessTimes</span>.<span class="function">set</span>(
          <span class="string">`message-${messageId}`</span>,
          Date.<span class="function">now</span>()
        );
      });
      
      <span class="comment">// Keep only last 100 messages per chat</span>
      <span class="keyword">if</span> (merged.<span class="variable">length</span> > <span class="number">100</span>) {
        <span class="keyword">return</span> merged.<span class="function">slice</span>(-<span class="number">100</span>);
      }
      
      <span class="keyword">return</span> merged;
    };
  }
  
  <span class="function">checkAndEvict</span>(cache, field) {
    <span class="keyword">const</span> <span class="variable">currentSize</span> = <span class="keyword">this</span>.<span class="function">estimateCacheSize</span>(cache);
    
    <span class="keyword">if</span> (currentSize > <span class="keyword">this</span>.<span class="variable">maxSize</span>) {
      <span class="comment">// Sort by access time (LRU)</span>
      <span class="keyword">const</span> <span class="variable">sortedItems</span> = Array.<span class="function">from</span>(<span class="keyword">this</span>.<span class="variable">accessTimes</span>.<span class="function">entries</span>())
        .<span class="function">sort</span>(([, a], [, b]) => a - b);
      
      <span class="comment">// Evict oldest 20% of items</span>
      <span class="keyword">const</span> <span class="variable">toEvict</span> = Math.<span class="function">floor</span>(sortedItems.<span class="variable">length</span> * <span class="number">0.2</span>);
      
      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < toEvict; i++) {
        <span class="keyword">const</span> [key] = sortedItems[i];
        <span class="keyword">const</span> [type, id] = key.<span class="function">split</span>(<span class="string">'-'</span>);
        
        <span class="keyword">try</span> {
          cache.<span class="function">evict</span>({
            <span class="variable">id</span>: <span class="function">cache</span>.<span class="function">identify</span>({ <span class="function">__typename</span>: type, <span class="variable">id</span> })
          });
          <span class="keyword">this</span>.<span class="variable">accessTimes</span>.<span class="function">delete</span>(key);
        } <span class="keyword">catch</span> (error) {
          console.<span class="function">warn</span>(<span class="string">'Failed to evict cache item:'</span>, error);
        }
      }
    }
  }
  
  <span class="function">estimateCacheSize</span>(cache) {
    <span class="comment">// Rough estimation of cache size in bytes</span>
    <span class="keyword">const</span> <span class="variable">data</span> = cache.<span class="function">extract</span>();
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="function">Blob</span>([JSON.<span class="function">stringify</span>(data)]).<span class="variable">size</span>;
  }
  
  <span class="function">startMonitoring</span>(cache) {
    <span class="comment">// Check cache size every 5 minutes</span>
    <span class="keyword">this</span>.<span class="variable">sizeCheckInterval</span> = <span class="function">setInterval</span>(() => {
      <span class="keyword">this</span>.<span class="function">checkAndEvict</span>(cache);
    }, <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>);
  }
  
  <span class="function">stopMonitoring</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="variable">sizeCheckInterval</span>) {
      <span class="function">clearInterval</span>(<span class="keyword">this</span>.<span class="variable">sizeCheckInterval</span>);
      <span class="keyword">this</span>.<span class="variable">sizeCheckInterval</span> = <span class="keyword">null</span>;
    }
  }
}

<span class="keyword">const</span> <span class="variable">cacheManager</span> = <span class="keyword">new</span> <span class="function">CacheManager</span>();
<span class="keyword">const</span> <span class="variable">cache</span> = cacheManager.<span class="function">createCache</span>();
cacheManager.<span class="function">startMonitoring</span>(cache);</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents memory exhaustion from unbounded cache growth</li>
                            <li>Automatic LRU eviction keeps cache size manageable</li>
                            <li>Time-based and size-based eviction policies</li>
                            <li>Real-time cache monitoring and cleanup</li>
                            <li>Improved application performance and stability</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement proper cache eviction policies, add cache size monitoring with automatic cleanup, and consider time-based cache invalidation for chat messages.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">React Component Memory Retention</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Some React components retain references to large objects in state and closures, preventing garbage collection.
                </div>
                <div class="issue-location">
                    üìÅ src/hooks/useChatMonitor.js:8-11
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement cleanup for state containers and use weak references where appropriate.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Memory Retention)</div>
                                <div class="code-block">
<pre><span class="comment">// LEAK: Sets and refs can grow indefinitely</span>
<span class="keyword">const</span> <span class="function">useChatMonitor</span> = () => {
  <span class="comment">// These containers grow forever and never get cleaned up</span>
  <span class="keyword">const</span> [<span class="variable">msgsCreated</span>, setMsgsCreated] = <span class="function">useState</span>(<span class="keyword">new</span> <span class="function">Set</span>());
  <span class="keyword">const</span> <span class="variable">msgsRef</span> = <span class="function">useRef</span>(<span class="keyword">new</span> <span class="function">Set</span>());
  
  <span class="keyword">const</span> <span class="function">trackMessage</span> = (messageId) => {
    <span class="comment">// Adding to sets without any cleanup mechanism</span>
    msgsRef.current.<span class="function">add</span>(messageId);
    setMsgsCreated(<span class="keyword">new</span> <span class="function">Set</span>(msgsRef.current));
  };
  
  <span class="comment">// Never cleared - will grow indefinitely</span>
  <span class="keyword">return</span> { <span class="variable">msgsCreated</span>, <span class="function">trackMessage</span> };
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Proper Memory Management)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Memory-efficient monitoring with cleanup</span>
<span class="keyword">const</span> <span class="function">useChatMonitor</span> = () => {
  <span class="keyword">const</span> <span class="variable">msgsRef</span> = <span class="function">useRef</span>(<span class="keyword">new</span> <span class="function">WeakSet</span>()); <span class="comment">// WeakSet for GC</span>
  <span class="keyword">const</span> [<span class="variable">activeMessages</span>, setActiveMessages] = <span class="function">useState</span>(<span class="keyword">new</span> <span class="function">Set</span>());
  <span class="keyword">const</span> <span class="variable">cleanupInterval</span> = <span class="function">useRef</span>(<span class="keyword">null</span>);
  
  <span class="keyword">const</span> <span class="function">trackMessage</span> = <span class="function">useCallback</span>((messageId) => {
    <span class="keyword">const</span> <span class="variable">messageObj</span> = { <span class="variable">id</span>: messageId, <span class="variable">timestamp</span>: Date.<span class="function">now</span>() };
    
    <span class="comment">// Use WeakSet for automatic garbage collection</span>
    msgsRef.current.<span class="function">add</span>(messageObj);
    
    <span class="comment">// Keep only active messages in state</span>
    setActiveMessages(<span class="variable">prev</span> => {
      <span class="keyword">const</span> <span class="variable">updated</span> = <span class="keyword">new</span> <span class="function">Set</span>(prev);
      updated.<span class="function">add</span>(messageId);
      
      <span class="comment">// Limit to 1000 most recent messages</span>
      <span class="keyword">if</span> (updated.<span class="variable">size</span> > <span class="number">1000</span>) {
        <span class="keyword">const</span> <span class="variable">toArray</span> = Array.<span class="function">from</span>(updated);
        <span class="keyword">const</span> <span class="variable">recent</span> = toArray
          .<span class="function">map</span>(id => ({ <span class="variable">id</span>, <span class="variable">timestamp</span>: <span class="function">getMessageTimestamp</span>(id) }))
          .<span class="function">sort</span>((a, b) => b.<span class="variable">timestamp</span> - a.<span class="variable">timestamp</span>)
          .<span class="function">slice</span>(<span class="number">0</span>, <span class="number">1000</span>)
          .<span class="function">map</span>(item => item.<span class="variable">id</span>);
        
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="function">Set</span>(recent);
      }
      
      <span class="keyword">return</span> updated;
    });
  }, []);
  
  <span class="keyword">const</span> <span class="function">cleanupOldMessages</span> = <span class="function">useCallback</span>(() => {
    <span class="keyword">const</span> <span class="variable">cutoffTime</span> = Date.<span class="function">now</span>() - (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>); <span class="comment">// 24 hours ago</span>
    
    setActiveMessages(<span class="variable">prev</span> => {
      <span class="keyword">const</span> <span class="variable">filtered</span> = <span class="keyword">new</span> <span class="function">Set</span>();
      
      <span class="keyword">for</span> (<span class="keyword">const</span> messageId <span class="keyword">of</span> prev) {
        <span class="keyword">const</span> <span class="variable">timestamp</span> = <span class="function">getMessageTimestamp</span>(messageId);
        <span class="keyword">if</span> (timestamp > cutoffTime) {
          filtered.<span class="function">add</span>(messageId);
        }
      }
      
      <span class="keyword">return</span> filtered;
    });
  }, []);
  
  <span class="comment">// Set up periodic cleanup</span>
  <span class="function">useEffect</span>(() => {
    cleanupInterval.current = <span class="function">setInterval</span>(<span class="function">cleanupOldMessages</span>, <span class="number">60000</span>); <span class="comment">// Every minute</span>
    
    <span class="keyword">return</span> () => {
      <span class="keyword">if</span> (cleanupInterval.current) {
        <span class="function">clearInterval</span>(cleanupInterval.current);
      }
    };
  }, [cleanupOldMessages]);
  
  <span class="comment">// Cleanup on unmount</span>
  <span class="function">useEffect</span>(() => {
    <span class="keyword">return</span> () => {
      <span class="comment">// Clear all references to help GC</span>
      msgsRef.current = <span class="keyword">new</span> <span class="function">WeakSet</span>();
      setActiveMessages(<span class="keyword">new</span> <span class="function">Set</span>());
      
      <span class="keyword">if</span> (cleanupInterval.current) {
        <span class="function">clearInterval</span>(cleanupInterval.current);
      }
    };
  }, []);
  
  <span class="keyword">return</span> { 
    <span class="variable">activeMessages</span>, 
    <span class="function">trackMessage</span>,
    <span class="function">cleanupOldMessages</span>
  };
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents memory leaks from unbounded state containers</li>
                            <li>WeakSet allows automatic garbage collection of unused objects</li>
                            <li>Periodic cleanup removes old data automatically</li>
                            <li>Limited state size prevents memory exhaustion</li>
                            <li>Proper cleanup on component unmount</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement cleanup for state containers, use weak references where appropriate, and add memory usage monitoring for development.</p>
                </div>
            </div>
        </section>

        <section id="bug-fixes" class="section">
            <h2>
                <span class="section-icon">üêõ</span>
                Critical Bug Fixes
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Race Condition in Chat Creation</div>
                        <div class="issue-meta">
                            <span class="badge badge-critical">Critical</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Multiple simultaneous chat creation requests can lead to race conditions where messages are created for the wrong chat or duplicate messages are sent.
                </div>
                <div class="issue-location">
                    üìÅ src/hooks/useChatMonitor.js:38-63
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement request deduplication and optimistic locking for chat creation with atomic operations.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Race Condition)</div>
                                <div class="code-block">
<pre><span class="comment">// BUG: Race condition in message creation</span>
<span class="keyword">const</span> <span class="function">handleNewChat</span> = <span class="keyword">async</span> (chat) => {
  <span class="comment">// Check if message already created for this chat</span>
  <span class="keyword">if</span> (!msgsRef.current.<span class="function">has</span>(chat.<span class="variable">id</span>)) {
    msgsRef.current.<span class="function">add</span>(chat.<span class="variable">id</span>); <span class="comment">// Mark immediately</span>
    
    <span class="comment">// But what if another request comes in before this completes?</span>
    <span class="keyword">try</span> {
      <span class="keyword">await</span> <span class="function">createMessage</span>({
        <span class="variable">chatId</span>: chat.<span class="variable">id</span>,
        <span class="variable">text</span>: <span class="string">'Hello! How can I help you today?'</span>,
        <span class="variable">author</span>: <span class="string">'agent'</span>
      });
    } <span class="keyword">catch</span> (error) {
      <span class="comment">// On error, we should remove the mark but don't</span>
      console.<span class="function">error</span>(<span class="string">'Failed to create message'</span>, error);
    }
  }
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Atomic Operations)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Request deduplication with optimistic locking</span>
<span class="keyword">class</span> <span class="function">ChatCreationManager</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">pendingRequests</span> = <span class="keyword">new</span> <span class="function">Map</span>(); <span class="comment">// chatId -> Promise</span>
    <span class="keyword">this</span>.<span class="variable">processingLocks</span> = <span class="keyword">new</span> <span class="function">Map</span>(); <span class="comment">// chatId -> lock</span>
  }
  
  <span class="keyword">async</span> <span class="function">createChatWithMessage</span>(chatData, messageData) {
    <span class="keyword">const</span> <span class="variable">chatId</span> = <span class="function">generateTempId</span>();
    
    <span class="comment">// Check if already processing this chat</span>
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="variable">pendingRequests</span>.<span class="function">has</span>(chatId)) {
      <span class="keyword">return</span> <span class="keyword">this</span>.<span class="variable">pendingRequests</span>.<span class="function">get</span>(chatId);
    }
    
    <span class="comment">// Create and acquire lock</span>
    <span class="keyword">const</span> <span class="variable">lock</span> = <span class="keyword">this</span>.<span class="function">acquireLock</span>(chatId);
    
    <span class="keyword">const</span> <span class="variable">creationPromise</span> = <span class="keyword">this</span>.<span class="function">executeCreation</span>(chatData, messageData, chatId, lock);
    
    <span class="comment">// Store promise for deduplication</span>
    <span class="keyword">this</span>.<span class="variable">pendingRequests</span>.<span class="function">set</span>(chatId, creationPromise);
    
    <span class="keyword">try</span> {
      <span class="keyword">const</span> <span class="variable">result</span> = <span class="keyword">await</span> creationPromise;
      <span class="keyword">return</span> result;
    } <span class="keyword">finally</span> {
      <span class="comment">// Cleanup regardless of success/failure</span>
      <span class="keyword">this</span>.<span class="variable">pendingRequests</span>.<span class="function">delete</span>(chatId);
      <span class="keyword">this</span>.<span class="function">releaseLock</span>(chatId, lock);
    }
  }
  
  <span class="keyword">async</span> <span class="function">executeCreation</span>(chatData, messageData, tempId, lock) {
    <span class="keyword">try</span> {
      <span class="comment">// Step 1: Create chat atomically</span>
      <span class="keyword">const</span> <span class="variable">chat</span> = <span class="keyword">await</span> api.<span class="function">createChat</span>({
        ...chatData,
        <span class="variable">tempId</span>,
        <span class="variable">lockId</span>: lock.<span class="variable">id</span>
      });
      
      <span class="comment">// Step 2: Create message with chat reference</span>
      <span class="keyword">const</span> <span class="variable">message</span> = <span class="keyword">await</span> api.<span class="function">createMessage</span>({
        ...messageData,
        <span class="variable">chatId</span>: chat.<span class="variable">id</span>,
        <span class="variable">lockId</span>: lock.<span class="variable">id</span>
      });
      
      <span class="comment">// Step 3: Update local state atomically</span>
      <span class="keyword">await</span> <span class="keyword">this</span>.<span class="function">updateLocalState</span>(chat, message);
      
      <span class="keyword">return</span> { <span class="variable">chat</span>, <span class="variable">message</span> };
      
    } <span class="keyword">catch</span> (error) {
      <span class="comment">// Handle conflicts and retry if needed</span>
      <span class="keyword">if</span> (error.<span class="variable">code</span> === <span class="string">'CONFLICT'</span>) {
        <span class="keyword">const</span> <span class="variable">existingChat</span> = <span class="keyword">await</span> api.<span class="function">getChatByTempId</span>(tempId);
        <span class="keyword">if</span> (existingChat) {
          <span class="keyword">return</span> { <span class="variable">chat</span>: existingChat };
        }
      }
      
      <span class="keyword">throw</span> error;
    }
  }
  
  <span class="function">acquireLock</span>(resourceId) {
    <span class="keyword">const</span> <span class="variable">lockId</span> = <span class="function">generateId</span>();
    <span class="keyword">const</span> <span class="variable">lock</span> = {
      <span class="variable">id</span>: lockId,
      <span class="variable">resourceId</span>,
      <span class="variable">timestamp</span>: Date.<span class="function">now</span>(),
      <span class="variable">timeout</span>: <span class="number">30000</span> <span class="comment">// 30 seconds</span>
    };
    
    <span class="keyword">this</span>.<span class="variable">processingLocks</span>.<span class="function">set</span>(resourceId, lock);
    
    <span class="comment">// Auto-release lock after timeout</span>
    <span class="function">setTimeout</span>(() => {
      <span class="keyword">this</span>.<span class="function">releaseLock</span>(resourceId, lock);
    }, lock.<span class="variable">timeout</span>);
    
    <span class="keyword">return</span> lock;
  }
  
  <span class="function">releaseLock</span>(resourceId, lock) {
    <span class="keyword">const</span> <span class="variable">currentLock</span> = <span class="keyword">this</span>.<span class="variable">processingLocks</span>.<span class="function">get</span>(resourceId);
    <span class="keyword">if</span> (currentLock && currentLock.<span class="variable">id</span> === lock.<span class="variable">id</span>) {
      <span class="keyword">this</span>.<span class="variable">processingLocks</span>.<span class="function">delete</span>(resourceId);
    }
  }
}

<span class="keyword">const</span> <span class="variable">chatManager</span> = <span class="keyword">new</span> <span class="function">ChatCreationManager</span>();

<span class="keyword">const</span> <span class="function">handleNewChat</span> = <span class="keyword">async</span> (chat) => {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> result = <span class="keyword">await</span> chatManager.<span class="function">createChatWithMessage</span>(
      chat,
      {
        <span class="variable">text</span>: <span class="string">'Hello! How can I help you today?'</span>,
        <span class="variable">author</span>: <span class="string">'agent'</span>
      }
    );
    
    <span class="keyword">return</span> result;
  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">'Failed to create chat with message:'</span>, error);
    <span class="function">handleChatCreationError</span>(error);
  }
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Eliminates race conditions in chat creation</li>
                            <li>Prevents duplicate messages and wrong chat associations</li>
                            <li>Request deduplication reduces unnecessary API calls</li>
                            <li>Optimistic locking ensures data consistency</li>
                            <li>Automatic conflict resolution and retry mechanisms</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement request deduplication, add optimistic locking for chat creation, and ensure atomic operations for message creation.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Error Handling Gaps</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Critical error paths lack proper handling, especially in network failures and authentication errors, leading to broken UI states.
                </div>
                <div class="issue-location">
                    üìÅ src/App.js:307-315
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement comprehensive error boundaries with user-friendly error messages and retry mechanisms.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Poor Error Handling)</div>
                                <div class="code-block">
<pre><span class="comment">// BUG: Generic error handling</span>
<span class="keyword">const</span> <span class="function">handleLogin</span> = <span class="keyword">async</span> (credentials) => {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> result = <span class="keyword">await</span> loginMutation({
      <span class="variable">variables</span>: credentials
    });
    
    <span class="keyword">if</span> (result.<span class="variable">data</span>) {
      <span class="function">handleLoginSuccess</span>(result.<span class="variable">data</span>);
    }
  } <span class="keyword">catch</span> (e) {
    console.<span class="function">error</span>(<span class="string">"Login mutation failed"</span>, e);
    setLoginError(e); <span class="comment">// User sees technical error message</span>
  }
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Comprehensive Error Handling)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Comprehensive error handling with recovery</span>
<span class="keyword">class</span> <span class="function">ErrorHandler</span> {
  <span class="keyword">static</span> <span class="function">classifyError</span>(error) {
    <span class="keyword">if</span> (error.<span class="variable">networkError</span>) {
      <span class="keyword">return</span> {
        <span class="variable">type</span>: <span class="string">'NETWORK'</span>,
        <span class="variable">userMessage</span>: <span class="string">'Connection issue. Please check your internet and try again.'</span>,
        <span class="variable">canRetry</span>: <span class="keyword">true</span>,
        <span class="variable">retryDelay</span>: <span class="number">2000</span>
      };
    }
    
    <span class="keyword">if</span> (error.<span class="variable">graphQLErrors</span>) {
      <span class="keyword">const</span> <span class="variable">gqlError</span> = error.<span class="variable">graphQLErrors</span>[<span class="number">0</span>];
      
      <span class="keyword">switch</span> (gqlError.<span class="variable">extensions</span>?.<span class="variable">code</span>) {
        <span class="keyword">case</span> <span class="string">'UNAUTHENTICATED'</span>:
          <span class="keyword">return</span> {
            <span class="variable">type</span>: <span class="string">'AUTH'</span>,
            <span class="variable">userMessage</span>: <span class="string">'Please log in to continue.'</span>,
            <span class="variable">canRetry</span>: <span class="keyword">false</span>,
            <span class="variable">action</span>: <span class="string">'redirect_to_login'</span>
          };
        <span class="keyword">case</span> <span class="string">'FORBIDDEN'</span>:
          <span class="keyword">return</span> {
            <span class="variable">type</span>: <span class="string">'PERMISSION'</span>,
            <span class="variable">userMessage</span>: <span class="string">'You don\'t have permission to perform this action.'</span>,
            <span class="variable">canRetry</span>: <span class="keyword">false</span>
          };
        <span class="keyword">case</span> <span class="string">'RATE_LIMITED'</span>:
          <span class="keyword">return</span> {
            <span class="variable">type</span>: <span class="string">'RATE_LIMIT'</span>,
            <span class="variable">userMessage</span>: <span class="string">'Too many attempts. Please wait a moment and try again.'</span>,
            <span class="variable">canRetry</span>: <span class="keyword">true</span>,
            <span class="variable">retryDelay</span>: gqlError.<span class="variable">extensions</span>?.<span class="variable">retryAfter</span> * <span class="number">1000</span> || <span class="number">60000</span>
          };
        <span class="keyword">default</span>:
          <span class="keyword">return</span> {
            <span class="variable">type</span>: <span class="string">'SERVER'</span>,
            <span class="variable">userMessage</span>: <span class="string">'Something went wrong. Please try again.'</span>,
            <span class="variable">canRetry</span>: <span class="keyword">true</span>,
            <span class="variable">retryDelay</span>: <span class="number">3000</span>
          };
      }
    }
    
    <span class="keyword">return</span> {
      <span class="variable">type</span>: <span class="string">'UNKNOWN'</span>,
      <span class="variable">userMessage</span>: <span class="string">'An unexpected error occurred.'</span>,
      <span class="variable">canRetry</span>: <span class="keyword">false</span>
    };
  }
}

<span class="keyword">const</span> <span class="function">handleLogin</span> = <span class="keyword">async</span> (credentials) => {
  <span class="keyword">const</span> [<span class="variable">retryCount</span>, setRetryCount] = <span class="function">useState</span>(<span class="number">0</span>);
  <span class="keyword">const</span> [<span class="variable">isRetrying</span>, setIsRetrying] = <span class="function">useState</span>(<span class="keyword">false</span>);
  
  <span class="keyword">const</span> <span class="function">executeLogin</span> = <span class="function">useCallback</span>(<span class="keyword">async</span> () => {
    <span class="keyword">try</span> {
      setIsRetrying(<span class="keyword">true</span>);
      setLoginError(<span class="keyword">null</span>);
      
      <span class="keyword">const</span> result = <span class="keyword">await</span> loginMutation({
        <span class="variable">variables</span>: credentials,
        <span class="variable">errorPolicy</span>: <span class="string">'all'</span>
      });
      
      <span class="keyword">if</span> (result.<span class="variable">data</span>?.<span class="variable">login</span>) {
        <span class="function">handleLoginSuccess</span>(result.<span class="variable">data</span>.<span class="variable">login</span>);
        setRetryCount(<span class="number">0</span>);
      } <span class="keyword">else</span> <span class="keyword">if</span> (result.<span class="variable">errors</span>) {
        <span class="keyword">const</span> <span class="variable">classification</span> = ErrorHandler.<span class="function">classifyError</span>({ <span class="variable">graphQLErrors</span>: result.<span class="variable">errors</span> });
        
        <span class="keyword">if</span> (classification.<span class="variable">type</span> === <span class="string">'AUTH'</span>) {
          <span class="function">redirectToLogin</span>();
        } <span class="keyword">else</span> <span class="keyword">if</span> (classification.<span class="variable">type</span> === <span class="string">'RATE_LIMIT'</span>) {
          setLoginError({
            <span class="variable">message</span>: classification.<span class="variable">userMessage</span>,
            <span class="variable">canRetry</span>: <span class="keyword">true</span>,
            <span class="variable">retryDelay</span>: classification.<span class="variable">retryDelay</span>
          });
        } <span class="keyword">else</span> {
          setLoginError({
            <span class="variable">message</span>: classification.<span class="variable">userMessage</span>,
            <span class="variable">canRetry</span>: classification.<span class="variable">canRetry</span>
          });
        }
      }
      
    } <span class="keyword">catch</span> (error) {
      <span class="keyword">const</span> <span class="variable">classification</span> = ErrorHandler.<span class="function">classifyError</span>(error);
      
      setLoginError({
        <span class="variable">message</span>: classification.<span class="variable">userMessage</span>,
        <span class="variable">canRetry</span>: classification.<span class="variable">canRetry</span>,
        <span class="variable">retryDelay</span>: classification.<span class="variable">retryDelay</span>
      });
      
      <span class="comment">// Log technical details for debugging</span>
      console.<span class="function">error</span>(<spa

<span class="comment">// Object recreation on every render causes infinite loop</span></pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Stable Dependencies)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Stable dependencies with proper state management</span>
<span class="keyword">const</span> <span class="function">retryLogin</span> = <span class="function">useCallback</span>(<span class="keyword">async</span> () => {
  <span class="keyword">if</span> (isLoggingIn) <span class="keyword">return</span>;
  
  <span class="keyword">try</span> {
    setIsLoggingIn(<span class="keyword">true</span>);
    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="function">attemptLogin</span>();
    
    <span class="keyword">if</span> (result.<span class="variable">success</span>) {
      setWebsiteId(result.<span class="variable">websiteId</span>);
      setLoginError(<span class="keyword">null</span>);
    } <span class="keyword">else</span> {
      setLoginError(result.<span class="variable">error</span>);
    }
  } <span class="keyword">catch</span> (error) {
    setLoginError(error);
  } <span class="keyword">finally</span> {
    setIsLoggingIn(<span class="keyword">false</span>);
  }
}, [isLoggingIn]); <span class="comment">// Stable dependency</span>

<span class="comment">// Use state machine to prevent infinite loops</span>
<span class="keyword">const</span> [<span class="variable">authState</span>, setAuthState] = <span class="function">useState</span>(<span class="string">'idle'</span>);

<span class="function">useEffect</span>(() => {
  <span class="keyword">if</span> (showCreate && authState === <span class="string">'idle'</span> && !websiteId && !isLoggingIn && !loginError) {
    setAuthState(<span class="string">'retrying'</span>);
    <span class="function">retryLogin</span>();
  }
}, [showCreate, websiteId, isLoggingIn, loginError, retryLogin, authState]);

<span class="comment">// For object dependencies, use useMemo</span>
<span class="keyword">const</span> <span class="variable">widgetConfig</span> = <span class="function">useMemo</span>(() => ({
  <span class="variable">theme</span>,
  <span class="variable">language</span>,
  <span class="variable">features</span>
}), [theme, language, features]);

<span class="function">useEffect</span>(() => {
  <span class="function">updateWidgetConfig</span>(widgetConfig);
}, [widgetConfig]); <span class="comment">// Stable object reference</span></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents infinite re-renders that crash the application</li>
                            <li>Stable dependencies ensure effects run only when needed</li>
                            <li>State machine pattern provides predictable behavior</li>
                            <li>useMemo prevents unnecessary object recreations</li>
                            <li>Improved performance and reduced CPU usage</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Review all useEffect dependencies, use useCallback for functions, and implement proper state management to prevent loops.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Storage Fallback Issues</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Storage fallback mechanisms can lead to data inconsistency and security issues when secure storage fails.
                </div>
                <div class="issue-location">
                    üìÅ src/utils/crypto.js:292-299
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement proper error handling for storage failures with user notifications and secure fallback strategies.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Insecure Fallback)</div>
                                <div class="code-block">
<pre><span class="comment">// BUG: Silent fallback to insecure storage</span>
<span class="keyword">const</span> <span class="function">storeToken</span> = <span class="keyword">async</span> (token) => {
  <span class="keyword">try</span> {
    <span class="keyword">await</span> secureStore.<span class="function">set</span>(<span class="string">'token'</span>, token);
  } <span class="keyword">catch</span> (storageError) {
    console.<span class="function">error</span>(<span class="string">'Failed to store token securely, using fallback:'</span>, storageError);
    store(<span class="string">'token'</span>, token); <span class="comment">// Falls back to insecure storage</span>
  }
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Secure Error Handling)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Proper error handling with secure fallbacks</span>
<span class="keyword">class</span> <span class="function">SecureStorageManager</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">storageOptions</span> = [
      { <span class="variable">name</span>: <span class="string">'secureStorage'</span>, <span class="variable">secure</span>: <span class="keyword">true</span>, <span class="variable">persistent</span>: <span class="keyword">true</span> },
      { <span class="variable">name</span>: <span class="string">'sessionStorage'</span>, <span class="variable">secure</span>: <span class="keyword">false</span>, <span class="variable">persistent</span>: <span class="keyword">false</span> },
      { <span class="variable">name</span>: <span class="variable">memory</span>, <span class="variable">secure</span>: <span class="keyword">false</span>, <span class="variable">persistent</span>: <span class="keyword">false</span> }
    ];
  }
  
  <span class="keyword">async</span> <span class="function">storeSecure</span>(key, value, options = {}) {
    <span class="keyword">const</span> <span class="variable">errors</span> = [];
    
    <span class="keyword">for</span> (<span class="keyword">const</span> storage <span class="keyword">of</span> <span class="keyword">this</span>.<span class="variable">storageOptions</span>) {
      <span class="keyword">try</span> {
        <span class="keyword">if</span> (storage.<span class="variable">name</span> === <span class="string">'secureStorage'</span>) {
          <span class="keyword">await</span> <span class="keyword">this</span>.<span class="function">storeWithEncryption</span>(key, value);
        } <span class="keyword">else</span> <span class="keyword">if</span> (storage.<span class="variable">name</span> === <span class="string">'sessionStorage'</span>) {
          sessionStorage.<span class="function">setItem</span>(key, JSON.<span class="function">stringify</span>({ <span class="variable">value</span>, <span class="variable">timestamp</span>: Date.<span class="function">now</span>() }));
        } <span class="keyword">else</span> <span class="keyword">if</span> (storage.<span class="variable">name</span> === <span class="string">'memory'</span>) {
          <span class="keyword">this</span>.<span class="variable">memoryStore</span> = <span class="keyword">this</span>.<span class="variable">memoryStore</span> || <span class="keyword">new</span> <span class="function">Map</span>();
          <span class="keyword">this</span>.<span class="variable">memoryStore</span>.<span class="function">set</span>(key, { <span class="variable">value</span>, <span class="variable">timestamp</span>: Date.<span class="function">now</span>() });
        }
        
        <span class="comment">// Notify user about storage level used</span>
        <span class="keyword">if</span> (!storage.<span class="variable">secure</span>) {
          <span class="keyword">this</span>.<span class="function">notifyStorageWarning</span>(storage.<span class="variable">name</span>);
        }
        
        <span class="keyword">return</span> { <span class="variable">success</span>: <span class="keyword">true</span>, <span class="variable">storage</span>: storage.<span class="variable">name</span>, <span class="variable">secure</span>: storage.<span class="variable">secure</span> };
        
      } <span class="keyword">catch</span> (error) {
        errors.<span class="function">push</span>({ <span class="variable">storage</span>: storage.<span class="variable">name</span>, <span class="variable">error</span> });
        <span class="keyword">continue</span>;
      }
    }
    
    <span class="comment">// All storage methods failed</span>
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">StorageError</span>(<span class="string">'All storage methods failed'</span>, errors);
  }
  
  <span class="function">notifyStorageWarning</span>(storageType) {
    <span class="keyword">const</span> <span class="variable">warnings</span> = {
      <span class="string">'sessionStorage'</span>: <span class="string">'Using temporary storage. Data will be lost when browser closes.'</span>,
      <span class="string">'memory'</span>: <span class="string">'Using memory storage. Data will be lost when page refreshes.'</span>
    };
    
    <span class="comment">// Show user-friendly warning</span>
    <span class="function">showNotification</span>({
      <span class="variable">type</span>: <span class="string">'warning'</span>,
      <span class="variable">message</span>: warnings[storageType] || <span class="string">'Using limited storage mode.'</span>,
      <span class="variable">duration</span>: <span class="number">5000</span>
    });
    
    <span class="comment">// Log for monitoring</span>
    console.<span class="function">warn</span>(<span class="string">`Storage fallback activated: ${storageType}`</span>);
  }
  
  <span class="keyword">async</span> <span class="function">storeWithEncryption</span>(key, value) {
    <span class="keyword">const</span> <span class="variable">encrypted</span> = <span class="keyword">await</span> <span class="keyword">this</span>.<span class="function">encryptData</span>(value);
    <span class="keyword">await</span> secureStore.<span class="function">set</span>(key, encrypted);
  }
}

<span class="keyword">const</span> <span class="variable">storageManager</span> = <span class="keyword">new</span> <span class="function">SecureStorageManager</span>();

<span class="keyword">const</span> <span class="function">storeToken</span> = <span class="keyword">async</span> (token) => {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> result = <span class="keyword">await</span> storageManager.<span class="function">storeSecure</span>(<span class="string">'authToken'</span>, token);
    
    <span class="keyword">if</span> (!result.<span class="variable">secure</span>) {
      <span class="comment">// Implement additional security measures for non-secure storage</span>
      <span class="function">implementSessionSecurity</span>();
    }
    
    <span class="keyword">return</span> result;
  } <span class="keyword">catch</span> (error) {
    <span class="comment">// Handle complete storage failure</span>
    <span class="function">handleStorageFailure</span>(error);
    <span class="keyword">throw</span> error;
  }
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents silent fallback to insecure storage</li>
                            <li>User notifications about storage limitations</li>
                            <li>Graceful degradation with multiple fallback options</li>
                            <li>Security monitoring and logging for storage issues</li>
                            <li>Additional security measures when using non-secure storage</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement proper error handling for storage failures, add user notifications for security issues, and consider session-only storage as fallback.</p>
                </div>
            </div>
        </section>

        <section id="architecture-improvements" class="section">
            <h2>
                <span class="section-icon">üèóÔ∏è</span>
                Architecture Improvements
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Monolithic Widget Structure</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The widget is built as a single monolithic bundle, making it difficult to optimize loading and maintain code separation.
                </div>
                <div class="issue-location">
                    üìÅ vite.config.js:222-227
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement code splitting with dynamic imports and create separate bundles for core functionality and features.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Monolithic Bundle)</div>
                                <div class="code-block">
<pre><span class="comment">// ISSUE: Single bundle approach</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="function">defineConfig</span>({
  <span class="variable">build</span>: {
    <span class="variable">lib</span>: {
      <span class="variable">entry</span>: <span class="function">resolve</span>(__dirname, <span class="string">'src/widget.js'</span>),
      <span class="variable">name</span>: <span class="string">'ChatWidget'</span>,
      <span class="variable">formats</span>: [<span class="string">'umd'</span>], <span class="comment">// Only UMD format</span>
      <span class="variable">fileName</span>: () => <span class="string">`widget.js`</span> <span class="comment">// Fixed filename without hash</span>
    }
  }
});</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Code Splitting)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Modular architecture with code splitting</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="function">defineConfig</span>({
  <span class="variable">build</span>: {
    <span class="variable">lib</span>: {
      <span class="variable">entry</span>: {
        <span class="comment">// Core functionality - always loaded</span>
        <span class="variable">core</span>: <span class="function">resolve</span>(__dirname, <span class="string">'src/core/index.js'</span>),
        
        <span class="comment">// Feature modules - loaded on demand</span>
        <span class="variable">chat</span>: <span class="function">resolve</span>(__dirname, <span class="string">'src/features/chat/index.js'</span>),
        <span class="variable">file-upload</span>: <span class="function">resolve</span>(__dirname, <span class="string">'src/features/file-upload/index.js'</span>),
        <span class="variable">voice-messages</span>: <span class="function">resolve</span>(__dirname, <span class="string">'src/features/voice-messages/index.js'</span>),
        <span class="variable">analytics</span>: <span class="function">resolve</span>(__dirname, <span class="string">'src/features/analytics/index.js'</span>)
      },
      <span class="variable">name</span>: <span class="string">'ChatWidget'</span>,
      <span class="variable">formats</span>: [<span class="string">'es'</span>, <span class="string">'umd'</span>],
      <span class="variable">fileName</span>: (format, entryName) => {
        <span class="comment">// Content hash for cache busting</span>
        <span class="keyword">const</span> <span class="variable">hash</span> = <span class="function">generateContentHash</span>(entryName);
        <span class="keyword">return</span> <span class="string">`${entryName}.${format}.${hash}.js`</span>;
      }
    },
    <span class="variable">rollupOptions</span>: {
      <span class="variable">output</span>: {
        <span class="variable">manualChunks</span>: {
          <span class="comment">// Vendor chunks for better caching</span>
          <span class="string">'vendor-react'</span>: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>],
          <span class="string">'vendor-apollo'</span>: [<span class="string">'@apollo/client'</span>, <span class="string">'graphql'</span>],
          <span class="string">'vendor-ui'</span>: [<span class="string">'styled-components'</span>, <span class="string">'formik'</span>]
        }
      }
    }
  },
  <span class="variable">plugins</span>: [
    <span class="comment">// Dynamic import optimization</span>
    {
      <span class="variable">name</span>: <span class="string">'dynamic-imports'</span>,
      <span class="function">generateBundle</span>(options, bundle) {
        <span class="comment">// Generate manifest for dynamic loading</span>
        <span class="keyword">const</span> <span class="variable">manifest</span> = {};
        
        <span class="keyword">for</span> (<span class="keyword">const</span> [fileName, chunk] <span class="keyword">of</span> Object.<span class="function">entries</span>(bundle)) {
          <span class="keyword">if</span> (chunk.<span class="variable">type</span> === <span class="string">'chunk'</span>) {
            manifest[chunk.<span class="variable">name</span>] = {
              <span class="variable">file</span>: fileName,
              <span class="variable">imports</span>: chunk.<span class="variable">imports</span>,
              <span class="variable">size</span>: chunk.<span class="variable">codeLength</span>
            };
          }
        }
        
        <span class="keyword">this</span>.<span class="function">emitFile</span>({
          <span class="variable">type</span>: <span class="string">'asset'</span>,
          <span class="variable">fileName</span>: <span class="string">'manifest.json'</span>,
          <span class="variable">source</span>: JSON.<span class="function">stringify</span>(manifest, <span class="keyword">null</span>, <span class="number">2</span>)
        });
      }
    }
  ]
});

<span class="comment">// Dynamic loading system</span>
<span class="keyword">class</span> <span class="function">ModuleLoader</span> {
  <span class="keyword">constructor</span>(baseUrl) {
    <span class="keyword">this</span>.<span class="variable">baseUrl</span> = baseUrl;
    <span class="keyword">this</span>.<span class="variable">cache</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">manifest</span> = <span class="keyword">null</span>;
  }
  
  <span class="keyword">async</span> <span class="function">loadManifest</span>() {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.<span class="variable">manifest</span>) {
      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">`${this.baseUrl}/manifest.json`</span>);
      <span class="keyword">this</span>.<span class="variable">manifest</span> = <span class="keyword">await</span> response.<span class="function">json</span>();
    }
    <span class="keyword">return</span> <span class="keyword">this</span>.<span class="variable">manifest</span>;
  }
  
  <span class="keyword">async</span> <span class="function">loadModule</span>(moduleName) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="variable">cache</span>.<span class="function">has</span>(moduleName)) {
      <span class="keyword">return</span> <span class="keyword">this</span>.<span class="variable">cache</span>.<span class="function">get</span>(moduleName);
    }
    
    <span class="keyword">const</span> <span class="variable">manifest</span> = <span class="keyword">await</span> <span class="keyword">this</span>.<span class="function">loadManifest</span>();
    <span class="keyword">const</span> <span class="variable">moduleInfo</span> = manifest[moduleName];
    
    <span class="keyword">if</span> (!moduleInfo) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`Module ${moduleName} not found`</span>);
    }
    
    <span class="comment">// Load dependencies first</span>
    <span class="keyword">for</span> (<span class="keyword">const</span> dep <span class="keyword">of</span> moduleInfo.<span class="variable">imports</span>) {
      <span class="keyword">if</span> (!<span class="keyword">this</span>.<span class="variable">cache</span>.<span class="function">has</span>(dep)) {
        <span class="keyword">await</span> <span class="keyword">this</span>.<span class="function">loadModule</span>(dep);
      }
    }
    
    <span class="comment">// Load the module</span>
    <span class="keyword">const</span> <span class="variable">moduleUrl</span> = <span class="string">`${this.baseUrl}/${moduleInfo.file}`</span>;
    <span class="keyword">const</span> <span class="variable">module</span> = <span class="keyword">await</span> <span class="function">import</span>(moduleUrl);
    
    <span class="keyword">this</span>.<span class="variable">cache</span>.<span class="function">set</span>(moduleName, module);
    <span class="keyword">return</span> module;
  }
}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Faster initial load time with smaller core bundle</li>
                            <li>Progressive loading of features improves perceived performance</li>
                            <li>Better caching strategy with content hashes</li>
                            <li>Reduced bundle size for users who don't need all features</li>
                            <li>Independent deployment of feature modules</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement code splitting with dynamic imports, create separate bundles for core functionality and features, and add progressive loading capabilities.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Tight Coupling Between Components</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Components are tightly coupled with direct imports and shared state, making testing and maintenance difficult.
                </div>
                <div class="issue-location">
                    üìÅ src/App.js:1-352 (multiple direct imports)
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement dependency injection, create service layers for business logic, and use interfaces/protocols for component communication.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Tight Coupling)</div>
                                <div class="code-block">
<pre><span class="comment">// ISSUE: Tight coupling through direct imports</span>
<span class="keyword">import</span> LazyCreateChat <span class="keyword">from</span> <span class="string">'./utils/lazy-components'</span>;
<span class="keyword">import</span> { GET_CHAT } <span class="keyword">from</span> <span class="string">'./queries'</span>;
<span class="keyword">import</span> { processContractsForCurrentSession } <span class="keyword">from</span> <span class="string">'./utils'</span>;
<span class="keyword">import</span> { useAuth } <span class="keyword">from</span> <span class="string">'./hooks/useAuth'</span>;
<span class="keyword">import</span> { ChatService } <span class="keyword">from</span> <span class="string">'./services/ChatService'</span>;

<span class="keyword">const</span> <span class="function">App</span> = () => {
  <span class="keyword">const</span> { <span class="variable">user</span>, <span class="function">login</span> } = <span class="function">useAuth</span>();
  <span class="keyword">const</span> [<span class="variable">chats</span>, setChats] = <span class="function">useState</span>([]);
  
  <span class="comment">// Direct service usage creates tight coupling</span>
  <span class="keyword">const</span> <span class="function">handleCreateChat</span> = <span class="keyword">async</span> () => {
    <span class="keyword">const</span> <span class="variable">chatService</span> = <span class="keyword">new</span> <span class="function">ChatService</span>();
    <span class="keyword">const</span> <span class="variable">chat</span> = <span class="keyword">await</span> chatService.<span class="function">createChat</span>();
    setChats(<span class="variable">prev</span> => [...prev, chat]);
  };
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;LazyCreateChat</span> <span class="attr">onCreate</span>=<span class="punct">{</span>handleCreateChat<span class="punct">}</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Dependency Injection)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Decoupled architecture with dependency injection</span>

<span class="comment">// Service interfaces</span>
<span class="keyword">interface</span> <span class="function">IChatService</span> {
  <span class="function">createChat</span>(<span class="variable">config</span>: ChatConfig): <span class="keyword">async</span> <span class="function"><</span>Chat<span class="function">></span>;
  <span class="function">getChat</span>(<span class="variable">id</span>: string): <span class="keyword">async</span> <span class="function"><</span>Chat | null<span class="function">></span>;
  <span class="function">sendMessage</span>(<span class="variable">chatId</span>: string, <span class="variable">message</span>: Message): <span class="keyword">async</span> <span class="function"><</span>void<span class="function">></span>;
}

<span class="comment">// Service container for dependency injection</span>
<span class="keyword">class</span> <span class="function">ServiceContainer</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">services</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">singletons</span> = <span class="keyword">new</span> <span class="function">Map</span>();
  }
  
  <span class="function">register</span>(<span class="variable">name</span>, <span class="variable">factory</span>, options = {}) {
    <span class="keyword">this</span>.<span class="variable">services</span>.<span class="function">set</span>(name, { <span class="variable">factory</span>, ...options });
  }
  
  <span class="function">get</span>(<span class="variable">name</span>) {
    <span class="keyword">const</span> <span class="variable">service</span> = <span class="keyword">this</span>.<span class="variable">services</span>.<span class="function">get</span>(name);
    
    <span class="keyword">if</span> (!service) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`Service ${name} not found`</span>);
    }
    
    <span class="keyword">if</span> (service.<span class="variable">singleton</span>) {
      <span class="keyword">if</span> (!<span class="keyword">this</span>.<span class="variable">singletons</span>.<span class="function">has</span>(name)) {
        <span class="keyword">this</span>.<span class="variable">singletons</span>.<span class="function">set</span>(name, service.<span class="variable">factory</span>(<span class="keyword">this</span>));
      }
      <span class="keyword">return</span> <span class="keyword">this</span>.<span class="variable">singletons</span>.<span class="function">get</span>(name);
    }
    
    <span class="keyword">return</span> service.<span class="variable">factory</span>(<span class="keyword">this</span>);
  }
}

<span class="comment">// Event-driven communication</span>
<span class="keyword">class</span> <span class="function">EventBus</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">listeners</span> = <span class="keyword">new</span> <span class="function">Map</span>();
  }
  
  <span class="function">on</span>(<span class="variable">event</span>, <span class="variable">handler</span>) {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">has</span>(event)) {
      <span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">set</span>(event, []);
    }
    <span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">get</span>(event).<span class="function">push</span>(handler);
  }
  
  <span class="function">emit</span>(<span class="variable">event</span>, <span class="variable">data</span>) {
    <span class="keyword">const</span> <span class="variable">handlers</span> = <span class="keyword">this</span>.<span class="variable">listeners</span>.<span class="function">get</span>(event) || [];
    handlers.<span class="function">forEach</span>(handler => <span class="function">handler</span>(data));
  }
}

<span class="comment">// Decoupled component using injection</span>
<span class="keyword">const</span> <span class="function">App</span> = ({ <span class="variable">container</span>, <span class="variable">eventBus</span> }) => {
  <span class="keyword">const</span> [<span class="variable">chats</span>, setChats] = <span class="function">useState</span>([]);
  
  <span class="comment">// Inject services instead of direct imports</span>
  <span class="keyword">const</span> <span class="variable">chatService</span> = container.<span class="function">get</span>(<span class="string">'chatService'</span>);
  <span class="keyword">const</span> <span class="variable">authService</span> = container.<span class="function">get</span>(<span class="string">'authService'</span>);
  
  <span class="comment">// Listen to events instead of direct coupling</span>
  <span class="function">useEffect</span>(() => {
    <span class="keyword">const</span> <span class="function">handleChatCreated</span> = (chat) => {
      setChats(<span class="variable">prev</span> => [...prev, chat]);
    };
    
    eventBus.<span class="function">on</span>(<span class="string">'chat:created'</span>, <span class="function">handleChatCreated</span>);
    
    <span class="keyword">return</span> () => {
      eventBus.<span class="function">off</span>(<span class="string">'chat:created'</span>, <span class="function">handleChatCreated</span>);
    };
  }, [eventBus]);
  
  <span class="keyword">const</span> <span class="function">handleCreateChat</span> = <span class="keyword">async</span> () => {
    <span class="keyword">try</span> {
      <span class="keyword">const</span> <span class="variable">chat</span> = <span class="keyword">await</span> chatService.<span class="function">createChat</span>();
      <span class="comment">// Emit event instead of direct state manipulation</span>
      eventBus.<span class="function">emit</span>(<span class="string">'chat:created'</span>, chat);
    } <span class="keyword">catch</span> (error) {
      eventBus.<span class="function">emit</span>(<span class="string">'error'</span>, { <span class="variable">type</span>: <span class="string">'chat_creation'</span>, <span class="variable">error</span> });
    }
  };
  
  <span class="comment">// Lazy-loaded component through factory</span>
  <span class="keyword">const</span> <span class="variable">CreateChatComponent</span> = <span class="function">useLazyComponent</span>(() => 
    container.<span class="function">get</span>(<span class="string">'componentFactory'</span>).<span class="function">createCreateChat</span>()
  );
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;CreateChatComponent</span> <span class="attr">onCreate</span>=<span class="punct">{</span>handleCreateChat<span class="punct">}</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  );
};

<span class="comment">// Service registration</span>
<span class="keyword">const</span> <span class="variable">container</span> = <span class="keyword">new</span> <span class="function">ServiceContainer</span>();
<span class="keyword">const</span> <span class="variable">eventBus</span> = <span class="keyword">new</span> <span class="function">EventBus</span>();

container.<span class="function">register</span>(<span class="string">'chatService'</span>, () => <span class="keyword">new</span> <span class="function">ChatService</span>(), { <span class="variable">singleton</span>: <span class="keyword">true</span> });
container.<span class="function">register</span>(<span class="string">'authService'</span>, () => <span class="keyword">new</span> <span class="function">AuthService</span>(), { <span class="variable">singleton</span>: <span class="keyword">true</span> });
container.<span class="function">register</span>(<span class="string">'componentFactory'</span>, () => <span class="keyword">new</span> <span class="function">ComponentFactory</span>());</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Loose coupling enables easier testing and maintenance</li>
                            <li>Dependency injection allows better modularity and reusability</li>
                            <li>Event-driven architecture reduces direct dependencies</li>
                            <li>Service layer separation improves code organization</li>
                            <li>Mock services can be easily injected for testing</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement dependency injection, create service layers for business logic, and use interfaces/protocols for component communication.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Missing Error Boundaries</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">High</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The application lacks comprehensive error boundaries, making it vulnerable to component crashes affecting the entire widget.
                </div>
                <div class="issue-location">
                    üìÅ Throughout the application - missing error boundaries
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement error boundaries at multiple levels with error reporting and recovery mechanisms.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (No Error Boundaries)</div>
                                <div class="code-block">
<pre><span class="comment">// MISSING: Error boundaries around critical components</span>
<span class="keyword">const</span> <span class="function">App</span> = () => {
  <span class="keyword">const</span> [<span class="variable">error</span>, setError] = <span class="function">useState</span>(<span class="keyword">null</span>);
  
  <span class="keyword">if</span> (error) {
    <span class="keyword">return</span> <span class="tag">&lt;div&gt;</span>Something went wrong<span class="tag">&lt;/div&gt;</span>;
  }
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;ChatContainer</span> <span class="tag">/&gt;</span>  <span class="comment">{/* No error boundary wrapper */}</span>
      <span class="tag">&lt;MessageForm</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;ChatHeader</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Comprehensive Error Boundaries)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Multi-level error boundaries with recovery</span>
<span class="keyword">class</span> <span class="function">ErrorBoundary</span> <span class="keyword">extends</span> <span class="function">React.Component</span> {
  <span class="keyword">constructor</span>(props) {
    <span class="keyword">super</span>(props);
    <span class="keyword">this</span>.<span class="variable">state</span> = { 
      <span class="variable">hasError</span>: <span class="keyword">false</span>, 
      <span class="variable">error</span>: <span class="keyword">null</span>,
      <span class="variable">errorInfo</span>: <span class="keyword">null</span>,
      <span class="variable">retryCount</span>: <span class="number">0</span>
    };
  }
  
  <span class="keyword">static</span> <span class="function">getDerivedStateFromError</span>(error) {
    <span class="keyword">return</span> { <span class="variable">hasError</span>: <span class="keyword">true</span>, <span class="variable">error</span> };
  }
  
  <span class="function">componentDidCatch</span>(error, errorInfo) {
    <span class="keyword">this</span>.<span class="function">setState</span>({ <span class="variable">errorInfo</span> });
    
    <span class="comment">// Log error for monitoring</span>
    <span class="function">logError</span>({
      <span class="variable">error</span>,
      <span class="variable">errorInfo</span>,
      <span class="variable">component</span>: <span class="keyword">this</span>.<span class="props</span>.<span class="variable">componentName</span> || <span class="string">'Unknown'</span>,
      <span class="variable">timestamp</span>: Date.<span class="function">now</span>(),
      <span class="variable">userAgent</span>: navigator.<span class="variable">userAgent</span>
    });
    
    <span class="comment">// Attempt recovery if configured</span>
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="props</span>.<span class="variable">autoRecover</span> && <span class="keyword">this</span>.<span class="variable">state</span>.<span class="variable">retryCount</span> < <span class="keyword">this</span>.<span class="props</span>.<span class="variable">maxRetries</span>) {
      <span class="function">setTimeout</span>(() => {
        <span class="keyword">this</span>.<span class="function">attemptRecovery</span>();
      }, <span class="keyword">this</span>.<span class="props</span>.<span class="variable">retryDelay</span> || <span class="number">1000</span>);
    }
  }
  
  <span class="function">attemptRecovery</span>() {
    <span class="keyword">this</span>.<span class="function">setState</span>(<span class="variable">prevState</span> => ({
      <span class="variable">hasError</span>: <span class="keyword">false</span>,
      <span class="variable">error</span>: <span class="keyword">null</span>,
      <span class="variable">errorInfo</span>: <span class="keyword">null</span>,
      <span class="variable">retryCount</span>: prevState.<span class="variable">retryCount</span> + <span class="number">1</span>
    }));
  }
  
  <span class="function">render</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="variable">state</span>.<span class="variable">hasError</span>) {
      <span class="keyword">return</span> <span class="keyword">this</span>.<span class="props</span>.<span class="function">fallback</span>({
        <span class="variable">error</span>: <span class="keyword">this</span>.<span class="variable">state</span>.<span class="variable">error</span>,
        <span class="variable">errorInfo</span>: <span class="keyword">this</span>.<span class="variable">state</span>.<span class="variable">errorInfo</span>,
        <span class="variable">retryCount</span>: <span class="keyword">this</span>.<span class="variable">state</span>.<span class="variable">retryCount</span>,
        <span class="function">retry</span>: () => <span class="keyword">this</span>.<span class="function">attemptRecovery</span>()
      });
    }
    
    <span class="keyword">return</span> <span class="keyword">this</span>.<span class="props</span>.<span class="variable">children</span>;
  }
}

<span class="comment">// Specialized error boundaries for different contexts</span>
<span class="keyword">const</span> <span class="function">ChatErrorBoundary</span> = ({ <span class="variable">children</span> }) => (
  <span class="tag">&lt;ErrorBoundary</span>
    <span class="attr">componentName</span>=<span class="punct">"</span>Chat<span class="punct">"</span>
    <span class="attr">fallback</span>=<span class="punct">{</span>({ <span class="variable">error</span>, <span class="function">retry</span> }) => (
      <span class="tag">&lt;div</span> <span class="attr">className</span>=<span class="punct">"</span>chat-error<span class="punct">"</span><span class="tag">&gt;</span>
        <span class="tag">&lt;h3&gt;</span>Chat temporarily unavailable<span class="tag">&lt;/h3&gt;</span>
        <span class="tag">&lt;p&gt;</span>We're having trouble loading the chat. Please try again.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;button</span> <span class="attr">onClick</span>=<span class="punct">{</span>retry<span class="punct">}</span><span class="tag">&gt;</span>
          Retry<span class="tag">&lt;/button&gt;</span>
      <span class="tag">&lt;/div&gt;</span>
    )}
    <span class="attr">autoRecover</span>=<span class="punct">{</span>true<span class="punct">}</span>
    <span class="attr">maxRetries</span>=<span class="punct">{</span>3<span class="punct">}</span>
  <span class="tag">&gt;</span>
    {children}
  <span class="tag">&lt;/ErrorBoundary&gt;</span>
);

<span class="keyword">const</span> <span class="function">MessageErrorBoundary</span> = ({ <span class="variable">children</span> }) => (
  <span class="tag">&lt;ErrorBoundary</span>
    <span class="attr">componentName</span>=<span class="punct">"</span>MessageForm<span class="punct">"</span>
    <span class="attr">fallback</span>=<span class="punct">{</span>({ <span class="variable">error</span> }) => (
      <span class="tag">&lt;div</span> <span class="attr">className</span>=<span class="punct">"</span>message-error<span class="punct">"</span><span class="tag">&gt;</span>
        <span class="tag">&lt;p&gt;</span>Message sending temporarily disabled<span class="tag">&lt;/p&gt;</span>
      <span class="tag">&lt;/div&gt;</span>
    )}
  <span class="tag">&gt;</span>
    {children}
  <span class="tag">&lt;/ErrorBoundary&gt;</span>
);

<span class="comment">// Error reporting service</span>
<span class="keyword">class</span> <span class="function">ErrorReportingService</span> {
  <span class="keyword">static</span> <span class="keyword">async</span> <span class="function">logError</span>(errorData) {
    <span class="keyword">try</span> {
      <span class="comment">// Send to monitoring service</span>
      <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'/api/errors'</span>, {
        <span class="variable">method</span>: <span class="string">'POST'</span>,
        <span class="variable">headers</span>: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
        <span class="variable">body</span>: JSON.<span class="function">stringify</span>(errorData)
      });
    } <span class="keyword">catch</span> (reportingError) {
      <span class="comment">// Fallback to console if reporting fails</span>
      console.<span class="function">error</span>(<span class="string">'Failed to report error:'</span>, reportingError);
      console.<span class="function">error</span>(<span class="string">'Original error:'</span>, errorData);
    }
  }
}

<span class="comment">// Application with comprehensive error boundaries</span>
<span class="keyword">const</span> <span class="function">App</span> = () => {
  <span class="keyword">return</span> (
    <span class="tag">&lt;ErrorBoundary</span>
      <span class="attr">componentName</span>=<span class="punct">"</span>App<span class="punct">"</span>
      <span class="attr">fallback</span>=<span class="punct">{</span>({ <span class="variable">error</span> }) => (
        <span class="tag">&lt;div</span> <span class="attr">className</span>=<span class="punct">"</span>app-error<span class="punct">"</span><span class="tag">&gt;</span>
          <span class="tag">&lt;h2&gt;</span>Application Error<span class="tag">&lt;/h2&gt;</span>
          <span class="tag">&lt;p&gt;</span>Please refresh the page to continue.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
      )}
    <span class="tag">&gt;</span>
      <span class="tag">&lt;ChatErrorBoundary&gt;</span>
        <span class="tag">&lt;ChatContainer</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/ChatErrorBoundary&gt;</span>
      
      <span class="tag">&lt;MessageErrorBoundary&gt;</span>
        <span class="tag">&lt;MessageForm</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/MessageErrorBoundary&gt;</span>
      
      <span class="tag">&lt;ErrorBoundary</span>
        <span class="attr">componentName</span>=<span class="punct">"</span>ChatHeader<span class="punct">"</span>
        <span class="attr">fallback</span>=<span class="punct">{</span>() => <span class="tag">&lt;div</span><span class="tag">&gt;</span>Chat<span class="tag">&lt;/div&gt;</span><span class="punct">}</span>
      <span class="tag">&gt;</span>
        <span class="tag">&lt;ChatHeader</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/ErrorBoundary&gt;</span>
    <span class="tag">&lt;/ErrorBoundary&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Prevents component crashes from breaking the entire application</li>
                            <li>Graceful degradation maintains user experience during errors</li>
                            <li>Automatic recovery mechanisms reduce user intervention</li>
                            <li>Comprehensive error logging enables better debugging</li>
                            <li>Different error handling strategies for different component types</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement error boundaries at multiple levels, add error reporting and recovery mechanisms, and create graceful degradation paths.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Inconsistent State Management</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    State is managed inconsistently across localStorage, React state, and Apollo cache, leading to synchronization issues.
                </div>
                <div class="issue-location">
                    üìÅ Multiple files with inconsistent state patterns
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement a centralized state management solution with clear ownership rules and synchronization mechanisms.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Inconsistent State)</div>
                                <div class="code-block">
<pre><span class="comment">// INCONSISTENT: Mixed state management approaches</span>
<span class="comment">// Component A: localStorage</span>
store(<span class="string">'activeChat'</span>, active);

<span class="comment">// Component B: React state</span>
<span class="keyword">const</span> [<span class="variable">website</span>, setWebsite] = <span class="function">useState</span>();

<span class="comment">// Component C: Apollo cache</span>
client.<span class="variable">cache</span>.<span class="function">modify</span>({
  <span class="variable">id</span>: <span class="function">cache</span>.<span class="function">identify</span>(chat),
  <span class="variable">fields</span>: {
    <span class="function">messages</span>(existing) {
      <span class="keyword">return</span> [...existing, newMessage];
    }
  }
});

<span class="comment">// Component D: Context</span>
<span class="keyword">const</span> { <span class="variable">user</span>, <span class="function">setUser</span> } = <span class="function">useContext</span>(UserContext);</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Centralized State)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Centralized state management with clear ownership</span>

<span class="comment">// State store with clear ownership rules</span>
<span class="keyword">class</span> <span class="function">CentralizedStateStore</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">state</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">subscribers</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">persistedKeys</span> = <span class="keyword">new</span> <span class="function">Set</span>([<span class="string">'userPreferences'</span>, <span class="string">'authToken'</span>, <span class="string">'activeChat'</span>]);
    <span class="keyword">this</span>.<span class="variable">apolloKeys</span> = <span class="keyword">new</span> <span class="function">Set</span>([<span class="string">'chats'</span>, <span class="variable">messages</span>, <span class="string">'contracts'</span>]);
  }
  
  <span class="comment">// Define ownership rules</span>
  <span class="variable">OWNERSHIP_RULES</span> = {
    <span class="string">'userPreferences'</span>: { <span class="variable">type</span>: <span class="string">'persisted'</span>, <span class="variable">sync</span>: <span class="keyword">true</span> },
    <span class="string">'authToken'</span>: { <span class="variable">type</span>: <span class="string">'persisted'</span>, <span class="variable">sync</span>: <span class="keyword">false</span>, <span class="variable">secure</span>: <span class="keyword">true</span> },
    <span class="string">'activeChat'</span>: { <span class="variable">type</span>: <span class="string">'persisted'</span>, <span class="variable">sync</span>: <span class="keyword">true</span> },
    <span class="string">'chats'</span>: { <span class="variable">type</span>: <span class="string">'apollo'</span>, <span class="variable">sync</span>: <span class="keyword">true</span> },
    <span class="variable">messages</span>: { <span class="variable">type</span>: <span class="string">'apollo'</span>, <span class="variable">sync</span>: <span class="keyword">true</span> },
    <span class="string">'uiState'</span>: { <span class="variable">type</span>: <span class="string">'memory'</span>, <span class="variable">sync</span>: <span class="keyword">false</span> }
  };
  
  <span class="function">get</span>(key) {
    <span class="keyword">const</span> <span class="variable">rule</span> = <span class="keyword">this</span>.<span class="variable">OWNERSHIP_RULES</span>[key];
    
    <span class="keyword">if</span> (!rule) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`No ownership rule defined for ${key}`</span>);
    }
    
    <span class="keyword">switch</span> (rule.<span class="variable">type</span>) {
      <span class="keyword">case</span> <span class="string">'persisted'</span>:
        <span class="keyword">return</span> <span class="keyword">this</span>.<span class="function">getPersisted</span>(key);
      <span class="keyword">case</span> <span class="string">'apollo'</span>:
        <span class="keyword">return</span> <span class="keyword">this</span>.<span class="function">getFromApollo</span>(key);
      <span class="keyword">case</span> <span class="string">'memory'</span>:
        <span class="keyword">return</span> <span class="keyword">this</span>.<span class="variable">state</span>.<span class="function">get</span>(key);
      <span class="keyword">default</span>:
        <span class="keyword">return</span> <span class="keyword">undefined</span>;
    }
  }
  
  <span class="function">set</span>(key, value) {
    <span class="keyword">const</span> <span class="variable">rule</span> = <span class="keyword">this</span>.<span class="variable">OWNERSHIP_RULES</span>[key];
    <span class="keyword">const</span> <span class="variable">oldValue</span> = <span class="keyword">this</span>.<span class="function">get</span>(key);
    
    <span class="keyword">if</span> (oldValue === value) <span class="keyword">return</span>; <span class="comment">// No change needed</span>
    
    <span class="keyword">switch</span> (rule.<span class="variable">type</span>) {
      <span class="keyword">case</span> <span class="string">'persisted'</span>:
        <span class="keyword">this</span>.<span class="function">setPersisted</span>(key, value, rule);
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'apollo'</span>:
        <span class="keyword">this</span>.<span class="function">setInApollo</span>(key, value);
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'memory'</span>:
        <span class="keyword">this</span>.<span class="variable">state</span>.<span class="function">set</span>(key, value);
        <span class="keyword">break</span>;
    }
    
    <span class="comment">// Notify subscribers</span>
    <span class="keyword">this</span>.<span class="function">notifySubscribers</span>(key, value, oldValue);
    
    <span class="comment">// Sync to other stores if needed</span>
    <span class="keyword">if</span> (rule.<span class="variable">sync</span>) {
      <span class="keyword">this</span>.<span class="function">syncToOtherStores</span>(key, value);
    }
  }
  
  <span class="function">getPersisted</span>(key) {
    <span class="keyword">try</span> {
      <span class="keyword">const</span> <span class="variable">stored</span> = localStorage.<span class="function">getItem</span>(key);
      <span class="keyword">return</span> stored ? JSON.<span class="function">parse</span>(stored) : <span class="keyword">null</span>;
    } <span class="keyword">catch</span> (error) {
      console.<span class="function">error</span>(<span class="string">`Failed to get persisted state for ${key}:`</span>, error);
      <span class="keyword">return</span> <span class="keyword">null</span>;
    }
  }
  
  <span class="function">setPersisted</span>(key, value, rule) {
    <span class="keyword">try</span> {
      <span class="keyword">if</span> (rule.<span class="variable">secure</span>) {
        <span class="comment">// Use secure storage for sensitive data</span>
        <span class="keyword">await</span> secureStorage.<span class="function">set</span>(key, value);
      } <span class="keyword">else</span> {
        localStorage.<span class="function">setItem</span>(key, JSON.<span class="function">stringify</span>(value));
      }
    } <span class="keyword">catch</span> (error) {
      console.<span class="function">error</span>(<span class="string">`Failed to set persisted state for ${key}:`</span>, error);
      <span class="keyword">throw</span> error;
    }
  }
  
  <span class="function">getFromApollo</span>(key) {
    <span class="keyword">try</span> {
      <span class="keyword">const</span> <span class="variable">query</span> = <span class="keyword">this</span>.<span class="function">getApolloQuery</span>(key);
      <span class="keyword">const</span> result = apolloClient.<span class="function">readQuery</span>({ <span class="variable">query</span> });
      <span class="keyword">return</span> result?.[key];
    } <span class="keyword">catch</span> (error) {
      console.<span class="function">error</span>(<span class="string">`Failed to get Apollo state for ${key}:`</span>, error);
      <span class="keyword">return</span> <span class="keyword">null</span>;
    }
  }
  
  <span class="function">setInApollo</span>(key, value) {
    <span class="keyword">try</span> {
      <span class="keyword">const</span> <span class="variable">mutation</span> = <span class="keyword">this</span>.<span class="function">getApolloMutation</span>(key);
      apolloClient.<span class="function">writeQuery</span>({
        <span class="variable">query</span>: mutation,
        <span class="variable">data</span>: { [key]: value }
      });
    } <span class="keyword">catch</span> (error) {
      console.<span class="function">error</span>(<span class="string">`Failed to set Apollo state for ${key}:`</span>, error);
      <span class="keyword">throw</span> error;
    }
  }
  
  <span class="function">subscribe</span>(key, callback) {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.<span class="variable">subscribers</span>.<span class="function">has</span>(key)) {
      <span class="keyword">this</span>.<span class="variable">subscribers</span>.<span class="function">set</span>(key, <span class="keyword">new</span> <span class="function">Set</span>());
    }
    
    <span class="keyword">this</span>.<span class="variable">subscribers</span>.<span class="function">get</span>(key).<span class="function">add</span>(callback);
    
    <span class="comment">// Return unsubscribe function</span>
    <span class="keyword">return</span> () => {
      <span class="keyword">this</span>.<span class="variable">subscribers</span>.<span class="function">get</span>(key)?.<span class="function">delete</span>(callback);
    };
  }
  
  <span class="function">notifySubscribers</span>(key, value, oldValue) {
    <span class="keyword">const</span> <span class="variable">callbacks</span> = <span class="keyword">this</span>.<span class="variable">subscribers</span>.<span class="function">get</span>(key);
    <span class="keyword">if</span> (callbacks) {
      callbacks.<span class="function">forEach</span>(callback => {
        <span class="keyword">try</span> {
          <span class="function">callback</span>(value, oldValue, key);
        } <span class="keyword">catch</span> (error) {
          console.<span class="function">error</span>(<span class="string">'Subscriber callback error:'</span>, error);
        }
      });
    }
  }
}

<span class="comment">// React hook for centralized state</span>
<span class="keyword">const</span> <span class="function">useCentralizedState</span> = (key, <span class="variable">initialValue</span>) => {
  <span class="keyword">const</span> store = <span class="function">useContext</span>(StateContext);
  <span class="keyword">const</span> [<span class="variable">value</span>, setValue] = <span class="function">useState</span>(() => store.<span class="function">get</span>(key) ?? <span class="variable">initialValue</span>);
  
  <span class="function">useEffect</span>(() => {
    <span class="keyword">const</span> <span class="variable">unsubscribe</span> = store.<span class="function">subscribe</span>(key, (<span class="variable">newValue</span>) => {
      setValue(newValue);
    });
    
    <span class="keyword">return</span> unsubscribe;
  }, [key, store]);
  
  <span class="keyword">const</span> <span class="function">updateValue</span> = <span class="function">useCallback</span>((<span class="variable">newValue</span>) => {
    store.<span class="function">set</span>(key, newValue);
  }, [key, store]);
  
  <span class="keyword">return</span> [<span class="variable">value</span>, <span class="function">updateValue</span>];
};

<span class="comment">// Usage in components</span>
<span class="keyword">const</span> <span class="function">ChatComponent</span> = () => {
  <span class="comment">// All state goes through centralized store</span>
  <span class="keyword">const</span> [<span class="variable">activeChat</span>, setActiveChat] = <span class="function">useCentralizedState</span>(<span class="string">'activeChat'</span>, <span class="keyword">null</span>);
  <span class="keyword">const</span> [<span class="variable">userPreferences</span>, setUserPreferences] = <span class="function">useCentralizedState</span>(<span class="string">'userPreferences'</span>, {});
  
  <span class="comment">// State is automatically synchronized and persisted according to rules</span>
  <span class="keyword">const</span> <span class="function">handleChatSelect</span> = (chat) => {
    setActiveChat(chat.<span class="variable">id</span>); <span class="comment">// Automatically persisted</span>
  };
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;ChatList</span> <span class="attr">activeChat</span>=<span class="punct">{</span>activeChat<span class="punct">}</span> <span class="attr">onSelect</span>=<span class="punct">{</span>handleChatSelect<span class="punct">}</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Consistent state management across the entire application</li>
                            <li>Clear ownership rules prevent state conflicts</li>
                            <li>Automatic synchronization between different storage mechanisms</li>
                            <li>Centralized state enables better debugging and monitoring</li>
                            <li>Type-safe state access with ownership validation</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement a centralized state management solution, create clear state ownership rules, and add state synchronization mechanisms.</p>
                </div>
            </div>
        </section>

        <section id="performance-optimizations" class="section">
            <h2>
                <span class="section-icon">‚ö°</span>
                Performance Optimizations
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Unnecessary Re-renders</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Components re-render unnecessarily due to missing memoization and proper dependency management.
                </div>
                <div class="issue-location">
                    üìÅ src/MessageForm.js:16-41
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement React.memo for components, optimize useCallback dependencies, and use useMemo for expensive computations.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Unnecessary Re-renders)</div>
                                <div class="code-block">
<pre><span class="comment">// ISSUE: Function recreated on every render</span>
<span class="keyword">const</span> <span class="function">MessageForm</span> = ({ <span class="variable">onSubmit</span>, <span class="variable">chatId</span>, <span class="variable">user</span> }) => {
  <span class="keyword">const</span> [<span class="variable">message</span>, setMessage] = <span class="function">useState</span>(<span class="string">''</span>);
  
  <span class="comment">// Function recreated on every render due to dependencies</span>
  <span class="keyword">const</span> <span class="function">handleSubmit</span> = <span class="function">useCallback</span>(() => {
    <span class="keyword">if</span> (message.<span class="variable">trim</span>()) {
      <span class="function">onSubmit</span>({ <span class="variable">text</span>: message, <span class="variable">chatId</span>, <span class="variable">user</span> });
      setMessage(<span class="string">''</span>);
    }
  }, [message, chatId, user, onSubmit]); <span class="comment">// Dependencies cause recreation</span>
  
  <span class="comment">// Expensive computation on every render</span>
  <span class="keyword">const</span> <span class="variable">formattedMessage</span> = message.<span class="function">replace</span>(<span class="keyword">/</span><span class="string">\n</span><span class="keyword">/g</span>, <span class="string">'&lt;br/&gt;'</span>)
    .<span class="function">replace</span>(<span class="keyword">/</span><span class="string">https?:\/\/</span><span class="keyword">/</span><span class="string">g</span>, <span class="string">''</span>)
    .<span class="function">substring</span>(<span class="number">0</span>, <span class="number">1000</span>);
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;form&gt;</span>
      <span class="tag">&lt;textarea</span> <span class="attr">value</span>=<span class="punct">{</span>message<span class="punct">}</span> <span class="attr">onChange</span>=<span class="punct">{</span>(e) => setMessage(e.target.value)<span class="punct">}</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attr">onClick</span>=<span class="punct">{</span>handleSubmit<span class="punct">}</span><span class="tag">&gt;</span>Send<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;/form&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Optimized Rendering)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Optimized component with proper memoization</span>
<span class="keyword">const</span> <span class="function">MessageForm</span> = <span class="function">React.memo</span>(({ <span class="variable">onSubmit</span>, <span class="variable">chatId</span>, <span class="variable">user</span> }) => {
  <span class="keyword">const</span> [<span class="variable">message</span>, setMessage] = <span class="function">useState</span>(<span class="string">''</span>);
  <span class="keyword">const</span> [<span class="variable">isSubmitting</span>, setIsSubmitting] = <span class="function">useState</span>(<span class="keyword">false</span>);
  
  <span class="comment">// Stable callback with minimal dependencies</span>
  <span class="keyword">const</span> <span class="function">handleSubmit</span> = <span class="function">useCallback</span>(<span class="keyword">async</span> () => {
    <span class="keyword">if</span> (!message.<span class="function">trim</span>() || isSubmitting) <span class="keyword">return</span>;
    
    setIsSubmitting(<span class="keyword">true</span>);
    
    <span class="keyword">try</span> {
      <span class="keyword">await</span> <span class="function">onSubmit</span>({ 
        <span class="variable">text</span>: message.<span class="function">trim</span>(), 
        <span class="variable">chatId</span>, 
        <span class="variable">userId</span>: user?.<span class="variable">id</span>,
        <span class="variable">timestamp</span>: Date.<span class="function">now</span>()
      });
      setMessage(<span class="string">''</span>);
    } <span class="keyword">catch</span> (error) {
      console.<span class="function">error</span>(<span class="string">'Failed to send message:'</span>, error);
    } <span class="keyword">finally</span> {
      setIsSubmitting(<span class="keyword">false</span>);
    }
  }, [message, chatId, user?.<span class="variable">id</span>, onSubmit, isSubmitting]);
  
  <span class="comment">// Memoize expensive formatting</span>
  <span class="keyword">const</span> <span class="variable">formattedMessage</span> = <span class="function">useMemo</span>(() => {
    <span class="keyword">if</span> (!message) <span class="keyword">return</span> <span class="string">''</span>;
    
    <span class="keyword">return</span> message
      .<span class="function">trim</span>()
      .<span class="function">replace</span>(<span class="keyword">/</span><span class="string">\n</span><span class="keyword">/g</span>, <span class="string">'&lt;br/&gt;'</span>)
      .<span class="function">replace</span>(<span class="keyword">/</span><span class="string">https?:\/\/[^\s]+</span><span class="keyword">/g</span>, <span class="string">''</span>)
      .<span class="function">substring</span>(<span class="number">0</span>, <span class="number">1000</span>);
  }, [message]);
  
  <span class="comment">// Memoize input handler to prevent child re-renders</span>
  <span class="keyword">const</span> <span class="function">handleInputChange</span> = <span class="function">useCallback</span>((e) => {
    setMessage(e.<span class="variable">target</span>.<span class="variable">value</span>);
  }, []);
  
  <span class="comment">// Memoize validation result</span>
  <span class="keyword">const</span> <span class="variable">canSubmit</span> = <span class="function">useMemo</span>(() => {
    <span class="keyword">return</span> message.<span class="function">trim</span>().<span class="variable">length</span> > <span class="number">0</span> && !isSubmitting;
  }, [message, isSubmitting]);
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;form</span> <span class="attr">onSubmit</span>=<span class="punct">{</span>(e) => { e.preventDefault(); handleSubmit(); }}<span class="tag">&gt;</span>
      <span class="tag">&lt;MessageInput</span>
        <span class="attr">value</span>=<span class="punct">{</span>message<span class="punct">}</span>
        <span class="attr">onChange</span>=<span class="punct">{</span>handleInputChange<span class="punct">}</span>
        <span class="attr">disabled</span>=<span class="punct">{</span>isSubmitting<span class="punct">}</span>
        <span class="attr">placeholder</span>=<span class="punct">"</span>Type your message...<span class="punct">"</span>
      <span class="tag">/&gt;</span>
      
      <span class="tag">&lt;FormActions&gt;</span>
        <span class="tag">&lt;CharacterCount</span> <span class="attr">count</span>=<span class="punct">{</span>message.length<span class="punct">}</span> <span class="attr">max</span>=<span class="punct">{</span>1000<span class="punct">}</span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;SendButton</span>
          <span class="attr">onClick</span>=<span class="punct">{</span>handleSubmit<span class="punct">}</span>
          <span class="attr">disabled</span>=<span class="punct">{</span>!canSubmit<span class="punct">}</span>
          <span class="attr">loading</span>=<span class="punct">{</span>isSubmitting<span class="punct">}</span>
        <span class="tag">&gt;</span>
          Send
        <span class="tag">&lt;/SendButton&gt;</span>
      <span class="tag">&lt;/FormActions&gt;</span>
    <span class="tag">&lt;/form&gt;</span>
  );
}, (prevProps, nextProps) => {
  <span class="comment">// Custom comparison for more precise re-render control</span>
  <span class="keyword">return</span> (
    prevProps.<span class="variable">chatId</span> === nextProps.<span class="variable">chatId</span> &&
    prevProps.<span class="variable">user</span>?.<span class="variable">id</span> === nextProps.<span class="variable">user</span>?.<span class="variable">id</span> &&
    prevProps.<span class="variable">onSubmit</span> === nextProps.<span class="variable">onSubmit</span>
  );
});

<span class="comment">// Memoized child components</span>
<span class="keyword">const</span> <span class="function">MessageInput</span> = <span class="function">React.memo</span>(({ <span class="variable">value</span>, <span class="variable">onChange</span>, <span class="variable">disabled</span>, <span class="variable">placeholder</span> }) => (
  <span class="tag">&lt;textarea</span>
    <span class="attr">value</span>=<span class="punct">{</span>value<span class="punct">}</span>
    <span class="attr">onChange</span>=<span class="punct">{</span>onChange<span class="punct">}</span>
    <span class="attr">disabled</span>=<span class="punct">{</span>disabled<span class="punct">}</span>
    <span class="attr">placeholder</span>=<span class="punct">{</span>placeholder<span class="punct">}</span>
    <span class="attr">rows</span>=<span class="punct">{</span>3<span class="punct">}</span>
    <span class="attr">maxLength</span>=<span class="punct">{</span>1000<span class="punct">}</span>
  <span class="tag">/&gt;</span>
));

<span class="keyword">const</span> <span class="function">CharacterCount</span> = <span class="function">React.memo</span>(({ <span class="variable">count</span>, <span class="variable">max</span> }) => {
  <span class="keyword">const</span> <span class="variable">percentage</span> = (count / max) * <span class="number">100</span>;
  <span class="keyword">const</span> <span class="variable">isNearLimit</span> = percentage > <span class="number">90</span>;
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;span</span> <span class="attr">className</span>=<span class="punct">{</span>`character-count ${isNearLimit ? 'warning' : ''}`}<span class="punct">}</span><span class="tag">&gt;</span>
      {count}/{max}
    <span class="tag">&lt;/span&gt;</span>
  );
});

<span class="keyword">const</span> <span class="function">SendButton</span> = <span class="function">React.memo</span>(({ <span class="variable">children</span>, <span class="variable">disabled</span>, <span class="variable">loading</span>, <span class="attr">onClick</span> }) => (
  <span class="tag">&lt;button</span>
    <span class="attr">type</span>=<span class="punct">"</span>submit<span class="punct">"</span>
    <span class="attr">disabled</span>=<span class="punct">{</span>disabled || loading<span class="punct">}</span>
    <span class="attr">onClick</span>=<span class="punct">{</span>onClick<span class="punct">}</span>
  <span class="tag">&gt;</span>
    {loading ? <span class="tag">&lt;Spinner</span> <span class="tag">/&gt;</span> : children}
  <span class="tag">&lt;/button&gt;</span>
));</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Reduces unnecessary re-renders improving performance</li>
                            <li>Optimized callback dependencies prevent function recreation</li>
                            <li>Memoized computations reduce CPU usage</li>
                            <li>Custom comparison provides precise re-render control</li>
                            <li>Child component memoization prevents prop drilling re-renders</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement React.memo for components, optimize useCallback dependencies, and use useMemo for expensive computations.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Bundle Size Optimization</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The bundle includes unnecessary dependencies and large libraries that could be optimized or loaded dynamically.
                </div>
                <div class="issue-location">
                    üìÅ package.json:6-22 (dependencies)
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Replace moment.js with native Date utilities, implement custom form handling for simple cases, and optimize library usage.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Large Dependencies)</div>
                                <div class="code-block">
<pre><span class="comment">// ISSUE: Large dependencies bundled</span>
{
  <span class="string">"dependencies"</span>: {
    <span class="string">"moment"</span>: <span class="string">"^2.29.4"</span>, <span class="comment">// 67KB - could use native Date</span>
    <span class="string">"formik"</span>: <span class="string">"^2.2.9"</span>, <span class="comment">// Large for simple forms</span>
    <span class="string">"styled-components"</span>: <span class="string">"^6.1.19"</span>, <span class="comment">// Could be optimized</span>
    <span class="string">"lodash"</span>: <span class="string">"^4.17.21"</span> <span class="comment">// 70KB - only using few functions</span>
  }
}

<span class="comment">// Usage of heavy libraries</span>
<span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;
<span class="keyword">import</span> { <span class="function">Formik</span>, <span class="function">Field</span>, <span class="function">Form</span> } <span class="keyword">from</span> <span class="string">'formik'</span>;
<span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;

<span class="keyword">const</span> <span class="function">formatDate</span> = (date) => moment(date).<span class="function">format</span>(<span class="string">'MMM DD, YYYY'</span>);
<span class="keyword">const</span> <span class="function">debounce</span> = _.<span class="function">debounce</span>;
<span class="keyword">const</span> <span class="function">isEmpty</span> = _.<span class="function">isEmpty</span>;</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Optimized Dependencies)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Optimized dependencies with native alternatives</span>
{
  <span class="string">"dependencies"</span>: {
    <span class="comment">// Replaced moment.js with native Date utilities</span>
    <span class="comment">// "moment": "^2.29.4", // REMOVED</span>
    
    <span class="comment">// Replaced formik with lightweight custom solution</span>
    <span class="comment">// "formik": "^2.2.9", // REMOVED</span>
    
    <span class="comment">// Optimized styled-components usage</span>
    <span class="string">"styled-components"</span>: <span class="string">"^6.1.19"</span>,
    
    <span class="comment">// Tree-shake lodash or use native alternatives</span>
    <span class="comment">// "lodash": "^4.17.21", // REMOVED</span>
    
    <span class="comment">// Add lightweight alternatives</span>
    <span class="string">"date-fns"</span>: <span class="string">"^2.30.0"</span>, <span class="comment">// 8KB vs 67KB</span>
  },
  <span class="string">"devDependencies"</span>: {
    <span class="comment">// Keep for development if needed</span>
    <span class="string">"lodash"</span>: <span class="string">"^4.17.21"</span>
  }
}

<span class="comment">// Native Date utilities (replaces moment.js)</span>
<span class="keyword">const</span> <span class="function">formatDate</span> = (date, <span class="variable">format</span> = <span class="string">'MMM DD, YYYY'</span>) => {
  <span class="keyword">const</span> <span class="variable">options</span> = {
    <span class="variable">year</span>: <span class="string">'numeric'</span>,
    <span class="variable">month</span>: <span class="string">'short'</span>,
    <span class="variable">day</span>: <span class="string">'numeric'</span>
  };
  
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="function">Date</span>(date).<span class="function">toLocaleDateString</span>(<span class="string">'en-US'</span>, options);
};

<span class="keyword">const</span> <span class="function">formatRelativeTime</span> = (date) => {
  <span class="keyword">const</span> <span class="variable">now</span> = Date.<span class="function">now</span>();
  <span class="keyword">const</span> <span class="variable">diff</span> = now - <span class="keyword">new</span> <span class="function">Date</span>(date).<span class="function">getTime</span>();
  
  <span class="keyword">const</span> <span class="variable">seconds</span> = Math.<span class="function">floor</span>(diff / <span class="number">1000</span>);
  <span class="keyword">const</span> <span class="variable">minutes</span> = Math.<span class="function">floor</span>(seconds / <span class="number">60</span>);
  <span class="keyword">const</span> <span class="variable">hours</span> = Math.<span class="function">floor</span>(minutes / <span class="number">60</span>);
  <span class="keyword">const</span> <span class="variable">days</span> = Math.<span class="function">floor</span>(hours / <span class="number">24</span>);
  
  <span class="keyword">if</span> (days > <span class="number">0</span>) <span class="keyword">return</span> <span class="string">`${days}d ago`</span>;
  <span class="keyword">if</span> (hours > <span class="keyword">0</span>) <span class="keyword">return</span> <span class="string">`${hours}h ago`</span>;
  <span class="keyword">if</span> (minutes > <span class="keyword">0</span>) <span class="keyword">return</span> <span class="string">`${minutes}m ago`</span>;
  <span class="keyword">return</span> <span class="string">'just now'</span>;
};

<span class="comment">// Lightweight form handling (replaces formik)</span>
<span class="keyword">const</span> <span class="function">useForm</span> = (<span class="variable">initialValues</span>, <span class="variable">validationSchema</span>, <span class="function">onSubmit</span>) => {
  <span class="keyword">const</span> [<span class="variable">values</span>, setValues] = <span class="function">useState</span>(<span class="variable">initialValues</span>);
  <span class="keyword">const</span> [<span class="variable">errors</span>, setErrors] = <span class="function">useState</span>({});
  <span class="keyword">const</span> [<span class="variable">isSubmitting</span>, setIsSubmitting] = <span class="function">useState</span>(<span class="keyword">false</span>);
  
  <span class="keyword">const</span> <span class="function">handleChange</span> = (name) => (e) => {
    setValues(<span class="variable">prev</span> => ({ ...prev, [name]: e.<span class="variable">target</span>.<span class="variable">value</span> }));
    
    <span class="comment">// Clear error for this field</span>
    <span class="keyword">if</span> (errors[name]) {
      setErrors(<span class="variable">prev</span> => {
        <span class="keyword">const</span> <span class="variable">newErrors</span> = { ...prev };
        <span class="keyword">delete</span> newErrors[name];
        <span class="keyword">return</span> newErrors;
      });
    }
  };
  
  <span class="keyword">const</span> <span class="function">handleSubmit</span> = <span class="keyword">async</span> (e) => {
    e.<span class="function">preventDefault</span>();
    
    <span class="comment">// Validate</span>
    <span class="keyword">if</span> (validationSchema) {
      <span class="keyword">const</span> <span class="variable">validationErrors</span> = <span class="keyword">await</span> <span class="function">validateForm</span>(values, validationSchema);
      <span class="keyword">if</span> (Object.<span class="function">keys</span>(validationErrors).<span class="variable">length</span> > <span class="number">0</span>) {
        setErrors(validationErrors);
        <span class="keyword">return</span>;
      }
    }
    
    setIsSubmitting(<span class="keyword">true</span>);
    
    <span class="keyword">try</span> {
      <span class="keyword">await</span> <span class="function">onSubmit</span>(values);
    } <span class="keyword">catch</span> (error) {
      setErrors({ <span class="variable">submit</span>: error.<span class="variable">message</span> });
    } <span class="keyword">finally</span> {
      setIsSubmitting(<span class="keyword">false</span>);
    }
  };
  
  <span class="keyword">return</span> {
    <span class="variable">values</span>,
    <span class="variable">errors</span>,
    <span class="variable">isSubmitting</span>,
    <span class="function">handleChange</span>,
    <span class="function">handleSubmit</span>
  };
};

<span class="comment">// Native utilities (replaces lodash)</span>
<span class="keyword">const</span> <span class="function">debounce</span> = (<span class="variable">func</span>, <span class="variable">wait</span>) => {
  <span class="keyword">let</span> <span class="variable">timeout</span>;
  <span class="keyword">return</span> <span class="keyword">function</span> <span class="function">executedFunction</span>(...args) {
    <span class="keyword">const</span> <span class="variable">later</span> = () => {
      <span class="function">clearTimeout</span>(timeout);
      <span class="function">func</span>(...args);
    };
    <span class="function">clearTimeout</span>(timeout);
    timeout = <span class="function">setTimeout</span>(later, wait);
  };
};

<span class="keyword">const</span> <span class="function">isEmpty</span> = (value) => {
  <span class="keyword">if</span> (value == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;
  <span class="keyword">if</span> (Array.<span class="function">isArray</span>(value) || <span class="keyword">typeof</span> value === <span class="string">'string') <span class="keyword">return</span> value.<span class="variable">length</span> === <span class="number">0</span>;
  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'object') <span class="keyword">return</span> Object.<span class="function">keys</span>(value).<span class="variable">length</span> === <span class="number">0</span>;
  <span class="keyword">return</span> <span class="keyword">false</span>;
};

<span class="keyword">const</span> <span class="function">cloneDeep</span> = (obj) => JSON.<span class="function">parse</span>(JSON.<span class="function">stringify</span>(obj));

<span class="comment">// Optimized styled-components usage</span>
<span class="keyword">import</span> styled, { <span class="function">css</span> } <span class="keyword">from</span> <span class="string">'styled-components'</span>;

<span class="comment">// Use css prop for dynamic styles instead of creating new components</span>
<span class="keyword">const</span> <span class="function">DynamicComponent</span> = ({ <span class="variable">variant</span>, <span class="variable">size</span> }) => (
  <span class="tag">&lt;div</span>
    <span class="attr">css</span>=<span class="punct">{</span>css<span class="punct">`</span>
      <span class="comment">/* Base styles */</span>
      padding: <span class="variable">${size</span> === 'large' ? '16px' : '8px'};
      
      <span class="comment">/* Variant-specific styles */</span>
      <span class="variable">${variant</span> === 'primary' && css<span class="punct">`</span>
        background: blue;
        color: white;
      <span class="punct">`</span>}
      
      <span class="variable">${variant</span> === 'secondary' && css<span class="punct">`</span>
        background: gray;
        color: black;
      <span class="punct">`</span>}
    <span class="punct">`}</span>
  <span class="tag">&gt;</span>
    Content
  <span class="tag">&lt;/div&gt;</span>
);</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Reduces bundle size by ~150KB (moment.js + lodash)</li>
                            <li>Faster initial load time and better performance</li>
                            <li>Native browser APIs are more efficient than libraries</li>
                            <li>Reduced dependencies lower security risk surface</li>
                            <li>Better tree-shaking and code splitting capabilities</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Replace moment.js with native Date utilities, implement custom form handling for simple cases, and consider CSS-in-JS alternatives or optimize styled-components usage.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Inefficient GraphQL Queries</div>
                        <div class="issue-meta">
                            <span class="badge badge-low">Low</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Some GraphQL queries fetch more data than needed and lack proper caching strategies.
                </div>
                <div class="issue-location">
                    üìÅ src/queries.js:105-117
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement field-level caching, use GraphQL @defer and @stream directives, and optimize query selection based on component needs.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Inefficient Queries)</div>
                                <div class="code-block">
<pre><span class="comment">// INEFFICIENT: Fetching unnecessary nested data</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="variable">GET_CHAT</span> = gql<span class="punct">`</span>
  query ($chatId: UUID!) {
    chat(id: $chatId) {
      ...ChatFragment
      contract { <span class="comment">// May not always need contract data</span>
        agent {
          id
        }
      }
    }
  }
<span class="punct">`</span>;

<span class="comment">// No field-level caching or directives</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="variable">GET_MESSAGES</span> = gql<span class="punct">`</span>
  query ($chatId: UUID!, $limit: Int) {
    messages(chatId: $chatId, limit: $limit) {
      id
      text
      author
      timestamp
      readReceipts <span class="comment">// Fetched even if not displayed</span>
      attachments <span class="comment">// Fetched even if no attachments</span>
      metadata <span class="comment">// Large object always fetched</span>
    }
  }
<span class="punct">`</span>;</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Optimized Queries)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Optimized queries with field selection and directives</span>

<span class="comment">// Fragment-based queries with conditional fields</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="variable">GET_CHAT_BASE</span> = gql<span class="punct">`</span>
  query GetChatBase($chatId: UUID!) {
    chat(id: $chatId) {
      id
      status
      createdAt
      updatedAt
    }
  }
<span class="punct">`</span>;

<span class="keyword">export</span> <span class="keyword">const</span> <span class="variable">GET_CHAT_WITH_CONTRACT</span> = gql<span class="punct">`</span>
  query GetChatWithContract($chatId: UUID!) {
    chat(id: $chatId) {
      id
      status
      createdAt
      updatedAt
      contract {
        id
        agent {
          id
          name
          avatar
        }
      }
    }
  }
<span class="punct">`</span>;

<span class="comment">// Optimized messages query with @defer for non-critical data</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="variable">GET_MESSAGES_OPTIMIZED</span> = gql<span class="punct">`</span>
  query GetMessages($chatId: UUID!, $limit: Int, $includeMetadata: Boolean!) {
    messages(chatId: $chatId, limit: $limit) {
      id
      text
      author
      timestamp
      ... @include(if: $includeMetadata) {
        readReceipts {
          userId
          readAt
        }
        attachments {
          id
          type
          url
          name
        }
        metadata
      }
    }
  }
<span class="punct">`</span>;

<span class="comment">// Stream large message lists for better UX</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="variable">GET_MESSAGES_STREAM</span> = gql<span class="punct">`</span>
  query GetMessagesStream($chatId: UUID!) {
    messages(chatId: $chatId) @stream(key: "messages", initialCount: 20) {
      id
      text
      author
      timestamp
    }
  }
<span class="punct">`</span>;

<span class="comment">// Component with intelligent query selection</span>
<span class="keyword">const</span> <span class="function">ChatContainer</span> = ({ <span class="variable">chatId</span>, <span class="variable">showContract</span>, <span class="variable">showMetadata</span> }) => {
  <span class="comment">// Select appropriate query based on component needs</span>
  <span class="keyword">const</span> <span class="variable">chatQuery</span> = showContract ? GET_CHAT_WITH_CONTRACT : GET_CHAT_BASE;
  
  <span class="keyword">const</span> { <span class="variable">data</span>: <span class="variable">chatData</span>, <span class="variable">loading</span> } = <span class="function">useQuery</span>(chatQuery, {
    <span class="variable">variables</span>: { <span class="variable">chatId</span> },
    <span class="comment">// Field-level caching for better performance</span>
    <span class="variable">fetchPolicy</span>: <span class="string">'cache-first'</span>,
    <span class="variable">nextFetchPolicy</span>: <span class="string">'cache-and-network'</span>,
    <span class="variable">errorPolicy</span
: <span class="string">'all'</span>,
    <span class="comment">// Cache configuration for optimal performance</span>
    <span class="variable">notifyOnNetworkStatusChange</span>: <span class="keyword">true</span>,
    <span class="variable">pollInterval</span>: <span class="number">0</span>, <span class="comment">// Disabled for manual refresh</span>
    <span class="variable">partialRefetch</span>: <span class="keyword">true</span>
  });
  
  <span class="keyword">const</span> { <span class="variable">data</span>: <span class="variable">messagesData</span> } = <span class="function">useQuery</span>(GET_MESSAGES_OPTIMIZED, {
    <span class="variable">variables</span>: { 
      <span class="variable">chatId</span>, 
      <span class="variable">limit</span>: <span class="number">50</span>, 
      <span class="variable">includeMetadata</span>: showMetadata 
    },
    <span class="comment">// Different caching for messages</span>
    <span class="variable">fetchPolicy</span>: <span class="string">'cache-and-network'</span>,
    <span class="variable">nextFetchPolicy</span>: <span class="string">'cache-first'</span>
  });
  
  <span class="comment">// Use subscription for real-time updates</span>
  <span class="keyword">const</span> { <span class="variable">data</span>: <span class="variable">newMessage</span> } = <span class="function">useSubscription</span>(NEW_MESSAGE_SUBSCRIPTION, {
    <span class="variable">variables</span>: { <span class="variable">chatId</span> },
    <span class="comment">// Skip subscription if chat is not active</span>
    <span class="variable">skip</span>: !chatId
  });
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;ChatHeader</span> <span class="attr">chat</span>=<span class="punct">{</span>chatData?.chat<span class="punct">}</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;MessageList</span> <span class="attr">messages</span>=<span class="punct">{</span>messagesData?.messages<span class="punct">}</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  );
};

<span class="comment">// Apollo Client configuration with optimized caching</span>
<span class="keyword">const</span> <span class="variable">client</span> = <span class="keyword">new</span> <span class="function">ApolloClient</span>({
  <span class="variable">uri</span>: <span class="string">'/graphql'</span>,
  <span class="variable">cache</span>: <span class="keyword">new</span> <span class="function">InMemoryCache</span>({
    <span class="comment">// Type-based caching policies</span>
    <span class="variable">typePolicies</span>: {
      <span class="function">Query</span>: {
        <span class="variable">fields</span>: {
          <span class="function">messages</span>: {
            <span class="comment">// Merge function for pagination</span>
            <span class="function">merge</span>(existing, incoming, { <span class="variable">args</span> }) {
              <span class="keyword">if</span> (!existing) <span class="keyword">return</span> incoming;
              
              <span class="keyword">const</span> <span class="variable">merged</span> = existing.<span class="variable">slice</span>(<span class="number">0</span>);
              
              <span class="keyword">if</span> (args?.<span class="variable">offset</span> > <span class="number">0</span>) {
                <span class="comment">// Append for pagination</span>
                <span class="keyword">return</span> [...existing, ...incoming];
              } <span class="keyword">else</span> {
                <span class="comment">// Replace for fresh data</span>
                <span class="keyword">return</span> incoming;
              }
            },
            <span class="comment">// Cache key arguments</span>
            <span class="function">keyArgs</span>: [<span class="string">'chatId'</span>, <span class="string">'includeMetadata'</span>]
          },
          <span class="function">chat</span>: {
            <span class="function">merge</span>(existing, incoming) {
              <span class="keyword">return</span> { ...existing, ...incoming };
            },
            <span class="function">keyArgs</span>: [<span class="string">'id'</span>]
          }
        }
      },
      <span class="function">Message</span>: {
        <span class="variable">keyFields</span>: [<span class="string">'id'</span>]
      },
      <span class="function">Chat</span>: {
        <span class="variable">keyFields</span>: [<span class="string">'id'</span>]
      }
    },
    <span class="comment">// Field-level caching configuration</span>
    <span class="variable">possibleTypes</span> <span class="comment">// For union types</span>
  }),
  <span class="comment">// Query deduplication for performance</span>
  <span class="variable">queryDeduplication</span>: <span class="keyword">true</span>,
  <span class="comment">// Default request options</span>
  <span class="variable">defaultOptions</span>: {
    <span class="variable">watchQuery</span>: {
      <span class="variable">errorPolicy</span>: <span class="string">'all'</span>,
      <span class="variable">notifyOnNetworkStatusChange</span>: <span class="keyword">true</span>,
      <span class="variable">refetchOnReconnect</span>: <span class="keyword">true</span>
    },
    <span class="variable">query</span>: {
      <span class="variable">errorPolicy</span>: <span class="string">'all'</span>
    }
  }
});</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Reduced data transfer by fetching only needed fields</li>
                            <li>@defer and @stream directives improve perceived performance</li>
                            <li>Field-level caching reduces redundant network requests</li>
                            <li>Intelligent query selection based on component requirements</li>
                            <li>Better cache management with type-based policies</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement field-level caching, use GraphQL @defer and @stream directives, and optimize query selection based on component needs.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Missing Performance Monitoring</div>
                        <div class="issue-meta">
                            <span class="badge badge-low">Low</span>
                            <span class="badge badge-performance">Performance</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    While there's some performance tracking, comprehensive monitoring and alerting is missing.
                </div>
                <div class="issue-location">
                    üìÅ Limited performance monitoring in utils
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement Real User Monitoring (RUM), add performance budgets and alerts, and create performance regression testing.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Limited Monitoring)</div>
                                <div class="code-block">
<pre><span class="comment">// MISSING: Comprehensive performance tracking</span>
<span class="comment">// Only basic loading metrics exist</span>
<span class="keyword">const</span> <span class="function">trackLoadTime</span> = () => {
  <span class="keyword">const</span> <span class="variable">loadTime</span> = performance.<span class="function">timing</span>.<span class="variable">loadEventEnd</span> - performance.<span class="function">timing</span>.<span class="variable">navigationStart</span>;
  console.<span class="function">log</span>(<span class="string">'Load time:'</span>, loadTime);
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Comprehensive Monitoring)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Comprehensive performance monitoring system</span>

<span class="keyword">class</span> <span class="function">PerformanceMonitor</span> {
  <span class="keyword">constructor</span>() {
    <span class="keyword">this</span>.<span class="variable">metrics</span> = <span class="keyword">new</span> <span class="function">Map</span>();
    <span class="keyword">this</span>.<span class="variable">observers</span> = <span class="keyword">new</span> <span class="function">Set</span>();
    <span class="keyword">this</span>.<span class="variable">budgets</span> = {
      <span class="variable">firstContentfulPaint</span>: <span class="number">1500</span>,
      <span class="variable">largestContentfulPaint</span>: <span class="number">2500</span>,
      <span class="variable">firstInputDelay</span>: <span class="number">100</span>,
      <span class="variable">cumulativeLayoutShift</span>: <span class="number">0.1</span>,
      <span class="variable">bundleSize</span>: <span class="number">250000</span>, <span class="comment">// 250KB</span>
      <span class="variable">apiResponseTime</span>: <span class="number">500</span>
    };
  }
  
  <span class="function">initialize</span>() {
    <span class="comment">// Core Web Vitals monitoring</span>
    <span class="keyword">this</span>.<span class="function">observeWebVitals</span>();
    
    <span class="comment">// Resource timing monitoring</span>
    <span class="keyword">this</span>.<span class="function">observeResourceTiming</span>();
    
    <span class="comment">// User interaction monitoring</span>
    <span class="keyword">this</span>.<span class="function">observeUserInteractions</span>();
    
    <span class="comment">// Memory usage monitoring</span>
    <span class="keyword">this</span>.<span class="function">observeMemoryUsage</span>();
    
    <span class="comment">// Network performance monitoring</span>
    <span class="keyword">this</span>.<span class="function">observeNetworkPerformance</span>();
  }
  
  <span class="function">observeWebVitals</span>() {
    <span class="comment">// First Contentful Paint</span>
    <span class="keyword">new</span> <span class="function">PerformanceObserver</span>((entryList) => {
      <span class="keyword">const</span> <span class="variable">entries</span> = entryList.<span class="function">getEntries</span>();
      <span class="keyword">const</span> <span class="variable">fcp</span> = entries[entries.<span class="variable">length</span> - <span class="number">1</span>].<span class="variable">startTime</span>;
      <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'firstContentfulPaint'</span>, fcp);
      <span class="keyword">this</span>.<span class="function">checkBudget</span>(<span class="string">'firstContentfulPaint'</span>, fcp);
    }).<span class="function">observe</span>({ <span class="variable">type</span>: <span class="string">'paint'</span> });
    
    <span class="comment">// Largest Contentful Paint</span>
    <span class="keyword">new</span> <span class="function">PerformanceObserver</span>((entryList) => {
      <span class="keyword">const</span> <span class="variable">entries</span> = entryList.<span class="function">getEntries</span>();
      <span class="keyword">const</span> <span class="variable">lcp</span> = entries[entries.<span class="variable">length</span> - <span class="number">1</span>].<span class="function">startTime</span>;
      <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'largestContentfulPaint'</span>, lcp);
      <span class="keyword">this</span>.<span class="function">checkBudget</span>(<span class="string">'largestContentfulPaint'</span>, lcp);
    }).<span class="function">observe</span>({ <span class="variable">type</span>: <span class="string">'largest-contentful-paint'</span>, <span class="variable">buffered</span>: <span class="keyword">true</span> });
    
    <span class="comment">// First Input Delay</span>
    <span class="keyword">new</span> <span class="function">PerformanceObserver</span>((entryList) => {
      <span class="keyword">const</span> <span class="variable">entries</span> = entryList.<span class="function">getEntries</span>();
      entries.<span class="function">forEach</span>(entry => {
        <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'firstInputDelay'</span>, entry.<span class="variable">processingStart</span> - entry.<span class="variable">startTime</span>);
        <span class="keyword">this</span>.<span class="function">checkBudget</span>(<span class="string">'firstInputDelay'</span>, entry.<span class="variable">processingStart</span> - entry.<span class="variable">startTime</span>);
      });
    }).<span class="function">observe</span>({ <span class="variable">type</span>: <span class="string">'first-input'</span>, <span class="variable">buffered</span>: <span class="keyword">true</span> });
    
    <span class="comment">// Cumulative Layout Shift</span>
    <span class="keyword">let</span> <span class="variable">clsValue</span> = <span class="number">0</span>;
    <span class="keyword">new</span> <span class="function">PerformanceObserver</span>((entryList) => {
      <span class="keyword">const</span> <span class="variable">entries</span> = entryList.<span class="function">getEntries</span>();
      entries.<span class="function">forEach</span>(entry => {
        <span class="keyword">if</span> (!entry.<span class="function">hadRecentInput</span>()) {
          clsValue += entry.<span class="variable">value</span>;
          <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'cumulativeLayoutShift'</span>, clsValue);
          <span class="keyword">this</span>.<span class="function">checkBudget</span>(<span class="string">'cumulativeLayoutShift'</span>, clsValue);
        }
      });
    }).<span class="function">observe</span>({ <span class="variable">type</span>: <span class="string">'layout-shift'</span>, <span class="variable">buffered</span>: <span class="keyword">true</span> });
  }
  
  <span class="function">observeResourceTiming</span>() {
    <span class="keyword">new</span> <span class="function">PerformanceObserver</span>((entryList) => {
      <span class="keyword">const</span> <span class="variable">entries</span> = entryList.<span class="function">getEntries</span>();
      
      <span class="keyword">entries</span>.<span class="function">forEach</span>(entry => {
        <span class="keyword">if</span> (entry.<span class="variable">initiatorType</span> === <span class="string">'script'</span> || entry.<span class="variable">initiatorType</span> === <span class="string">'link'</span>) {
          <span class="keyword">const</span> <span class="variable">loadTime</span> = entry.<span class="variable">responseEnd</span> - entry.<span class="variable">startTime</span>;
          <span class="keyword">const</span> <span class="variable">size</span> = entry.<span class="variable">transferSize</span> || entry.<span class="variable">encodedBodySize</span>;
          
          <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'resourceLoad'</span>, {
            <span class="variable">name</span>: entry.<span class="variable">name</span>,
            <span class="variable">type</span>: entry.<span class="variable">initiatorType</span>,
            <span class="variable">loadTime</span>,
            <span class="variable">size</span>
          });
          
          <span class="comment">// Track bundle size</span>
          <span class="keyword">if</span> (entry.<span class="variable">name</span>.<span class="function">includes</span>(<span class="string">'widget'</span>)) {
            <span class="keyword">this</span>.<span class="function">checkBudget</span>(<span class="string">'bundleSize'</span>, size);
          }
        }
      });
    }).<span class="function">observe</span>({ <span class="variable">type</span>: <span class="string">'resource'</span>, <span class="variable">buffered</span>: <span class="keyword">true</span> });
  }
  
  <span class="function">observeUserInteractions</span>() {
    <span class="comment">// Track interaction latency</span>
    <span class="keyword">const</span> <span class="function">measureInteraction</span> = (eventName) => {
      <span class="keyword">const</span> <span class="variable">startTime</span> = performance.<span class="function">now</span>();
      
      <span class="keyword">return</span> () => {
        <span class="keyword">const</span> <span class="variable">duration</span> = performance.<span class="function">now</span>() - startTime;
        <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'interactionLatency'</span>, {
          <span class="variable">event</span>: eventName,
          <span class="variable">duration</span>
        });
      };
    };
    
    <span class="comment">// Monitor key interactions</span>
    document.<span class="function">addEventListener</span>(<span class="string">'click'</span>, (e) => {
      <span class="keyword">const</span> <span class="variable">endMeasure</span> = <span class="function">measureInteraction</span>(<span class="string">'click'</span>);
      <span class="function">setTimeout</span>(endMeasure, <span class="number">0</span>);
    });
    
    document.<span class="function">addEventListener</span>(<span class="string">'submit'</span>, (e) => {
      <span class="keyword">const</span> <span class="variable">endMeasure</span> = <span class="function">measureInteraction</span>(<span class="string">'formSubmit'</span>);
      <span class="function">setTimeout</span>(endMeasure, <span class="number">0</span>);
    });
  }
  
  <span class="function">observeMemoryUsage</span>() {
    <span class="keyword">if</span> (<span class="string">'memory'</span> <span class="keyword">in</span> performance) {
      <span class="keyword">const</span> <span class="function">measureMemory</span> = () => {
        <span class="keyword">const</span> <span class="variable">memoryInfo</span> = performance.<span class="variable">memory</span>;
        
        <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'memoryUsage'</span>, {
          <span class="variable">usedJSHeapSize</span>: memoryInfo.<span class="variable">usedJSHeapSize</span>,
          <span class="variable">totalJSHeapSize</span>: memoryInfo.<span class="variable">totalJSHeapSize</span>,
          <span class="variable">jsHeapSizeLimit</span>: memoryInfo.<span class="variable">jsHeapSizeLimit</span>,
          <span class="variable">usagePercentage</span>: (memoryInfo.<span class="variable">usedJSHeapSize</span> / memoryInfo.<span class="variable">jsHeapSizeLimit</span>) * <span class="number">100</span>
        });
        
        <span class="comment">// Alert if memory usage is high</span>
        <span class="keyword">if</span> (memoryInfo.<span class="variable">usedJSHeapSize</span> > memoryInfo.<span class="variable">jsHeapSizeLimit</span> * <span class="number">0.8</span>) {
          <span class="keyword">this</span>.<span class="function">sendAlert</span>({
            <span class="variable">type</span>: <span class="string">'memory_warning'</span>,
            <span class="variable">message</span>: <span class="string">'High memory usage detected'</span>,
            <span class="variable">severity</span>: <span class="string">'warning'</span>
          });
        }
      };
      
      <span class="comment">// Measure memory every 30 seconds</span>
      <span class="function">setInterval</span>(measureMemory, <span class="number">30000</span>);
      measureMemory(); <span class="comment">// Initial measurement</span>
    }
  }
  
  <span class="function">observeNetworkPerformance</span>() {
    <span class="comment">// Monitor GraphQL requests</span>
    <span class="keyword">const</span> <span class="variable">originalFetch</span> = window.<span class="variable">fetch</span>;
    
    window.<span class="variable">fetch</span> = <span class="keyword">async</span> (...args) => {
      <span class="keyword">const</span> <span class="variable">startTime</span> = performance.<span class="function">now</span>();
      <span class="keyword">const</span> [<span class="variable">url</span>, <span class="variable">options</span>] = args;
      
      <span class="keyword">try</span> {
        <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="function">originalFetch</span>(...args);
        <span class="keyword">const</span> <span class="variable">endTime</span> = performance.<span class="function">now</span>();
        <span class="keyword">const</span> <span class="variable">duration</span> = endTime - startTime;
        
        <span class="keyword">if</span> (url.<span class="function">includes</span>(<span class="string">'/graphql'</span>)) {
          <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'graphqlRequest'</span>, {
            <span class="variable">url</span>,
            <span class="variable">duration</span>,
            <span class="variable">status</span>: response.<span class="variable">status</span>,
            <span class="variable">size</span>: response.<span class="variable">headers</span>.<span class="function">get</span>(<span class="string">'content-length'</span>)
          });
          
          <span class="keyword">this</span>.<span class="function">checkBudget</span>(<span class="string">'apiResponseTime'</span>, duration);
        }
        
        <span class="keyword">return</span> response;
      } <span class="keyword">catch</span> (error) {
        <span class="keyword">const</span> <span class="variable">endTime</span> = performance.<span class="function">now</span>();
        <span class="keyword">const</span> <span class="variable">duration</span> = endTime - startTime;
        
        <span class="keyword">this</span>.<span class="function">recordMetric</span>(<span class="string">'networkError'</span>, {
          <span class="variable">url</span>,
          <span class="variable">duration</span>,
          <span class="variable">error</span>: error.<span class="variable">message</span>
        });
        
        <span class="keyword">throw</span> error;
      }
    };
  }
  
  <span class="function">recordMetric</span>(name, value) {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.<span class="variable">metrics</span>.<span class="function">has</span>(name)) {
      <span class="keyword">this</span>.<span class="variable">metrics</span>.<span class="function">set</span>(name, []);
    }
    
    <span class="keyword">this</span>.<span class="variable">metrics</span>.<span class="function">get</span>(name).<span class="function">push</span>({
      <span class="variable">value</span>,
      <span class="variable">timestamp</span>: Date.<span class="function">now</span>(),
      <span class="variable">userAgent</span>: navigator.<span class="variable">userAgent</span>
    });
    
    <span class="comment">// Keep only last 100 entries per metric</span>
    <span class="keyword">const</span> <span class="variable">entries</span> = <span class="keyword">this</span>.<span class="variable">metrics</span>.<span class="function">get</span>(name);
    <span class="keyword">if</span> (<span class="variable">entries</span>.<span class="variable">length</span> > <span class="number">100</span>) {
      <span class="variable">entries</span>.<span class="function">shift</span>();
    }
    
    <span class="comment">// Notify observers</span>
    <span class="keyword">this</span>.<span class="variable">observers</span>.<span class="function">forEach</span>(observer => {
      observer.<span class="function">onMetric</span>(name, value);
    });
  }
  
  <span class="function">checkBudget</span>(metric, value) {
    <span class="keyword">const</span> <span class="variable">budget</span> = <span class="keyword">this</span>.<span class="variable">budgets</span>[metric];
    
    <span class="keyword">if</span> (budget && value > budget) {
      <span class="keyword">this</span>.<span class="function">sendAlert</span>({
        <span class="variable">type</span>: <span class="string">'budget_exceeded'</span>,
        <span class="variable">metric</span>,
        <span class="variable">value</span>,
        <span class="variable">budget</span>,
        <span class="variable">severity</span>: <span class="string">'warning'</span>
      });
    }
  }
  
  <span class="function">sendAlert</span>(alert) {
    <span class="comment">// Send to monitoring service</span>
    <span class="function">fetch</span>(<span class="string">'/api/performance-alerts'</span>, {
      <span class="variable">method</span>: <span class="string">'POST'</span>,
      <span class="variable">headers</span>: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
      <span class="variable">body</span>: JSON.<span class="function">stringify</span>(alert)
    }).<span class="function">catch</span>(error => {
      console.<span class="function">error</span>(<span class="string">'Failed to send performance alert:'</span>, error);
    });
    
    <span class="comment">// Log to console in development</span>
    <span class="keyword">if</span> (process.<span class="variable">env</span>.<span class="variable">NODE_ENV</span> === <span class="string">'development'</span>) {
      console.<span class="function">warn</span>(<span class="string">'Performance Alert:'</span>, alert);
    }
  }
  
  <span class="function">getMetrics</span>() {
    <span class="keyword">const</span> <span class="variable">result</span> = {};
    
    <span class="keyword">this</span>.<span class="variable">metrics</span>.<span class="function">forEach</span>((<span class="variable">entries</span>, name) => {
      <span class="keyword">const</span> <span class="variable">values</span> = <span class="variable">entries</span>.<span class="function">map</span>(entry => 
        <span class="keyword">typeof</span> entry.<span class="variable">value</span> === <span class="string">'object'</span> ? entry.<span class="variable">value</span>.<span class="variable">duration</span> || entry.<span class="variable">value</span>.<span class="variable">usagePercentage</span> || entry.<span class="variable">value</span> : entry.<span class="variable">value</span>
      ).<span class="function">filter</span>(value => <span class="keyword">typeof</span> value === <span class="string">'number'</span>);
      
      <span class="keyword">if</span> (<span class="variable">values</span>.<span class="variable">length</span> > <span class="number">0</span>) {
        result[name] = {
          <span class="variable">current</span>: <span class="variable">values</span>[<span class="variable">values</span>.<span class="variable">length</span> - <span class="number">1</span>],
          <span class="variable">average</span>: <span class="variable">values</span>.<span class="function">reduce</span>((a, b) => a + b, <span class="number">0</span>) / <span class="variable">values</span>.<span class="variable">length</span>,
          <span class="variable">min</span>: Math.<span class="function">min</span>(...<span class="variable">values</span>),
          <span class="variable">max</span>: Math.<span class="function">max</span>(...<span class="variable">values</span>),
          <span class="variable">samples</span>: <span class="variable">values</span>.<span class="variable">length</span>
        };
      }
    });
    
    <span class="keyword">return</span> result;
  }
  
  <span class="function">subscribe</span>(observer) {
    <span class="keyword">this</span>.<span class="variable">observers</span>.<span class="function">add</span>(observer);
    
    <span class="keyword">return</span> () => {
      <span class="keyword">this</span>.<span class="variable">observers</span>.<span class="function">delete</span>(observer);
    };
  }
}

<span class="comment">// Initialize performance monitoring</span>
<span class="keyword">const</span> <span class="variable">performanceMonitor</span> = <span class="keyword">new</span> <span class="function">PerformanceMonitor</span>();

<span class="comment">// React hook for performance monitoring</span>
<span class="keyword">const</span> <span class="function">usePerformanceMonitor</span> = (<span class="variable">componentName</span>) => {
  <span class="function">useEffect</span>(() => {
    <span class="keyword">const</span> <span class="variable">startTime</span> = performance.<span class="function">now</span>();
    
    <span class="keyword">return</span> () => {
      <span class="keyword">const</span> <span class="variable">renderTime</span> = performance.<span class="function">now</span>() - startTime;
      
      performanceMonitor.<span class="function">recordMetric</span>(<span class="string">'componentRender'</span>, {
        <span class="variable">component</span>: componentName,
        <span class="variable">renderTime</span>
      });
    };
  }, [componentName]);
};

<span class="comment">// Usage in components</span>
<span class="keyword">const</span> <span class="function">ChatComponent</span> = () => {
  <span class="function">usePerformanceMonitor</span>(<span class="string">'ChatComponent'</span>);
  
  <span class="comment">// Component logic...</span>
  
  <span class="keyword">return</span> <span class="tag">&lt;div&gt;</span>Chat<span class="tag">&lt;/div&gt;</span>;
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Real-time monitoring of Core Web Vitals and performance metrics</li>
                            <li>Proactive alerts when performance budgets are exceeded</li>
                            <li>Detailed insights into user interaction latency</li>
                            <li>Memory usage monitoring helps prevent leaks</li>
                            <li>Network performance tracking identifies bottlenecks</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement Real User Monitoring (RUM), add performance budgets and alerts, and create performance regression testing.</p>
                </div>
            </div>
        </section>

        <section id="code-quality-improvements" class="section">
            <h2>
                <span class="section-icon">üìù</span>
                Code Quality Improvements
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Inconsistent Code Style</div>
                        <div class="issue-meta">
                            <span class="badge badge-low">Low</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Code style is inconsistent across files, with mixed naming conventions and formatting.
                </div>
                <div class="issue-location">
                    üìÅ Multiple files with inconsistent styles
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement ESLint with strict rules, add Prettier for consistent formatting, and create pre-commit hooks for code quality enforcement.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Inconsistent Style)</div>
                                <div class="code-block">
<pre><span class="comment">// INCONSISTENT: Mixed naming conventions</span>
<span class="keyword">const</span> [<span class="variable">websiteId</span>, setWebsiteId] = <span class="function">useState</span>(<span class="function">store</span>(<span class="string">'websiteId'</span>)); <span class="comment">// camelCase</span>
<span class="keyword">const</span> <span class="variable">CONSUMER_LOGIN</span> = gql<span class="punct">`</span>...<span class="punct">`</span>; <span class="comment">// UPPER_SNAKE_CASE</span>
<span class="keyword">const</span> <span class="function">createChat</span> = <span class="keyword">async</span> (...) => {...}; <span class="comment">// camelCase</span>

<span class="comment">// Inconsistent formatting</span>
<span class="keyword">const</span> <span class="function">handleSubmit</span> = <span class="keyword">async</span>() => {
  <span class="keyword">if</span>(!message.<span class="variable">trim</span>())<span class="keyword">return</span>;
  <span class="keyword">await</span> <span class="function">sendMessage</span>(message);
};

<span class="comment">// Mixed import styles</span>
<span class="keyword">import</span> React,{useState,useEffect} <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> {GET_CHAT} <span class="keyword">from</span> <span class="string">'./queries'</span>;
<span class="keyword">import</span> ChatContainer <span class="keyword">from</span> <span class="string">'./ChatContainer'</span>;</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Consistent Style)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Consistent code style with automated enforcement</span>

<span class="comment">// .eslintrc.js</span>
<span class="keyword">module</span>.<span class="variable">exports</span> = {
  <span class="variable">extends</span>: [
    <span class="string">'eslint:recommended'</span>,
    <span class="string">'@typescript-eslint/recommended'</span>,
    <span class="string">'plugin:react/recommended'</span>,
    <span class="string">'plugin:react-hooks/recommended'</span>,
    <span class="string">'plugin:jsx-a11y/recommended'</span>,
    <span class="string">'prettier'</span>
  ],
  <span class="variable">plugins</span>: [
    <span class="string">'@typescript-eslint'</span>,
    <span class="string">'react'</span>,
    <span class="string">'react-hooks'</span>,
    <span class="string">'jsx-a11y'</span>,
    <span class="string">'prettier'</span>
  ],
  <span class="variable">rules</span>: {
    <span class="comment">// Naming conventions</span>
    <span class="string">'camelcase'</span>: [<span class="string">'error'</span>, { <span class="variable">properties</span>: <span class="string">'never'</span> }],
    <span class="string">'@typescript-eslint/naming-convention'</span>: [
      <span class="string">'error'</span>,
      {
        <span class="variable">selector</span>: <span class="string">'variable'</span>,
        <span class="variable">format</span>: [<span class="string">'camelCase'</span>, <span class="string">'UPPER_CASE'</span>],
        <span class="variable">filter</span>: {
          <span class="variable">regex</span>: <span class="string">'^(.*[A-Z].*|^[A-Z][a-z]+(?:[A-Z][a-z]+)*)$'</span>,
          <span class="variable">match</span>: <span class="keyword">true</span>
        }
      },
      {
        <span class="variable">selector</span>: <span class="string">'function'</span>,
        <span class="variable">format</span>: [<span class="string">'camelCase'</span>]
      },
      {
        <span class="variable">selector</span>: <span class="string">'typeLike'</span>,
        <span class="variable">format</span>: [<span class="string">'PascalCase'</span>]
      },
      {
        <span class="variable">selector</span>: <span class="string">'variable'</span>,
        <span class="variable">modifiers</span>: [<span class="string">'const'</span>],
        <span class="variable">format</span>: [<span class="string">'UPPER_CASE'</span>],
        <span class="variable">filter</span>: {
          <span class="variable">regex</span>: <span class="string">'^[A-Z]+(_[A-Z]+)*$'</span>,
          <span class="variable">match</span>: <span class="keyword">true</span>
        }
      }
    ],
    
    <span class="comment">// Import organization</span>
    <span class="string">'sort-imports'</span>: [
      <span class="string">'error'</span>,
      {
        <span class="variable">groups</span>: [
          <span class="string">'builtin'</span>,
          <span class="string">'external'</span>,
          <span class="string">'internal'</span>,
          <span class="string">'parent'</span>,
          <span class="string">'sibling'</span>,
          <span class="string">'index'</span>
        ],
        <span class="variable">order</span>: <span class="string">'asc'</span>,
        <span class="variable">newlines-between</span>: <span class="string">'always'</span>
      }
    ],
    
    <span class="comment">// React specific rules</span>
    <span class="string">'react/prop-types'</span>: <span class="string">'off'</span>, <span class="comment">// Using TypeScript instead</span>
    <span class="string">'react/react-in-jsx-scope'</span>: <span class="string">'off'</span>, <span class="comment">// Not needed with React 17+</span>
    <span class="string">'react-hooks/rules-of-hooks'</span>: <span class="string">'error'</span>,
    <span class="string">'react-hooks/exhaustive-deps'</span>: <span class="string">'warn'</span>,
    
    <span class="comment">// Accessibility</span>
    <span class="string">'jsx-a11y/anchor-is-valid'</span>: <span class="string">'off'</span>, <span class="comment">// Next.js handles this</span>
    <span class="string">'jsx-a11y/alt-text'</span>: <span class="string">'error'</span>,
    <span class="string">'jsx-a11y/aria-props'</span>: <span class="string">'error'</span>,
    
    <span class="comment">// Code quality</span>
    <span class="string">'no-console'</span>: <span class="string">'warn'</span>,
    <span class="string">'no-debugger'</span>: <span class="string">'error'</span>,
    <span class="string">'no-alert'</span>: <span class="string">'error'</span>,
    <span class="string">'prefer-const'</span>: <span class="string">'error'</span>,
    <span class="string">'no-var'</span>: <span class="string">'error'</span>
  },
  <span class="variable">env</span>: {
    <span class="variable">browser</span>: <span class="keyword">true</span>,
    <span class="variable">es2021</span>: <span class="keyword">true</span>,
    <span class="variable">node</span>: <span class="keyword">true</span>
  },
  <span class="variable">parser</span>: <span class="string">'@typescript-eslint/parser'</span>,
  <span class="variable">parserOptions</span>: {
    <span class="variable">ecmaVersion</span>: <span class="number">2021</span>,
    <span class="variable">sourceType</span>: <span class="string">'module'</span>,
    <span class="variable">ecmaFeatures</span>: {
      <span class="variable">jsx</span>: <span class="keyword">true</span>
    }
  },
  <span class="variable">settings</span>: {
    <span class="variable">react</span>: {
      <span class="variable">version</span>: <span class="string">'detect'</span>
    }
  }
};

<span class="comment">// .prettierrc.js</span>
<span class="keyword">module</span>.<span class="variable">exports</span> = {
  <span class="variable">semi</span>: <span class="keyword">true</span>,
  <span class="variable">trailingComma</span>: <span class="string">'es5'</span>,
  <span class="variable">singleQuote</span>: <span class="keyword">true</span>,
  <span class="variable">printWidth</span>: <span class="number">80</span>,
  <span class="variable">tabWidth</span>: <span class="number">2</span>,
  <span class="variable">useTabs</span>: <span class="keyword">false</span>,
  <span class="variable">bracketSpacing</span>: <span class="keyword">true</span>,
  <span class="variable">bracketSameLine</span>: <span class="keyword">false</span>,
  <span class="variable">arrowParens</span>: <span class="string">'avoid'</span>,
  <span class="variable">endOfLine</span>: <span class="string">'lf'</span>,
  <span class="variable">quoteProps</span>: <span class="string">'as-needed'</span>,
  <span class="variable">jsxSingleQuote</span>: <span class="keyword">false</span>,
  <span class="variable">proseWrap</span>: <span class="string">'preserve'</span>
};

<span class="comment">// package.json scripts</span>
{
  <span class="string">"scripts"</span>: {
    <span class="string">"lint"</span>: <span class="string">"eslint src/ --ext .js,.jsx,.ts,.tsx --fix"</span>,
    <span class="string">"lint:check"</span>: <span class="string">"eslint src/ --ext .js,.jsx,.ts,.tsx"</span>,
    <span class="string">"format"</span>: <span class="string">"prettier --write src/**/*.{js,jsx,ts,tsx,css,md}"</span>,
    <span class="string">"format:check"</span>: <span class="string">"prettier --check src/**/*.{js,jsx,ts,tsx,css,md}"</span>,
    <span class="string">"pre-commit"</span>: <span class="string">"lint-staged"</span>
  },
  <span class="string">"lint-staged"</span>: {
    <span class="string">"src/**/*.{js,jsx,ts,tsx}"</span>: [
      <span class="string">"eslint --fix"</span>,
      <span class="string">"prettier --write"</span>
    ],
    <span class="string">"src/**/*.{css,md}"</span>: [
      <span class="string">"prettier --write"</span>
    ]
  },
  <span class="string">"husky"</span>: {
    <span class="string">"hooks"</span>: {
      <span class="string">"pre-commit"</span>: <span class="string">"lint-staged"</span>,
      <span class="string">"pre-push"</span>: <span class="string">"npm run lint:check && npm run format:check"</span>
    }
  }
}

<span class="comment">// Consistent code style examples</span>

<span class="comment">// ‚úÖ Correct: Consistent naming and formatting</span>
<span class="keyword">import</span> React, { <span class="function">useState</span>, <span class="function">useEffect</span> } <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> { <span class="variable">GET_CHAT</span> } <span class="keyword">from</span> <span class="string">'./queries'</span>;
<span class="keyword">import</span> { <span class="function">ChatContainer</span> } <span class="keyword">from</span> <span class="string">'./ChatContainer'</span>;

<span class="keyword">const</span> <span class="variable">CONSUMER_LOGIN_MUTATION</span> = gql<span class="punct">`</span>
  mutation ConsumerLogin($input: ConsumerLoginInput!) {
    consumerLogin(input: $input) {
      token
      user {
        id
        email
      }
    }
  }
<span class="punct">`</span>;

<span class="keyword">const</span> <span class="function">useChatState</span> = (<span class="variable">initialChatId</span>) => {
  <span class="keyword">const</span> [<span class="variable">websiteId</span>, setWebsiteId] = <span class="function">useState</span>(
    <span class="function">store</span>(<span class="string">'websiteId'</span>)
  );
  
  <span class="keyword">const</span> [<span class="variable">activeChat</span>, setActiveChat] = <span class="function">useState</span>(<span class="variable">initialChatId</span>);
  
  <span class="keyword">const</span> <span class="function">handleCreateChat</span> = <span class="keyword">async</span> () => {
    <span class="keyword">if</span> (!websiteId) {
      <span class="keyword">return</span>;
    }
    
    <span class="keyword">try</span> {
      <span class="keyword">const</span> <span class="variable">newChat</span> = <span class="keyword">await</span> <span class="function">createChat</span>({ websiteId });
      setActiveChat(newChat.<span class="variable">id</span>);
    } <span class="keyword">catch</span> (error) {
      console.<span class="function">error</span>(<span class="string">'Failed to create chat:'</span>, error);
    }
  };
  
  <span class="keyword">return</span> {
    websiteId,
    setWebsiteId,
    activeChat,
    setActiveChat,
    handleCreateChat
  };
};

<span class="comment">// ‚úÖ Correct: Component with proper structure</span>
<span class="keyword">const</span> <span class="function">ChatMessage</span> = ({
  <span class="variable">message</span>,
  <span class="variable">isOwn</span>,
  <span class="variable">onRead</span>
}) => {
  <span class="keyword">const</span> <span class="function">handleMessageRead</span> = <span class="function">useCallback</span>(() => {
    <span class="keyword">if</span> (!isOwn && !message.<span class="variable">isRead</span>) {
      <span class="function">onRead</span>(message.<span class="variable">id</span>);
    }
  }, [isOwn, message.<span class="variable">isRead</span>, message.<span class="variable">id</span>, onRead]);
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;div</span> <span class="attr">className</span>=<span class="punct">{</span>`chat-message ${isOwn ? 'own' : 'other'}`}<span class="punct">}</span><span class="tag">&gt;</span>
      <span class="tag">&lt;div</span> <span class="attr">className</span>=<span class="punct">"</span>message-content<span class="punct">"</span><span class="tag">&gt;</span>
        {message.<span class="variable">text</span>}
      <span class="tag">&lt;/div&gt;</span>
      <span class="tag">&lt;div</span> <span class="attr">className</span>=<span class="punct">"</span>message-meta<span class="punct">"</span><span class="tag">&gt;</span>
        <span class="tag">&lt;span</span> <span class="attr">className</span>=<span class="punct">"</span>timestamp<span class="punct">"</span><span class="tag">&gt;</span>
          {<span class="function">formatTimestamp</span>(message.<span class="variable">timestamp</span>)}
        <span class="tag">&lt;/span&gt;</span>
        {!isOwn && !message.<span class="variable">isRead</span> && (
          <span class="tag">&lt;button</span>
            <span class="attr">onClick</span>=<span class="punct">{</span>handleMessageRead<span class="punct">}</span>
            <span class="attr">aria-label</span>=<span class="punct">"</span>Mark as read<span class="punct">"</span>
          <span class="tag">&gt;</span>
            Mark as read
          <span class="tag">&lt;/button&gt;</span>
        )}
      <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Consistent code style improves readability and maintainability</li>
                            <li>Automated formatting reduces developer cognitive load</li>
                            <li>Pre-commit hooks ensure code quality before commits</li>
                            <li>ESLint rules catch potential bugs and enforce best practices</li>
                            <li>Better team collaboration with standardized style</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement ESLint with strict rules, add Prettier for consistent formatting, and create pre-commit hooks for code quality enforcement.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Missing TypeScript</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    The codebase uses plain JavaScript, missing the benefits of TypeScript's type safety and developer experience improvements.
                </div>
                <div class="issue-location">
                    üìÅ Entire codebase - no TypeScript
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Migrate to TypeScript gradually, add type definitions for GraphQL schemas, and implement strict type checking.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Plain JavaScript)</div>
                                <div class="code-block">
<pre><span class="comment">// MISSING: Type definitions</span>
<span class="keyword">const</span> <span class="function">createMessage</span> = <span class="keyword">async</span> (text, author, chatId) => {
  <span class="comment">// No type safety for parameters</span>
  <span class="keyword">const</span> <span class="variable">message</span> = {
    text,
    author,
    chatId,
    timestamp: Date.<span class="function">now</span>()
  };
  
  <span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> apolloClient.<span class="function">mutate</span>({
    <span class="variable">mutation</span>: CREATE_MESSAGE_MUTATION,
    <span class="variable">variables</span>: { <span class="variable">input</span>: message }
  });
  
  <span class="keyword">return</span> response.<span class="variable">data</span>.<span class="function">createMessage</span>;
};

<span class="comment">// Component without type safety</span>
<span class="keyword">const</span> <span class="function">MessageForm</span> = ({ <span class="variable">onSubmit</span>, <span class="variable">chatId</span>, <span class="variable">user</span> }) => {
  <span class="comment">// Props could be anything</span>
  <span class="keyword">const</span> [<span class="variable">message</span>, setMessage] = <span class="function">useState</span>(<span class="string">''</span>);
  
  <span class="keyword">const</span> <span class="function">handleSubmit</span> = () => {
    <span class="keyword">if</span> (message.<span class="function">trim</span>()) {
      <span class="function">onSubmit</span>({ text: message, chatId, user });
      setMessage(<span class="string">''</span>);
    }
  };
  
  <span class="keyword">return</span> (
    <span class="tag">&lt;form</span> <span class="attr">onSubmit</span>=<span class="punct">{</span>handleSubmit<span class="punct">}</span><span class="tag">&gt;</span>
      <span class="tag">&lt;input</span> <span class="attr">value</span>=<span class="punct">{</span>message<span class="punct">}</span> <span class="attr">onChange</span>=<span class="punct">{</span>(e) => setMessage(e.target.value)<span class="punct">}</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attr">type</span>=<span class="punct">"</span>submit<span class="punct">"</span><span class="tag">&gt;</span>Send<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;/form&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (TypeScript with Type Safety)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: TypeScript with comprehensive type definitions</span>

<span class="comment">// types/index.ts</span>
<span class="keyword">export</span> <span class="keyword">interface</span> <span class="function">User</span> {
  <span class="keyword">readonly</span> <span class="variable">id</span>: string;
  <span class="keyword">readonly</span> <span class="variable">email</span>: string;
  <span class="keyword">readonly</span> <span class="variable">name</span>?: string;
  <span class="keyword">readonly</span> <span class="variable">avatar</span>?: string;
  <span class="keyword">readonly</span> <span class="variable">role</span>: <span class="string">'user'</span> | <span class="string">'agent'</span> | <span class="string">'admin'</span>;
  <span class="keyword">readonly</span> <span class="variable">createdAt</span>: string;
  <span class="keyword">readonly</span> <span class="variable">updatedAt</span>: string;
}

<span class="keyword">export</span> <span class="keyword">interface</span> <span class="function">Message</span> {
  <span class="keyword">readonly</span> <span class="variable">id</span>: string;
  <span class="keyword">readonly</span> <span class="variable">text</span>: string;
  <span class="keyword">readonly</span> <span class="variable">author</span>: <span class="function">Pick</span>&lt;User, <span class="string">'id'</span> | <span class="string">'name'</span> | <span class="string">'avatar'</span>&gt;;
  <span class="keyword">readonly</span> <span class="variable">chatId</span>: string;
  <span class="keyword">readonly</span> <span class="variable">timestamp</span>: string;
  <span class="keyword">readonly</span> <span class="variable">isRead</span>?: boolean;
  <span class="keyword">readonly</span> <span class="variable">attachments</span>?: <span class="function">Attachment</span>[];
  <span class="keyword">readonly</span> <span class="variable">metadata</span>?: <span class="function">Record</span>&lt;string, unknown&gt;;
}

<span class="keyword">export</span> <span class="keyword">interface</span> <span class="function">Chat</span> {
  <span class="keyword">readonly</span> <span class="variable">id</span>: string;
  <span class="keyword">readonly</span> <span class="variable">status</span>: <span class="string">'active'</span> | <span class="string">'ended'</span> | <span class="string">'waiting'</span>;
  <span class="keyword">readonly</span> <span class="variable">createdAt</span>: string;
  <span class="keyword">readonly</span> <span class="variable">updatedAt</span>: string;
  <span class="keyword">readonly</span> <span class="variable">participants</span>: <span class="function">User</span>[];
  <span class="keyword">readonly</span> <span class="variable">messages</span>?: <span class="function">Message</span>[];
  <span class="keyword">readonly</span> <span class="variable">contract</span>?: <span class="function">Contract</span>;
}

<span class="keyword">export</span> <span class="keyword">interface</span> <span class="function">CreateMessageInput</span> {
  <span class="keyword">readonly</span> <span class="variable">text</span>: string;
  <span class="keyword">readonly</span> <span class="variable">chatId</span>: string;
  <span class="keyword">readonly</span> <span class="variable">authorId</span>: string;
}

<span class="keyword">export</span> <span class="keyword">interface</span> <span class="function">CreateMessageResponse</span> {
  <span class="keyword">readonly</span> <span class="variable">message</span>: <span class="function">Message</span>;
  <span class="keyword">readonly</span> <span class="variable">success</span>: boolean;
  <span class="keyword">readonly</span> <span class="variable">errors</span>?: string[];
}

<span class="comment">// Component props with strict typing</span>
<span class="keyword">interface</span> <span class="function">MessageFormProps</span> {
  <span class="keyword">readonly</span> <span class="variable">onSubmit</span>: (input: <span class="function">CreateMessageInput</span>) => <span class="function">Promise</span>&lt;<span class="function">CreateMessageResponse</span>&gt;;
  <span class="keyword">readonly</span> <span class="variable">chatId</span>: string;
  <span class="keyword">readonly</span> <span class="variable">user</span>: <span class="function">User</span>;
  <span class="keyword">readonly</span> <span class="variable">disabled</span>?: boolean;
  <span class="keyword">readonly</span> <span class="variable">placeholder</span>?: string;
  <span class="keyword">readonly</span> <span class="variable">maxLength</span>?: number;
}

<span class="comment">// GraphQL generated types</span>
<span class="comment">// types/graphql.ts</span>
<span class="keyword">export</span> <span class="keyword">type</span> <span class="function">Mutation</span> = {
  <span class="function">createMessage</span>?: (<span class="variable">input</span>: <span class="function">CreateMessageInput</span>) => <span class="function">Promise</span>&lt;<span class="function">CreateMessageResponse</span>&gt;;
  <span class="function">createChat</span>?: (<span class="variable">input</span>: <span class="function">CreateChatInput</span>) => <span class="function">Promise</span>&lt;<span class="function">CreateChatResponse</span>&gt;;
};

<span class="keyword">export</span> <span class="keyword">type</span> <span class="function">Query</span> = {
  <span class="function">chat</span>?: (<span class="variable">id</span>: string) => <span class="function">Promise</span>&lt;<span class="function">Chat</span> | <span class="keyword">null</span>&gt;;
  <span class="function">messages</span>?: (<span class="variable">chatId</span>: string, <span class="variable">limit</span>?: number) => <span class="function">Promise</span>&lt;<span class="function">Message</span>[]&gt;;
};

<span class="comment">// services/messageService.ts</span>
<span class="keyword">export</span> <span class="keyword">class</span> <span class="function">MessageService</span> {
  <span class="keyword">constructor</span>(<span class="keyword">private</span> <span class="keyword">readonly</span> apolloClient: <span class="function">ApolloClient</span>&lt;<span class="keyword">any</span>&gt;) {}

  <span class="keyword">public</span> <span class="keyword">async</span> <span class="function">createMessage</span>(
    input: <span class="function">CreateMessageInput</span>
  ): <span class="function">Promise</span>&lt;<span class="function">CreateMessageResponse</span>&gt; {
    <span class="comment">// Type-safe input validation</span>
    <span class="keyword">if</span> (!input.text?.<span class="variable">trim</span>()) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Message text cannot be empty'</span>);
    }

    <span class="keyword">if</span> (!input.chatId) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Chat ID is required'</span>);
    }

    <span class="keyword">if</span> (!input.authorId) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Author ID is required'</span>);
    }

    <span class="keyword">try</span> {
      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.apolloClient.<span class="function">mutate</span>&lt;<span class="function">Mutation</span>, { input: <span class="function">CreateMessageInput</span> }&gt;({
        <span class="variable">mutation</span>: CREATE_MESSAGE_MUTATION,
        <span class="variable">variables</span>: { input },
        <span class="variable">errorPolicy</span>: <span class="string">'all'</span>
      });

      <span class="keyword">if</span> (!response.data?.createMessage) {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Failed to create message'</span>);
      }

      <span class="keyword">return</span> response.data.createMessage;
    } <span class="keyword">catch</span> (error) {
      <span class="comment">// Type-safe error handling</span>
      <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="function">Error</span>) {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">`Message creation failed: ${error.message}`</span>);
      }
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Unknown error occurred during message creation'</span>);
    }
  }

  <span class="keyword">public</span> <span class="keyword">async</span> <span class="function">getMessages</span>(
    chatId: string,
    limit: number = <span class="number">50</span>
  ): <span class="function">Promise</span>&lt;<span class="function">Message</span>[]&gt; {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.apolloClient.<span class="function">query</span>&lt;<span class="function">Query</span>, { chatId: string; limit: number }&gt;({
      <span class="variable">query</span>: GET_MESSAGES_QUERY,
      <span class="variable">variables</span>: { chatId, limit },
      <span class="variable">errorPolicy</span>: <span class="string">'all'</span>
    });

    <span class="keyword">return</span> response.data?.messages ?? [];
  }
}

<span class="comment">// components/MessageForm.tsx</span>
<span class="keyword">import</span> React, { <span class="function">useState</span>, <span class="function">useCallback</span>, <span class="function">FormEvent</span> } <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> { <span class="function">MessageFormProps</span>, <span class="function">CreateMessageInput</span> } <span class="keyword">from</span> <span class="string">'../types'</span>;

<span class="keyword">export</span> <span class="keyword">const</span> <span class="function">MessageForm</span>: React.FC&lt;<span class="function">MessageFormProps</span>&gt; = ({
  onSubmit,
  chatId,
  user,
  disabled = <span class="keyword">false</span>,
  placeholder = <span class="string">'Type your message...'</span>,
  maxLength = <span class="number">1000</span>
}) => {
  <span class="keyword">const</span> [message, setMessage] = <span class="function">useState</span>&lt;string&gt;(<span class="string">''</span>);
  <span class="keyword">const</span> [isSubmitting, setIsSubmitting] = <span class="function">useState</span>&lt;boolean&gt;(<span class="keyword">false</span>);

  <span class="keyword">const</span> <span class="function">handleSubmit</span> = <span class="function">useCallback</span>(
    <span class="keyword">async</span> (event: <span class="function">FormEvent</span>&lt;HTMLFormElement&gt;) => {
      event.<span class="function">preventDefault</span>();

      <span class="keyword">if</span> (!message.<span class="function">trim</span>() || isSubmitting || disabled) {
        <span class="keyword">return</span>;
      }

      setIsSubmitting(<span class="keyword">true</span>);

      <span class="keyword">try</span> {
        <span class="keyword">const</span> input: <span class="function">CreateMessageInput</span> = {
          text: message.<span class="function">trim</span>(),
          chatId,
          authorId: user.id
        };

        <span class="keyword">await</span> <span class="function">onSubmit</span>(input);
        setMessage(<span class="string">''</span>);
      } <span class="keyword">catch</span> (error) {
        console.<span class="function">error</span>(<span class="string">'Failed to send message:'</span>, error);
      } <span class="keyword">finally</span> {
        setIsSubmitting(<span class="keyword">false</span>);
      }
    },
    [message, isSubmitting, disabled, onSubmit, chatId, user.id]
  );

  <span class="keyword">const</span> <span class="function">handleInputChange</span> = <span class="function">useCallback</span>(
    (event: React.<span class="function">ChangeEvent</span>&lt;HTMLInputElement&gt;) => {
      setMessage(event.target.value);
    },
    []
  );

  <span class="keyword">const</span> canSubmit = message.<span class="function">trim</span>().length > <span class="number">0</span> && !isSubmitting && !disabled;

  <span class="keyword">return</span> (
    <span class="tag">&lt;form</span> <span class="attr">onSubmit</span>=<span class="punct">{</span>handleSubmit<span class="punct">}</span> <span class="attr">className</span>=<span class="punct">"</span>message-form<span class="punct">"</span><span class="tag">&gt;</span>
      <span class="tag">&lt;input</span>
        <span class="attr">type</span>=<span class="punct">"</span>text<span class="punct">"</span>
        <span class="attr">value</span>=<span class="punct">{</span>message<span class="punct">}</span>
        <span class="attr">onChange</span>=<span class="punct">{</span>handleInputChange<span class="punct">}</span>
        <span class="attr">disabled</span>=<span class="punct">{</span>disabled || isSubmitting<span class="punct">}</span>
        <span class="attr">placeholder</span>=<span class="punct">{</span>placeholder<span class="punct">}</span>
        <span class="attr">maxLength</span>=<span class="punct">{</span>maxLength<span class="punct">}</span>
        <span class="attr">aria-label</span>=<span class="punct">"</span>Type your message<span class="punct">"</span>
      <span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span>
        <span class="attr">type</span>=<span class="punct">"</span>submit<span class="punct">"</span>
        <span class="attr">disabled</span>=<span class="punct">{</span>!canSubmit<span class="punct">}</span>
        <span class="attr">aria-label</span>=<span class="punct">"</span>Send message<span class="punct">"</span>
      <span class="tag">&gt;</span>
        {isSubmitting ? <span class="string">'Sending...'</span> : <span class="string">'Send'</span>}
      <span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;/form&gt;</span>
  );
};</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Type safety catches bugs at compile time instead of runtime</li>
                            <li>Better IDE support with auto-completion and refactoring</li>
                            <li>Self-documenting code with explicit type definitions</li>
                            <li>Easier refactoring with type checking</li>
                            <li>Improved team collaboration with clear interfaces</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Migrate to TypeScript gradually, add type definitions for GraphQL schemas, and implement strict type checking.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Limited Test Coverage</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Medium</span>
                            <span class="badge badge-architecture">Architecture</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    Test coverage is limited, especially for critical security and authentication flows.
                </div>
                <div class="issue-location">
                    üìÅ Limited test files in __tests__ directories
                </div>
                
                <div class="fix-details">
                    <div class="fix-section">
                        <h4>üîß How to Fix</h4>
                        <p>Implement comprehensive unit tests, add integration tests for critical flows, and create E2E tests for user journeys.</p>
                        
                        <div class="code-comparison">
                            <div class="code-before">
                                <div class="code-label">Before (Limited Testing)</div>
                                <div class="code-block">
<pre><span class="comment">// MISSING: Comprehensive test coverage</span>
<span class="comment">// Only utility functions have tests</span>

<span class="comment">// __tests__/utils.test.js</span>
<span class="function">describe</span>(<span class="string">'sanitize utility'</span>, () => {
  it(<span class="string">'should remove script tags'</span>, () => {
    <span class="keyword">const</span> <span class="variable">input</span> = <span class="string">'&lt;script&gt;alert("xss")&lt;/script&gt;Hello'</span>;
    <span class="keyword">const</span> <span class="variable">result</span> = <span class="function">sanitize</span>(input);
    expect(result).toBe(<span class="string">'Hello'</span>);
  });
});</pre>
                                </div>
                            </div>
                            <div class="code-after">
                                <div class="code-label">After (Comprehensive Testing)</div>
                                <div class="code-block">
<pre><span class="comment">// SECURE: Comprehensive testing strategy</span>

<span class="comment">// __tests__/security/auth.test.ts</span>
<span class="keyword">import</span> { render, screen, fireEvent, waitFor } <span class="keyword">from</span> <span class="string">'@testing-library/react'</span>;
<span class="keyword">import</span> { MockedProvider } <span class="keyword">from</span> <span class="string">'@apollo/client/testing'</span>;
<span class="keyword">import</span> { <span class="function">App</span> } <span class="keyword">from</span> <span class="string">'../../src/App'</span>;
<span class="keyword">import</span> { <span class="variable">CONSUMER_LOGIN_MUTATION</span>, <span class="variable">GET_CHAT_QUERY</span> } <span class="keyword">from</span> <span class="string">'../../src/queries'</span>;
<span class="keyword">import</span> { <span class="function">User</span>, <span class="function">Chat</span> } <span class="keyword">from</span> <span class="string">'../../src/types'</span>;

<span class="function">describe</span>(<span class="string">'Authentication Security'</span>, () => {
  <span class="keyword">const</span> <span class="function">mockUser</span>: <span class="function">User</span> = {
    id: <span class="string">'user-123'</span>,
    email: <span class="string">'test@example.com'</span>,
    name: <span class="string">'Test User'</span>,
    role: <span class="string">'user'</span>,
    createdAt: <span class="string">'2023-01-01T00:00:00Z'</span>,
    updatedAt: <span class="string">'2023-01-01T00:00:00Z'</span>
  };

  <span class="keyword">const</span> <span class="function">mockChat</span>: <span class="function">Chat</span> = {
    id: <span class="string">'chat-123'</span>,
    status: <span class="string">'active'</span>,
    createdAt: <span class="string">'2023-01-01T00:00:00Z'</span>,
    updatedAt: <span class="string">'2023-01-01T00:00:00Z'</span>,
    participants: [mockUser]
  };

  it(<span class="string">'should handle successful login securely'</span>, <span class="keyword">async</span> () => {
    <span class="keyword">const</span> <span class="variable">loginMock</span> = {
      <span class="variable">request</span>: {
        <span class="variable">query</span>: <span class="variable">CONSUMER_LOGIN_MUTATION</span>,
        <span class="variable">variables</span>: {
          <span class="variable">input</span>: {
            email: <span class="string">'test@example.com'</span>,
            password: <span class="string">'password123'</span>
          }
        }
      },
      <span class="variable">result</span>: {
        <span class="variable">data</span>: {
          consumerLogin: {
            token: <span class="string">'mock-jwt-token'</span>,
            user: mockUser
          }
        }
      }
    };

    render(
      <span class="tag">&lt;MockedProvider</span> <span class="attr">mocks</span>=<span class="punct">{</span>[loginMock]<span class="punct">}</span><span class="tag">&gt;</span>
        <span class="tag">&lt;App</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/MockedProvider&gt;</span>
    );

    <span class="comment">// Test login form interaction</span>
    <span class="keyword">const</span> emailInput = screen.<span class="function">getByLabelText</span>(<span class="string">'Email'</span>);
    <span class="keyword">const</span> passwordInput = screen.<span class="function">getByLabelText</span>(<span class="string">'Password'</span>);
    <span class="keyword">const</span> submitButton = screen.<span class="function">getByRole</span>(<span class="string">'button'</span>, { name: <span class="string">'Login'</span> });

    fireEvent.<span class="function">change</span>(emailInput, { target: { value: <span class="string">'test@example.com'</span> } });
    fireEvent.<span class="function">change</span>(passwordInput, { target: { value: <span class="string">'password123'</span> } });
    fireEvent.<span class="function">click</span>(submitButton);

    <span class="comment">// Verify secure token storage</span>
    <span class="keyword">await</span> <span class="function">waitFor</span>(() => {
      expect(localStorage.<span class="function">getItem</span>(<span class="string">'authToken'</span>)).toBe(<span class="string">'mock-jwt-token'</span>);
    });

    <span class="comment">// Verify user is logged in</span>
    expect(screen.<span class="function">getByText</span>(<span class="string">'Welcome, Test User'</span>)).<span class="function">toBeInTheDocument</span>();
  });

  it(<span class="string">'should handle login failure securely'</span>, <span class="keyword">async</span> () => {
    <span class="keyword">const</span> <span class="variable">loginErrorMock</span> = {
      <span class="variable">request</span>: {
        <span class="variable">query</span>: <span class="variable">CONSUMER_LOGIN_MUTATION</span>,
        <span class="variable">variables</span>: {
          <span class="variable">input</span>: {
            email: <span class="string">'invalid@example.com'</span>,
            password: <span class="string">'wrongpassword'</span>
          }
        }
      },
      <span class="variable">error</span>: <span class="keyword">new</span> <span class="function">Error</span>(<span class="string">'Invalid credentials'</span>)
    };

    render(
      <span class="tag">&lt;MockedProvider</span> <span class="attr">mocks</span>=<span class="punct">{</span>[loginErrorMock]<span class="punct">}</span><span class="tag">&gt;</span>
        <span class="tag">&lt;App</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/MockedProvider&gt;</span>
    );

    <span class="keyword">const</span> emailInput = screen.<span class="function">getByLabelText</span>(<span class="string">'Email'</span>);
    <span class="keyword">const</span> passwordInput = screen.<span class="function">getByLabelText</span>(<span class="string">'Password'</span>);
    <span class="keyword">const</span> submitButton = screen.<span class="function">getByRole</span>(<span class="string">'button'</span>, { name: <span class="string">'Login'</span> });

    fireEvent.<span class="function">change</span>(emailInput, { target: { value: <span class="string">'invalid@example.com'</span> } });
    fireEvent.<span class="function">change</span>(passwordInput, { target: { value: <span class="string">'wrongpassword'</span> } });
    fireEvent.<span class="function">click</span>(submitButton);

    <span class="comment">// Verify error message is shown</span>
    <span class="keyword">await</span> <span class="function">waitFor</span>(() => {
      expect(screen.<span class="function">getByText</span>(<span class="string">'Invalid credentials'</span>)).<span class="function">toBeInTheDocument</span>();
    });

    <span class="comment">// Verify no token is stored</span>
    expect(localStorage.<span class="function">getItem</span>(<span class="string">'authToken'</span>)).toBeNull();
  });
});

<span class="comment">// __tests__/security/input-validation.test.ts</span>
<span class="keyword">import</span> { <span class="function">sanitizeInput</span>, <span class="function">validateMessage</span> } <span class="keyword">from</span> <span class="string">'../../src/utils/sanitize'</span>;

<span class="function">describe</span>(<span class="string">'Input Validation Security'</span>, () => {
  <span class="function">describe</span>(<span class="string">'sanitizeInput'</span>, () => {
    it(<span class="string">'should remove XSS attempts'</span>, () => {
      <span class="keyword">const</span> <span class="variable">xssAttempts</span> = [
        <span class="string">'&lt;script&gt;alert("xss")&lt;/script&gt;'</span>,
        <span class="string">'&lt;img src=x onerror=alert("xss")&gt;'</span>,
        <span class="string">'javascript:alert("xss")'</span>,
        <span class="string">'&lt;svg onload=alert("xss")&gt;'</span>
      ];

      xssAttempts.<span class="function">forEach</span>(attempt => {
        <span class="keyword">const</span> result = <span class="function">sanitizeInput</span>(attempt);
        expect(result).<span class="function">not</span>.<span class="function">toMatch</span>(<span class="keyword">/</span><span class="string">script|javascript|onerror|onload</span><span class="keyword">/i</span>);
        expect(result).<span class="function">not</span>.<span class="function">toContain</span>(<span class="string">'alert'</span>);
      });
    });

    it(<span class="string">'should prevent SQL injection attempts'</span>, () => {
      <span class="keyword">const</span> <span class="variable">sqlAttempts</span> = [
        <span class="string">"'; DROP TABLE users; --"</span>,
        <span class="string">"' OR '1'='1"</span>,
        <span class="string">"UNION SELECT * FROM passwords"</span>
      ];

      sqlAttempts.<span class="function">forEach</span>(attempt => {
        <span class="keyword">const</span> result = <span class="function">sanitizeInput</span>(attempt);
        expect(result).<span class="function">not</span>.<span class="function">toMatch</span>(<span class="keyword">/</span><span class="string">(DROP|UNION|SELECT|INSERT|UPDATE|DELETE)</span><span class="keyword">/i</span>);
      });
    });
  });

  <span class="function">describe</span>(<span class="string">'validateMessage'</span>, () => {
    it(<span class="string">'should reject messages with malicious content'</span>, () => {
      <span class="keyword">const</span> <span class="variable">maliciousMessages</span> = [
        <span class="string">'Check out this link: &lt;script&gt;steal_data()&lt;/script&gt;'</span>,
        <span class="string">'Visit evil.com for free stuff!'</span>,
        <span class="string">'Click here: &lt;img src=x onerror=location.href="evil.com"&gt;'</span>
      ];

      maliciousMessages.<span class="function">forEach</span>(message => {
        expect(() => <span class="function">validateMessage</span>(message)).<span class="function">toThrow</span>();
      });
    });

    it(<span class="string">'should allow safe messages'</span>, () => {
      <span class="keyword">const</span> <span class="variable">safeMessages</span> = [
        <span class="string">'Hello, how are you?'</span>,
        <span class="string">'Check out this link: https://example.com'</span>,
        <span class="string">'I have a question about your service.'</span>
      ];

      safeMessages.<span class="function">forEach</span>(message => {
        expect(() => <span class="function">validateMessage</span>(message)).<span class="function">not</span>.<span class="function">toThrow</span>();
      });
    });
  });
});

<span class="comment">// __tests__/integration/chat-flow.test.ts</span>
<span class="keyword">import</span> { render, screen, fireEvent, waitFor } <span class="keyword">from</span> <span class="string">'@testing-library/react'</span>;
<span class="keyword">import</span> { MockedProvider } <span class="keyword">from</span> <span class="string">'@apollo/client/testing'</span>;
<span class="keyword">import</span> { <span class="function">ChatContainer</span> } <span class="keyword">from</span> <span class="string">'../../src/ChatContainer'</span>;

<span class="function">describe</span>(<span class="string">'Chat Flow Integration'</span>, () => {
  it(<span class="string">'should handle complete chat creation and messaging flow'</span>, <span class="keyword">async</span> () => {
    <span class="keyword">const</span> <span class="variable">mocks</span> = [
      {
        <span class="variable">request</span>: {
          <span class="variable">query</span>: <span class="variable">CREATE_CHAT_MUTATION</span>,
          <span class="variable">variables</span>: { websiteId: <span class="string">'site-123'</span> }
        },
        <span class="variable">result</span>: {
          <span class="variable">data</span>: {
            createChat: mockChat
          }
        }
      },
      {
        <span class="variable">request</span>: {
          <span class="variable">query</span>: <span class="variable">CREATE_MESSAGE_MUTATION</span>,
          <span class="variable">variables</span>: {
            input: {
              text: <span class="string">'Hello, I need help!'</span>,
              chatId: <span class="string">'chat-123'</span>,
              authorId: <span class="string">'user-123'</span>
            }
          }
        },
        <span class="variable">result</span>: {
          <span class="variable">data</span>: {
            createMessage: {
              message: {
                id: <span class="string">'msg-123'</span>,
                text: <span class="string">'Hello, I need help!'</span>,
                author: mockUser,
                chatId: <span class="string">'chat-123'</span>,
                timestamp: <span class="string">'2023-01-01T00:00:00Z'</span>
              }
            }
          }
        }
      }
    ];

    render(
      <span class="tag">&lt;MockedProvider</span> <span class="attr">mocks</span>=<span class="punct">{</span>mocks<span class="punct">}</span><span class="tag">&gt;</span>
        <span class="tag">&lt;ChatContainer</span> <span class="attr">websiteId</span>=<span class="punct">"</span>site-123<span class="punct">"</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/MockedProvider&gt;</span>
    );

    <span class="comment">// Start chat</span>
    <span class="keyword">const</span> startChatButton = screen.<span class="function">getByRole</span>(<span class="string">'button'</span>, { name: <span class="string">'Start Chat'</span> });
    fireEvent.<span class="function">click</span>(startChatButton);

    <span class="comment">// Wait for chat to be created</span>
    <span class="keyword">await</span> <span class="function">waitFor</span>(() => {
      expect(screen.<span class="function">getByText</span>(<span class="string">'Chat started'</span>)).<span class="function">toBeInTheDocument</span>();
    });

    <span class="comment">// Send message</span>
    <span class="keyword">const</span> messageInput = screen.<span class="function">getByPlaceholderText</span>(<span class="string">'Type your message...'</span>);
    <span class="keyword">const</span> sendButton = screen.<span class="function">getByRole</span>(<span class="string">'button'</span>, { name: <span class="string">'Send'</span> });

    fireEvent.<span class="function">change</span>(messageInput, { target: { value: <span class="string">'Hello, I need help!'</span> } });
    fireEvent.<span class="function">click</span>(sendButton);

    <span class="comment">// Verify message appears</span>
    <span class="keyword">await</span> <span class="function">waitFor</span>(() => {
      expect(screen.<span class="function">getByText</span>(<span class="string">'Hello, I need help!'</span>)).<span class="function">toBeInTheDocument</span>();
    });
  });
});

<span class="comment">// e2e/chat-journey.spec.ts (Playwright)</span>
<span class="keyword">import</span> { test, expect } <span class="keyword">from</span> <span class="string">'@playwright/test'</span>;

test.<span class="function">describe</span>(<span class="string">'Chat User Journey'</span>, () => {
  test(<span class="string">'should complete full chat journey with security measures'</span>, <span class="keyword">async</span> ({ page }) => {
    <span class="comment">// Navigate to chat widget</span>
    <span class="keyword">await</span> page.<span class="function">goto</span>(<span class="string">'http://localhost:3000'</span>);
    
    <span class="comment">// Verify widget loads securely</span>
    <span class="keyword">await</span> expect(page).<span class="function">toHaveTitle</span>(<span class="string">'Chat Widget'</span>);
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">'.chat-widget'</span>)).<span class="function">toBeVisible</span>();

    <span class="comment">// Start chat</span>
    <span class="keyword">await</span> page.<span class="function">click</span>(<span class="string">'button:has-text("Start Chat")'</span>);
    
    <span class="comment">// Verify secure login form</span>
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">'input[name="email"]'</span>)).<span class="function">toBeVisible</span>();
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">'input[name="password"]'</span>)).<span class="function">toBeVisible</span>();
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">'input[type="password"]'</span>)).<span class="function">toHaveAttribute</span>(<span class="string">'autocomplete'</span>, <span class="string">'current-password'</span>);

    <span class="comment">// Login with valid credentials</span>
    <span class="keyword">await</span> page.<span class="function">fill</span>(<span class="string">'input[name="email"]'</span>, <span class="string">'test@example.com'</span>);
    <span class="keyword">await</span> page.<span class="function">fill</span>(<span class="string">'input[name="password"]'</span>, <span class="string">'password123'</span>);
    <span class="keyword">await</span> page.<span class="function">click</span>(<span class="string">'button:has-text("Login")'</span>);

    <span class="comment">// Verify successful login</span>
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">':text("Welcome, Test User")'</span>)).<span class="function">toBeVisible</span>();

    <span class="comment">// Send a message</span>
    <span class="keyword">await</span> page.<span class="function">fill</span>(<span class="string">'input[placeholder="Type your message..."]'</span>, <span class="string">'Hello, I need help with my order!'</span>);
    <span class="keyword">await</span> page.<span class="function">click</span>(<span class="string">'button:has-text("Send")'</span>);

    <span class="comment">// Verify message appears and is sanitized</span>
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">':text("Hello, I need help with my order!")'</span>)).<span class="function">toBeVisible</span>;
    
    <span class="comment">// Test XSS prevention</span>
    <span class="keyword">await</span> page.<span class="function">fill</span>(
      <span class="string">'input[placeholder="Type your message..."]'</span>,
      <span class="string">'&lt;script&gt;alert("xss")&lt;/script&gt;This should be sanitized'</span>
    );
    <span class="keyword">await</span> page.<span class="function">click</span>(<span class="string">'button:has-text("Send")'</span>);

    <span class="comment">// Verify script tag is removed</span>
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">'script'</span>)).<span class="function">toHaveCount</span>(<span class="number">0</span>);
    <span class="keyword">await</span> expect(page.<span class="function">locator</span>(<span class="string">':text("This should be sanitized")'</span>)).<span class="function">toBeVisible</span>;

    <span class="comment">// Verify secure token storage</span>
    <span class="keyword">const</span> token = <span class="keyword">await</span> page.<span class="function">evaluate</span>(() => localStorage.<span class="function">getItem</span>(<span class="string">'authToken'</span>));
    expect(token).<span class="function">toBeTruthy</span>();
    expect(token).<span class="function">toMatch</span>(<span class="keyword">/</span><span class="string">^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$</span><span class="keyword">/</span>); <span class="comment">// JWT format</span>

    <span class="comment">// Test logout and cleanup</span>
    <span class="keyword">await</span> page.<span class="function">click</span>(<span class="string">'button:has-text("Logout")'</span>);
    
    <span class="comment">// Verify token is cleared</span>
    <span class="keyword">const</span> tokenAfterLogout = <span class="keyword">await</span> page.<span class="function">evaluate</span>(() => localStorage.<span class="function">getItem</span>(<span class="string">'authToken'</span>));
    expect(tokenAfterLogout).<span class="function">toBeNull</span>();
  });
});</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fix-section">
                        <h4>üí° Benefits of This Fix</h4>
                        <ul class="benefits-list">
                            <li>Comprehensive test coverage catches bugs before production</li>
                            <li>Security-focused tests prevent vulnerabilities</li>
                            <li>Integration tests ensure component interactions work correctly</li>
                            <li>E2E tests verify complete user journeys</li>
                            <li>Automated testing enables continuous delivery with confidence</li>
                        </ul>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>üí° Recommendation</h4>
                    <p>Implement comprehensive unit tests, add integration tests for critical flows, and create E2E tests for user journeys.</p>
                </div>
            </div>
        </section>

        <section id="recommendations" class="section">
            <h2>
                <span class="section-icon">‚úÖ</span>
                Priority Recommendations
            </h2>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Immediate Actions (Next 1-2 weeks)</div>
                        <div class="issue-meta">
                            <span class="badge badge-critical">Priority 1</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    <strong>Security Fixes:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Move JWT tokens to HttpOnly cookies</li>
                        <li>Fix CSP policy gaps and remove unsafe-inline</li>
                        <li>Implement server-side input validation</li>
                        <li>Add proper error boundaries</li>
                    </ul>
                    <strong>Memory Leak Fixes:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Fix subscription cleanup in ChatContainer</li>
                        <li>Implement proper event listener management</li>
                        <li>Add cache size monitoring and cleanup</li>
                    </ul>
                </div>
                <div class="recommendation">
                    <h4>üéØ Impact</h4>
                    <p>These fixes address critical security vulnerabilities and memory leaks that could impact production stability and user data security.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Short-term Improvements (Next 1 month)</div>
                        <div class="issue-meta">
                            <span class="badge badge-high">Priority 2</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    <strong>Architecture:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Fix race conditions in chat creation</li>
                        <li>Implement centralized state management</li>
                        <li>Add comprehensive error handling</li>
                        <li>Implement code splitting</li>
                    </ul>
                    <strong>Performance:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Optimize bundle size (remove moment.js)</li>
                        <li>Add React.memo and useMemo optimizations</li>
                        <li>Implement proper caching strategies</li>
                    </ul>
                </div>
                <div class="recommendation">
                    <h4>üéØ Impact</h4>
                    <p>These improvements will enhance application stability, performance, and maintainability while reducing technical debt.</p>
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <div>
                        <div class="issue-title">Long-term Strategy (Next 3-6 months)</div>
                        <div class="issue-meta">
                            <span class="badge badge-medium">Priority 3</span>
                        </div>
                    </div>
                </div>
                <div class="issue-description">
                    <strong>Modernization:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Migrate to TypeScript</li>
                        <li>Implement comprehensive testing</li>
                        <li>Add performance monitoring</li>
                        <li>Create design system</li>
                    </ul>
                    <strong>Advanced Features:</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Implement offline support</li>
                        <li>Add progressive loading</li>
                        <li>Create micro-frontend architecture</li>
                        <li>Implement advanced security features</li>
                    </ul>
                </div>
                <div class="recommendation">
                    <h4>üéØ Impact</h4>
                    <p>These strategic initiatives will future-proof the codebase, improve developer experience, and enable advanced features.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Generated on November 12, 2024 | Chat Widget Codebase Analysis Report</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                This report identified 55 issues across security, performance, architecture, and code quality. 
                Prioritize Critical and High severity issues first to ensure production stability and security.
            </p>
        </div>
    </footer>

    <script>
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeIcon.textContent = 'üåô';
                themeToggle.innerHTML = '<span id="theme-icon">üåô</span> Dark Mode';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeToggle.innerHTML = '<span id="theme-icon">‚òÄÔ∏è</span> Light Mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme preference
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeToggle.innerHTML = '<span id="theme-icon">‚òÄÔ∏è</span> Light Mode';
            }

            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Add scroll animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // Observe all issue cards
            document.querySelectorAll('.issue-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        });
    </script>
</body>
</html>